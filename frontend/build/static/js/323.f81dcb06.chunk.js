"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[323],{8323:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var i=n(2982),r=n(885),c=n(2791),a=n(4581),d=n(5470),o=n(2202),s=n(8750),l="journals_content__hWAt6",u="journals_journals__Vq-81",_="journals_addFormModal__se4DT",m="journals_addForm__nN3gp",f="journals_entryForm__DnwHQ",p="journals_head__D2DRL",b="journals_customer__YflP1",h="journals_actions__PdwNS",x="journals_mainForm__WGtx1",j="journals_mainFormWrapper__yzg3c",v=n(5454),g=n(1080),y=n(1413),N=n(1134),Z=n(1570),D=n(2942),I=n(184),T=Z.Ry({dateTime:Z.hT().required()}),C=function(e){var t=e.edit,n=e.onSuccess,a=(0,c.useState)([]),o=(0,r.Z)(a,2),l=o[0],u=o[1],_=(0,N.cI)({resolver:(0,v.y)(T)}),p=_.handleSubmit,b=_.register,h=_.reset,Z=_.control,C=_.setFocus,S=_.setValue,k=_.setError,E=_.clearErrors,M=_.formState.errors,P=(0,v.i)(g.Hv.journals+"/".concat((null===t||void 0===t?void 0:t._id)||"")),Y=P.post,w=P.put,A=P.loading,F=(0,c.useCallback)((function(e){if(!l.some((function(e,t){return(!e.accountId||!("credit"===e.type&&e.credit||"debit"===e.type&&e.debit))&&(e.type?"debit"!==e.type||e.debit?"credit"!==e.type||e.credit||k("entries_".concat(t,"_credit"),{type:"custom",message:"Please enter credit."}):k("entries_".concat(t,"_debit"),{type:"custom",message:"Please enter debit."}):k("entries_".concat(t,"_type"),{type:"custom",message:"Please select a type."}),e.accountId||k("entries_".concat(t,"_accountId"),{type:"custom",message:"Please select an account."}),!0)}))){if(l.reduce((function(e,t){return e+ +(t.debit||0)}),0)!==l.reduce((function(e,t){return e+ +(t.credit||0)}),0))return(0,s.N)({type:"error",message:"Total debit does not match total credit."});(t?w:Y)({dateTime:e.dateTime,detail:e.detail||null,accountingEntries:l.map((function(e){return{accountId:e.accountId,debit:+e.debit||0,credit:+e.credit||0}}))}).then((function(e){var t=e.data;if(!t.success)return(0,s.N)({type:"error",message:t.message});n(t.data)})).catch((function(e){return(0,s.N)({type:"error",message:e.message})}))}}),[l]);return(0,c.useEffect)((function(){var e,n,i,r={dateTime:(0,d._7)((null===t||void 0===t?void 0:t.dateTime)||new Date,"YYYY-MM-DD hh:mm"),detail:(null===t||void 0===t?void 0:t.detail)||""};null!==t&&void 0!==t&&null!==(e=t.entries)&&void 0!==e&&e.length?null===t||void 0===t||null===(i=t.entries)||void 0===i||i.forEach((function(e,t){r["entries_".concat(t,"_type")]=e.credit>e.debit?"credit":"debit",r["entries_".concat(t,"_accountId")]=e.accountId,r["entries_".concat(t,"_debit")]=e.debit,r["entries_".concat(t,"_credit")]=e.credit})):(r.entries_0_type="credit",r.entries_0_accountId="",r.entries_0_debit="",r.entries_0_credit="");h(r),u(null!==t&&void 0!==t&&null!==(n=t.entries)&&void 0!==n&&n.length?null===t||void 0===t?void 0:t.entries.map((function(e){return(0,y.Z)((0,y.Z)({},e),{},{type:e.credit>e.debit?"credit":"debit"})})):[{_id:Math.random().toString(36),type:"credit",accountId:"",debit:"",credit:""}])}),[t]),(0,I.jsx)("div",{className:"grid gap-1 p-1 ".concat(m),children:(0,I.jsx)("div",{className:"".concat(x," grid gap-1"),children:(0,I.jsxs)("form",{className:"".concat(j," grid gap-1 all-columns"),onSubmit:p(F),children:[(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)({label:"Date",type:"datetime-local"},b("dateTime")),{},{required:!0,error:M.dateTime})),(0,I.jsx)("h3",{children:"Entries"}),(l||[]).map((function(e,t){return(0,I.jsxs)("div",{className:f,children:[(0,I.jsx)(d.hQ,{label:"Type",control:Z,name:"entries_".concat(t,"_type"),formOptions:{required:!0},options:[{label:"Credit",value:"credit"},{label:"Debit",value:"debit"}],onChange:function(n){"credit"===n.value?(E("entries_".concat(t,"_debit")),S("entries_".concat(t,"_debit"),0),+e.debit&&S("entries_".concat(t,"_credit"),+e.debit||0)):(E("entries_".concat(t,"_credit")),S("entries_".concat(t,"_credit"),0),+e.credit&&S("entries_".concat(t,"_debit"),+e.credit||0)),u((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)((0,y.Z)({},t),{},{type:n.value},"debit"===n.value&&+e.credit&&{debit:+e.credit,credit:0}),"credit"===n.value&&+e.debit&&{credit:+e.debit,debit:0}):t}))}))}}),(0,I.jsx)(d.OC,{label:"Account",control:Z,name:"entries_".concat(t,"_accountId"),formOptions:{required:!0},url:g.Hv.accountingMasters,getQuery:function(e){return{isGroup:"false",name:e||""}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(n){u((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{accountId:n.value}):t}))})),C("entries_".concat(t,"_").concat(e.type))}}),(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)({label:"Debit",type:"number",step:"0.01",required:!0,disabled:"credit"===e.type},b("entries_".concat(t,"_debit"))),{},{onChange:function(n){E("entries_".concat(t,"_debit")),u((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{debit:n.target.value}):t}))}))},error:M["entries_".concat(t,"_debit")]})),(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)({label:"Credit",type:"number",step:"0.01",required:!0,disabled:"debit"===e.type},b("entries_".concat(t,"_credit"))),{},{onChange:function(n){E("entries_".concat(t,"_credit")),u((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{credit:n.target.value}):t}))}))},error:M["entries_".concat(t,"_credit")]})),(null===l||void 0===l?void 0:l.length)>1&&(0,I.jsx)("button",{type:"button",onClick:function(){return u((function(t){return t.filter((function(t){return t._id!==e._id}))}))},className:"btn clear iconOnly",children:(0,I.jsx)(D.K3i,{})})]},e._id)})),!A&&(0,I.jsx)("button",{type:"button",className:"btn secondary",onClick:function(){S("entries_".concat(l.length,"_type"),"credit"),u((function(e){return[].concat((0,i.Z)(e),[{_id:Math.random().toString(36),type:"credit",accountId:"",debit:"",credit:""}])}))},children:"Add More Entry"}),(0,I.jsx)("hr",{}),(0,I.jsxs)("div",{className:f,children:[(0,I.jsx)("span",{}),(0,I.jsx)("span",{className:"text-right",children:"Total"}),(0,I.jsx)("span",{className:"text-right",children:l.reduce((function(e,t){return e+ +(t.debit||0)}),0)}),(0,I.jsx)("span",{className:"text-right",children:l.reduce((function(e,t){return e+ +(t.credit||0)}),0)})]}),(0,I.jsx)(d.gx,(0,y.Z)((0,y.Z)({label:"Detail"},b("detail")),{},{error:M.detail})),(0,I.jsx)("div",{className:"btns",children:(0,I.jsx)("button",{className:"btn",disabled:A,children:t?"Update":"Submit"})})]})})})},S=n(5804),k=n(657),E=n(4316),M=function(e){var t=e.setSidebarOpen,n=(0,c.useContext)(a.D),m=n.config,f=n.checkPermission,x=(0,c.useState)([]),j=(0,r.Z)(x,2),y=j[0],N=j[1],Z=(0,c.useState)(null),D=(0,r.Z)(Z,2),T=D[0],M=D[1],P=(0,c.useState)(!1),Y=(0,r.Z)(P,2),w=Y[0],A=Y[1],F=(0,v.i)(g.Hv.journals),q=F.get,O=F.loading,H=(0,v.i)(g.Hv.journals+"/{ID}").remove;return(0,c.useEffect)((function(){q().then((function(e){var t=e.data;if(t.success)return N(t.data)})).catch((function(e){return(0,s.N)({type:"error",message:e.message})}))}),[]),(0,I.jsxs)("div",{className:"".concat(l," grid gap-1 m-a p-1"),children:[(0,I.jsx)("div",{className:"flex ".concat(p),children:(0,I.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return t((function(e){return!e}))},children:[(0,I.jsx)(S.Ps6,{style:{fontSize:"1.75rem"}}),(0,I.jsx)("h2",{children:"Journals"}),f("journal_create")&&(0,I.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),A(!0)},children:(0,I.jsx)(k.ueT,{})})]})}),(0,I.jsx)(d.iA,{loading:O,className:u,columns:[{label:"Date"},{label:"No"},{label:"Account"},{label:"Debit",className:"text-right"},{label:"Credit",className:"text-right"},{label:"Action"}],children:y.map((function(e,t,n){var r,c,a;return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{className:"grid",children:(null===(r=n[t-1])||void 0===r?void 0:r.rec_id)!==e.rec_id&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.W7,{style:{fontSize:"14px"},format:"DD MMM YYYY",children:e.dateTime}),(0,I.jsx)(d.W7,{format:"hh:mma",children:e.dateTime})]})}),(0,I.jsx)("td",{children:(null===(c=n[t-1])||void 0===c?void 0:c.rec_id)!==e.rec_id&&e.no}),(0,I.jsx)("td",{className:b,children:e.accountName}),(0,I.jsx)("td",{className:"text-right",children:e.debit?e.debit.toFixed(2,null===m||void 0===m?void 0:m.numberSeparator):null}),(0,I.jsx)("td",{className:"text-right",children:e.credit?e.credit.fix(2,null===m||void 0===m?void 0:m.numberSeparator):null}),(null===(a=n[t-1])||void 0===a?void 0:a.rec_id)!==e.rec_id&&(0,I.jsx)(d.p2,{className:h,actions:[{icon:(0,I.jsx)(E.dou,{}),label:"Edit",onClick:function(){M({_id:e.rec_id,dateTime:e.dateTime,detail:e.detail,entries:n.filter((function(t){return t.rec_id===e.rec_id})).sort((function(e,t){return e.index>t.index?1:-1}))}),A(!0)}}].concat((0,i.Z)(f("journal_delete")?[{icon:(0,I.jsx)(o.lp8,{}),label:"Delete",onClick:function(){return(0,s.N)({type:"confirmation",message:"Are you sure you want to remove this entry?",callback:function(){H({},{params:{"{ID}":e.rec_id}}).then((function(t){var n=t.data;n.success?N((function(t){return t.filter((function(t){return t.rec_id!==e.rec_id}))})):(0,s.N)({type:"error",message:n.message})}))}})}}]:[]))})]},e._id)}))}),(0,I.jsx)(s.u,{open:w,head:!0,label:"".concat(T?"Update":"Add"," Journal Entries"),className:_,setOpen:function(){M(null),A(!1)},children:(0,I.jsx)(C,{edit:T,onSuccess:function(e){N((function(t){return[].concat((0,i.Z)(e),(0,i.Z)(t.filter((function(t){return t.rec_id!==e[0].rec_id})))).sort((function(e,t){return new Date(e.dateTime)>new Date(t.dateTime)?1:-1}))})),M(null),A(!1)}})})]})}}}]);
//# sourceMappingURL=323.f81dcb06.chunk.js.map