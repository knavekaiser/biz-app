"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[518],{2518:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var c=n(2982),r=n(885),i=n(2791),a=n(4581),o=n(5470),s=n(2202),u=n(8750),l={content:"receipts_content__z6trl",receipts:"receipts_receipts__NH-V3",addReceiptForm:"receipts_addReceiptForm__n7XLC",receiptDetail:"receipts_receiptDetail__nmLry",box:"receipts_box__vj9u4",noContent:"receipts_noContent__fNjH0",items:"receipts_items__Ga40U",name:"receipts_name__sxSXf",itemForm:"receipts_itemForm__7BZu3",btns:"receipts_btns__z9YQE",mainForm:"receipts_mainForm__WJKvS",mainFormWrapper:"receipts_mainFormWrapper__Ag34X",invoiceTable:"receipts_invoiceTable__cNmy2",detail:"receipts_detail__juo0m",label:"receipts_label__EIIS1",viewOnly:"receipts_viewOnly__Pzz+e",print:"receipts_print__mpSLr",logo:"receipts_logo__4Dcyr",taxes:"receipts_taxes__ujk7o",totalAmount:"receipts_totalAmount__pmhFy",word:"receipts_word__J2MQt",digit:"receipts_digit__cQdkI",sign:"receipts_sign__n8aJo",signature:"receipts_signature__G5kL0",head:"receipts_head__gXPc3",date:"receipts_date__L92hv",no:"receipts_no__Xfm-Y",customer:"receipts_customer__Xbq4A",net:"receipts_net__ltS8B",actions:"receipts_actions__JRhnz",itemName:"receipts_itemName__TXJZQ"},d=n(5454),m=n(1080),p=n(1413),f=n(1134),v=n(1570),h=n(1146),x=n(184),_=v.Ry({date:v.Z_().required(),amount:v.Rx().min(1,"Enter more than 0").required().typeError("Enter a valid amount"),customerAccountId:v.Z_().required(),cashAccountId:v.Z_().required()}),b=v.Ry({no:v.Z_().required(),amount:v.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),net:v.Rx(),due:v.Rx()}),j=function(e){var t=e.label,n=e.value,c=e.className;return(0,x.jsxs)("p",{className:"".concat(l.detail," ").concat(c||""),children:[(0,x.jsxs)("span",{className:l.label,children:[t,":"]})," ",(0,x.jsx)("span",{className:l.value,children:n})]})},g=function(e){var t=e.edit,n=e.setEdit,c=(e.receipts,e.invoices),r=e.onSuccess,m=((0,i.useContext)(a.D).config,(0,f.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(b)})),v=m.handleSubmit,h=m.register,_=m.reset,j=(m.watch,m.setValue),g=(m.clearErrors,m.control),N=m.formState.errors;return(0,i.useEffect)((function(){_((0,p.Z)({},t))}),[t]),(0,x.jsxs)("form",{onSubmit:v((function(e){if(t||(e._id=Math.random().toString().substr(-8)),e.amount>e.due)return(0,u.N)({type:"error",message:"Enter an amount less or equal to ".concat(e.due)});e.no=+e.no,r(e),_()})),className:"".concat(l.itemForm," grid gap-1"),children:[(0,x.jsx)(o.OC,{control:g,label:"Invoice No.",options:c.filter((function(e){return e.due})).map((function(e){return{label:"".concat(e.no,". ").concat((0,o._7)(e.dateTime,"DD-MM-YY")," Due: ").concat(e.due),value:e.no,data:e}})),name:"no",formOptions:{required:!0},onChange:function(e){"string"===typeof e||(j("no",e.data.no),j("due",e.data.due),j("net",e.data.net))},type:"number",className:l.itemName}),(0,x.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Net",type:"number"},h("net")),{},{readOnly:!0})),(0,x.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Due",type:"number"},h("due")),{},{readOnly:!0})),(0,x.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},h("amount")),{},{error:N.amount})),t?(0,x.jsxs)("div",{className:"flex ".concat(l.btns),children:[(0,x.jsx)("button",{type:"submit",children:(0,x.jsx)(s.l_A,{})}),(0,x.jsx)("button",{type:"button",onClick:function(){return n(null)},children:(0,x.jsx)(s.aHS,{})})]}):(0,x.jsx)("button",{className:"btn",children:t?"Update":"Add"})]})},N=function(e){var t,n=e.invoices,v=e.edit,h=e.items,b=e.setItems,j=e.receipts,N=e.setErr,S=e.onSuccess,I=(e.setViewOnly,(0,i.useContext)(a.D)),A=I.config,Z=(I.setConfig,(0,i.useState)(!(null===v||void 0===v||null===(t=v.invoices)||void 0===t||!t.length))),C=(0,r.Z)(Z,2),D=C[0],k=C[1],E=(0,i.useState)(null),Y=(0,r.Z)(E,2),w=Y[0],F=Y[1],M=(0,i.useState)("table"),R=(0,r.Z)(M,2),q=R[0],O=R[1],H=(0,f.cI)({resolver:(0,d.y)(_)}),T=H.handleSubmit,P=H.register,V=H.reset,z=H.setValue,Q=H.watch,W=H.control,X=H.formState.errors,B=(0,d.i)(m.Hv.receipts+"/".concat((null===v||void 0===v?void 0:v._id)||"")),J=B.post,L=B.put,G=B.loading,U=(0,i.useCallback)((function(e){if(h.length>0){h.reduce((function(e,t){return e+t.net}),0);var t=h.reduce((function(e,t){return e+t.amount}),0);h.reduce((function(e,t){return e+t.due}),0);if(t>e.amount)return(0,u.N)({type:"error",message:"Adjusted amount (".concat(t,") can not be more than the receipt amount.")})}(v?L:J)({dateTime:e.date,amount:e.amount,type:e.type,customerAccountId:e.customerAccountId,customerAccountName:e.customerAccountName,cashAccountId:e.cashAccountId,cashAccountName:e.cashAccountName,invoices:h.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{_id:void 0})}))}).then((function(e){var t=e.data;if(!t.success)return(0,u.N)({type:"error",message:t.message});S(t.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[h]),K=Q("customerName");return(0,i.useEffect)((function(){var e,t;V((0,p.Z)((0,p.Z)({},v),{},{date:(0,o._7)(null===v||void 0===v?void 0:v.date,"YYYY-MM-DD"),customerName:(null===v||void 0===v||null===(e=v.customer)||void 0===e?void 0:e.name)||"",customerDetail:(null===v||void 0===v||null===(t=v.customer)||void 0===t?void 0:t.detail)||""}))}),[v]),(0,x.jsxs)("div",{className:"".concat(l.mainForm," grid gap-1"),children:[(0,x.jsxs)("form",{className:"".concat(l.mainFormWrapper," grid gap-1 all-columns"),onSubmit:T(U),children:[(0,x.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Date",type:"date"},P("date")),{},{required:!0,error:X.date})),(0,x.jsx)(o.OC,{label:"Cash/Bank Account",control:W,name:"cashAccountId",formOptions:{required:!0},url:m.Hv.accountingMasters,getQuery:function(e){return{types:"Cash,Bank",isGroup:"false",name:e}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(e){var t;z("cashAccountName",null===(t=e.account)||void 0===t?void 0:t.name)}}),(0,x.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},P("amount")),{},{error:X.amount})),(0,x.jsx)("div",{className:"all-columns",children:(0,x.jsx)("h3",{children:"Account Information"})}),(0,x.jsx)(o.OC,{label:"Customer Account",control:W,name:"customerAccountId",formOptions:{required:!0},url:m.Hv.accountingMasters,getQuery:function(e){return{isGroup:"false",name:e}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(e){var t;z("customerAccountName",null===(t=e.account)||void 0===t?void 0:t.name)}})]}),(0,x.jsx)("div",{className:"all-columns flex justify-center",children:(0,x.jsxs)("button",{className:"btn",onClick:function(){k(!D),b([])},children:[D?"Clear":"Adjust"," Invoices"]})}),D&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Adjusted Invoices"}),(0,x.jsx)(o.mQ,{secondary:!0,activeTab:q,onChange:function(e){return O(e.value)},tabs:[{label:"Invoice Table",value:"table"},{label:"Search Invoice",value:"search"}]})]}),D&&"table"===q&&(n.filter((function(e){return e.customer.name===K&&(h.some((function(t){return t.no===e.no}))||e.due)})).length>0?(0,x.jsx)(o.iA,{className:l.invoiceTable,columns:[{label:"Invoice No"},{label:"Date"},{label:"Customer"},{label:"Net",className:"text-right"},{label:"Due",className:"text-right"},{label:"Adjust"}],children:n.filter((function(e){return e.customer.name===K&&(h.some((function(t){return t.no===e.no}))||e.due)})).map((function(e){return(0,x.jsx)(y,{invoice:e,config:A,items:h,setItems:b},e._id)}))}):(0,x.jsx)("p",{className:l.noContent,children:"No pending invoice from selected customer."})),D&&"search"===q&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(g,{invoices:n.filter((function(e){return e.customer.name===K})),edit:w,setEdit:F,receipts:j,onSuccess:function(e){if(N(null),w)b((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),F(null);else{if(h.some((function(t){return t.no.toString()===e.no.toString()})))return(0,u.N)({type:"error",message:"Invoice has already been added."});b((function(t){return[].concat((0,c.Z)(t),[e])}))}}},w?"edit":"add"),h.length>0?(0,x.jsx)(o.iA,{className:l.items,columns:[{label:"Invoice No."},{label:"Amount",className:"text-right"},{label:"Action",action:!0}],children:h.map((function(e,t){return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:l.name,children:(0,x.jsx)("span",{className:"ellipsis",children:e.no})}),(0,x.jsx)("td",{className:"text-right",children:e.amount.fix(2,null===A||void 0===A?void 0:A.numberSeparator)}),(0,x.jsx)(o.p2,{actions:[{icon:(0,x.jsx)(s.KHI,{}),label:"Edit",onClick:function(){return F(e)}},{icon:(0,x.jsx)(s.lp8,{}),label:"Delete",onClick:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){b((function(t){return t.filter((function(t){return t._id!==e._id}))}))}})}}]})]},t)}))}):(0,x.jsx)("p",{className:l.noContent,children:"No invoices selected."})]}),(0,x.jsx)("form",{className:"".concat(l.btnsWrapper," grid gap-1 all-columns"),onSubmit:T(U),children:(0,x.jsx)("div",{className:"btns",children:(0,x.jsx)("button",{className:"btn",disabled:w||G,children:v?"Update":"Submit"})})})]})},y=function(e){var t,n,a,s=e.invoice,u=e.items,d=e.setItems,m=e.config,p=(0,i.useState)((null===(t=u.find((function(e){return e.no===s.no})))||void 0===t?void 0:t.amount)||""),f=(0,r.Z)(p,2),v=f[0],h=f[1];return(0,i.useEffect)((function(){var e;h((null===(e=u.find((function(e){return e.no===s.no})))||void 0===e?void 0:e.amount)||"")}),[u]),(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{children:[s.no,(null===m||void 0===m||null===(n=m.print)||void 0===n?void 0:n.invoiceNoSuffix)||""]}),(0,x.jsx)("td",{className:l.date,children:(0,x.jsx)(o.W7,{format:"DD/MM/YYYY",children:s.date})}),(0,x.jsx)("td",{className:l.customer,children:null===(a=s.customer)||void 0===a?void 0:a.name}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:s.net.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:s.due.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{children:(0,x.jsx)(o.II,{placeholder:"Adjust",type:"number",onBlur:function(e){var t=+e.target.value||0;if(t<=0)return e.target.value="",void d((function(e){return(0,c.Z)(e.filter((function(e){return e.no!==s.no})))}));s.due&&d((function(e){return[].concat((0,c.Z)(e.filter((function(e){return e.no!==s.no}))),[{_id:Math.random().toString().substr(-8),no:s.no,due:s.due,net:s.net,amount:Math.min(t,s.due)}])}))},value:v,onChange:function(e){return h(e.target.value)}})})]})},S=function(e){var t,n,c,s,u=e.edit,f=e.receipts,v=e.onSuccess,_=(0,i.useContext)(a.D),b=(_.user,_.config),g=_.checkPermission,y=(0,i.useState)(!!u),S=(0,r.Z)(y,2),I=S[0],A=S[1],Z=(0,i.useState)((null===u||void 0===u?void 0:u.invoices)||[]),C=(0,r.Z)(Z,2),D=C[0],k=C[1],E=(0,i.useState)(null),Y=(0,r.Z)(E,2),w=Y[0],F=Y[1],M=(0,i.useRef)(),R=((0,h.useReactToPrint)({content:function(){return M.current}}),(0,i.useState)([])),q=(0,r.Z)(R,2),O=q[0],H=q[1],T=(0,d.i)(m.Hv.invoices).get;return(0,i.useEffect)((function(){T().then((function(e){var t=e.data;null!==t&&void 0!==t&&t.success&&H(t.data.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{due:e.due.fix(2),net:e.items.reduce((function(e,t){return e+t.qty*t.price}),0)+e.items.reduce((function(e,t){return e+t.qty*t.price}),0).percent(e.gst)})})))}))}),[]),(0,x.jsxs)("div",{className:"grid gap-1 p-1 ".concat(l.addReceiptForm," ").concat(I?l.viewOnly:""),children:[I&&(0,x.jsxs)("div",{className:"flex wrap gap-1 ".concat(l.receiptDetail),children:[(0,x.jsx)("div",{className:"flex gap-1 all-columns justify-end align-center",children:g("receipt_update")&&(0,x.jsx)("button",{className:"btn",onClick:function(){return A(!1)},children:"Edit"})}),(0,x.jsxs)("div",{className:l.box,children:[(0,x.jsx)("h3",{children:"Customer Information"}),(0,x.jsx)(j,{label:"Name",value:null===(t=u.customer)||void 0===t?void 0:t.name}),(0,x.jsx)(j,{label:"Detail",value:(null===(n=u.customer)||void 0===n||null===(c=n.detail)||void 0===c?void 0:c.split("\n").map((function(e,t,n){return(0,x.jsxs)("span",{children:[e,n[t+1]&&(0,x.jsx)("br",{})]},t)})))||null})]}),(0,x.jsxs)("div",{className:l.box,children:[(0,x.jsx)("h3",{children:"Receipt Information"}),(0,x.jsx)(j,{label:"Inv No",value:"".concat(u.no).concat((null===b||void 0===b||null===(s=b.print)||void 0===s?void 0:s.receiptNoSuffix)||"")}),(0,x.jsx)(j,{label:"Date",value:(0,o._7)(null===u||void 0===u?void 0:u.date,"DD-MM-YYYY")}),(0,x.jsx)(j,{label:"Amount",value:u.amount.fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"}),(0,x.jsx)(j,{label:"Adjusted",value:u.invoices.reduce((function(e,t){return e+t.amount}),0).fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"})]})]}),w&&(0,x.jsx)("p",{className:"error",children:w}),!1,!I&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Receipt Information"}),(0,x.jsx)(N,{invoices:O,edit:u,items:D,setItems:k,receipts:f,setErr:F,onSuccess:v,setViewOnly:A})]})]})},I=n(5804),A=n(657),Z=function(e){var t=e.setSidebarOpen,n=(0,i.useContext)(a.D),p=n.config,f=n.checkPermission,v=(0,i.useState)([]),h=(0,r.Z)(v,2),_=h[0],b=h[1],j=(0,i.useState)(null),g=(0,r.Z)(j,2),N=g[0],y=g[1],Z=(0,i.useState)(!1),C=(0,r.Z)(Z,2),D=C[0],k=C[1],E=(0,d.i)(m.Hv.receipts),Y=E.get,w=E.loading,F=(0,d.i)(m.Hv.receipts+"/{ID}").remove;return(0,i.useEffect)((function(){Y().then((function(e){var t=e.data;if(t.success)return b(t.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[]),(0,x.jsxs)("div",{className:"".concat(l.content," grid gap-1 m-a p-1"),children:[(0,x.jsx)("div",{className:"flex ".concat(l.head),children:(0,x.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return t((function(e){return!e}))},children:[(0,x.jsx)(I.Ps6,{style:{fontSize:"1.75rem"}}),(0,x.jsx)("h2",{children:"All Receipts"}),f("reciept_create")&&(0,x.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),k(!0)},children:(0,x.jsx)(A.ueT,{})})]})}),(0,x.jsx)(o.iA,{loading:w,className:l.receipts,columns:[{label:"No."},{label:"Date"},{label:"Account"},{label:"Amount",className:"text-right"},{label:"Action"}],children:_.map((function(e){var t,n,r;return(0,x.jsxs)("tr",{onClick:function(){y(e),k(!0)},style:{cursor:"pointer"},children:[(0,x.jsxs)("td",{className:l.no,children:[e.no,(null===p||void 0===p||null===(t=p.print)||void 0===t?void 0:t.receiptNoSuffix)||""]}),(0,x.jsx)("td",{className:l.date,children:(0,x.jsx)(o.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,x.jsx)("td",{className:l.customer,children:null===(n=e.accountingEntries)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.accountName}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:e.amount.fix(2,null===p||void 0===p?void 0:p.numberSeparator)}),(0,x.jsx)(o.p2,{className:l.actions,actions:[{icon:(0,x.jsx)(s.z5B,{}),label:"View",onClick:function(){y(e),k(!0)}}].concat((0,c.Z)(f("reciept_delete")?[{icon:(0,x.jsx)(s.lp8,{}),label:"Delete",onClick:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this receipt?",callback:function(){F({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?b((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,u.N)({type:"error",message:n.message})}))}})}}]:[]))})]},e._id)}))}),(0,x.jsx)(u.u,{open:D,head:!0,label:"".concat(N?"View / Update":"Add"," Receipt"),className:l.addReceiptFormModal,setOpen:function(){y(null),k(!1)},children:(0,x.jsx)(S,{edit:N,receipts:_,onSuccess:function(e){N?(b((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),y(null)):b((function(t){return[].concat((0,c.Z)(t),[e])})),k(!1)}})})]})}}}]);
//# sourceMappingURL=518.dd3a1d64.chunk.js.map