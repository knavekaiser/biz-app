"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[323],{8323:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var i=n(2982),r=n(885),c=n(2791),a=n(4581),d=n(5470),o=n(2202),s=n(8750),l="journals_content__hWAt6",u="journals_journals__Vq-81",_="journals_addFormModal__se4DT",m="journals_addForm__nN3gp",f="journals_entryForm__DnwHQ",p="journals_head__D2DRL",b="journals_customer__YflP1",h="journals_actions__PdwNS",x="journals_mainForm__WGtx1",v="journals_mainFormWrapper__yzg3c",j=n(5454),g=n(1080),y=n(1413),D=n(1134),N=n(1570),Z=n(2942),I=n(184),T=N.Ry({dateTime:N.hT().required()}),C=function(e){var t=e.edit,n=e.onSuccess,o=(0,c.useContext)(a.D).finPeriod,l=(0,c.useState)([]),u=(0,r.Z)(l,2),_=u[0],p=u[1],b=(0,D.cI)({resolver:(0,j.y)(T)}),h=b.handleSubmit,N=b.register,C=b.reset,S=b.control,Y=b.setFocus,M=b.setValue,k=b.setError,w=b.clearErrors,E=b.formState.errors,P=(0,j.i)(g.Hv.journals+"/".concat((null===t||void 0===t?void 0:t._id)||"")),A=P.post,F=P.put,q=P.loading,O=(0,c.useCallback)((function(e){if(!_.some((function(e,t){return(!e.accountId||!("credit"===e.type&&e.credit||"debit"===e.type&&e.debit))&&(e.type?"debit"!==e.type||e.debit?"credit"!==e.type||e.credit||k("entries_".concat(t,"_credit"),{type:"custom",message:"Please enter credit."}):k("entries_".concat(t,"_debit"),{type:"custom",message:"Please enter debit."}):k("entries_".concat(t,"_type"),{type:"custom",message:"Please select a type."}),e.accountId||k("entries_".concat(t,"_accountId"),{type:"custom",message:"Please select an account."}),!0)}))){if(_.reduce((function(e,t){return e+ +(t.debit||0)}),0)!==_.reduce((function(e,t){return e+ +(t.credit||0)}),0))return(0,s.N)({type:"error",message:"Total debit does not match total credit."});(t?F:A)({dateTime:e.dateTime,detail:e.detail||null,accountingEntries:_.map((function(e){return{accountId:e.accountId,debit:+e.debit||0,credit:+e.credit||0}}))}).then((function(e){var t=e.data;if(!t.success)return(0,s.N)({type:"error",message:t.message});n(t.data)})).catch((function(e){return(0,s.N)({type:"error",message:e.message})}))}}),[_]);return(0,c.useEffect)((function(){var e,n,i=null!==t&&void 0!==t&&t.dateTime?new Date(null===t||void 0===t?void 0:t.dateTime):new Date;o&&i<new Date(o.startDate)?i=o.startDate:o&&i>new Date(o.endDate)&&(i=o.endDate);var r,c={dateTime:(0,d._7)(i,"YYYY-MM-DD"),detail:(null===t||void 0===t?void 0:t.detail)||""};null!==t&&void 0!==t&&null!==(e=t.entries)&&void 0!==e&&e.length?null===t||void 0===t||null===(r=t.entries)||void 0===r||r.forEach((function(e,t){c["entries_".concat(t,"_type")]=e.credit>e.debit?"credit":"debit",c["entries_".concat(t,"_accountId")]=e.accountId,c["entries_".concat(t,"_debit")]=e.debit,c["entries_".concat(t,"_credit")]=e.credit})):(c.entries_0_type="credit",c.entries_0_accountId="",c.entries_0_debit="",c.entries_0_credit="");C(c),p(null!==t&&void 0!==t&&null!==(n=t.entries)&&void 0!==n&&n.length?null===t||void 0===t?void 0:t.entries.map((function(e){return(0,y.Z)((0,y.Z)({},e),{},{type:e.credit>e.debit?"credit":"debit"})})):[{_id:Math.random().toString(36),type:"credit",accountId:"",debit:"",credit:""}])}),[t]),(0,I.jsx)("div",{className:"grid gap-1 p-1 ".concat(m),children:(0,I.jsx)("div",{className:"".concat(x," grid gap-1"),children:(0,I.jsxs)("form",{className:"".concat(v," grid gap-1 all-columns"),onSubmit:h(O),children:[(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)((0,y.Z)({label:"Date",type:"date"},o&&{min:(0,d._7)(o.startDate,"YYYY-MM-DD"),max:(0,d._7)(o.endDate,"YYYY-MM-DD")}),N("dateTime")),{},{required:!0,error:E.dateTime})),(0,I.jsx)("h3",{children:"Entries"}),(_||[]).map((function(e,t){return(0,I.jsxs)("div",{className:f,children:[(0,I.jsx)(d.hQ,{label:"Type",control:S,name:"entries_".concat(t,"_type"),formOptions:{required:!0},options:[{label:"Credit",value:"credit"},{label:"Debit",value:"debit"}],onChange:function(n){"credit"===n.value?(w("entries_".concat(t,"_debit")),M("entries_".concat(t,"_debit"),0),+e.debit&&M("entries_".concat(t,"_credit"),+e.debit||0)):(w("entries_".concat(t,"_credit")),M("entries_".concat(t,"_credit"),0),+e.credit&&M("entries_".concat(t,"_debit"),+e.credit||0)),p((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)((0,y.Z)({},t),{},{type:n.value},"debit"===n.value&&+e.credit&&{debit:+e.credit,credit:0}),"credit"===n.value&&+e.debit&&{credit:+e.debit,debit:0}):t}))}))}}),(0,I.jsx)(d.OC,{label:"Account",control:S,name:"entries_".concat(t,"_accountId"),formOptions:{required:!0},url:g.Hv.accountingMasters,getQuery:function(e){return{isGroup:"false",name:e||""}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(n){p((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{accountId:n.value}):t}))})),Y("entries_".concat(t,"_").concat(e.type))}}),(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)({label:"Debit",type:"number",step:"0.01",required:!0,disabled:"credit"===e.type},N("entries_".concat(t,"_debit"))),{},{onChange:function(n){w("entries_".concat(t,"_debit")),p((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{debit:n.target.value}):t}))}))},error:E["entries_".concat(t,"_debit")]})),(0,I.jsx)(d.II,(0,y.Z)((0,y.Z)({label:"Credit",type:"number",step:"0.01",required:!0,disabled:"debit"===e.type},N("entries_".concat(t,"_credit"))),{},{onChange:function(n){w("entries_".concat(t,"_credit")),p((function(t){return t.map((function(t){return t._id===e._id?(0,y.Z)((0,y.Z)({},t),{},{credit:n.target.value}):t}))}))},error:E["entries_".concat(t,"_credit")]})),(null===_||void 0===_?void 0:_.length)>1&&(0,I.jsx)("button",{type:"button",onClick:function(){return p((function(t){return t.filter((function(t){return t._id!==e._id}))}))},className:"btn clear iconOnly",children:(0,I.jsx)(Z.K3i,{})})]},e._id)})),!q&&(0,I.jsx)("button",{type:"button",className:"btn secondary",onClick:function(){M("entries_".concat(_.length,"_type"),"credit"),p((function(e){return[].concat((0,i.Z)(e),[{_id:Math.random().toString(36),type:"credit",accountId:"",debit:"",credit:""}])}))},children:"Add More Entry"}),(0,I.jsx)("hr",{}),(0,I.jsxs)("div",{className:f,children:[(0,I.jsx)("span",{}),(0,I.jsx)("span",{className:"text-right",children:"Total"}),(0,I.jsx)("span",{className:"text-right",children:_.reduce((function(e,t){return e+ +(t.debit||0)}),0)}),(0,I.jsx)("span",{className:"text-right",children:_.reduce((function(e,t){return e+ +(t.credit||0)}),0)})]}),(0,I.jsx)(d.gx,(0,y.Z)((0,y.Z)({label:"Detail"},N("detail")),{},{error:E.detail})),(0,I.jsx)("div",{className:"btns",children:(0,I.jsx)("button",{className:"btn",disabled:q,children:t?"Update":"Submit"})})]})})})},S=n(5804),Y=n(657),M=n(4316),k=function(e){var t=e.setSidebarOpen,n=(0,c.useContext)(a.D),m=n.config,f=n.checkPermission,x=(0,c.useState)([]),v=(0,r.Z)(x,2),y=v[0],D=v[1],N=(0,c.useState)(null),Z=(0,r.Z)(N,2),T=Z[0],k=Z[1],w=(0,c.useState)(!1),E=(0,r.Z)(w,2),P=E[0],A=E[1],F=(0,j.i)(g.Hv.journals),q=F.get,O=F.loading,H=(0,j.i)(g.Hv.journals+"/{ID}").remove;return(0,c.useEffect)((function(){q().then((function(e){var t=e.data;if(t.success)return D(t.data)})).catch((function(e){return(0,s.N)({type:"error",message:e.message})}))}),[]),(0,I.jsxs)("div",{className:"".concat(l," grid gap-1 m-a p-1"),children:[(0,I.jsx)("div",{className:"flex ".concat(p),children:(0,I.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return t((function(e){return!e}))},children:[(0,I.jsx)(S.Ps6,{style:{fontSize:"1.75rem"}}),(0,I.jsx)("h2",{children:"Journals"}),f("journal_create")&&(0,I.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),A(!0)},children:(0,I.jsx)(Y.ueT,{})})]})}),(0,I.jsx)(d.iA,{loading:O,className:u,columns:[{label:"Date"},{label:"No"},{label:"Account"},{label:"Debit",className:"text-right"},{label:"Credit",className:"text-right"},{label:"Action"}],children:y.map((function(e,t,n){var r,c,a;return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{className:"grid",children:(null===(r=n[t-1])||void 0===r?void 0:r.rec_id)!==e.rec_id&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.W7,{style:{fontSize:"14px"},format:"DD MMM YYYY",children:e.dateTime}),(0,I.jsx)(d.W7,{format:"hh:mma",children:e.dateTime})]})}),(0,I.jsx)("td",{children:(null===(c=n[t-1])||void 0===c?void 0:c.rec_id)!==e.rec_id&&e.no}),(0,I.jsx)("td",{className:b,children:e.accountName}),(0,I.jsx)("td",{className:"text-right",children:e.debit?e.debit.toFixed(2,null===m||void 0===m?void 0:m.numberSeparator):null}),(0,I.jsx)("td",{className:"text-right",children:e.credit?e.credit.fix(2,null===m||void 0===m?void 0:m.numberSeparator):null}),(null===(a=n[t-1])||void 0===a?void 0:a.rec_id)!==e.rec_id&&(0,I.jsx)(d.p2,{className:h,actions:[{icon:(0,I.jsx)(M.dou,{}),label:"Edit",onClick:function(){k({_id:e.rec_id,dateTime:e.dateTime,detail:e.detail,entries:n.filter((function(t){return t.rec_id===e.rec_id})).sort((function(e,t){return e.index>t.index?1:-1}))}),A(!0)}}].concat((0,i.Z)(f("journal_delete")?[{icon:(0,I.jsx)(o.lp8,{}),label:"Delete",onClick:function(){return(0,s.N)({type:"confirmation",message:"Are you sure you want to remove this entry?",callback:function(){H({},{params:{"{ID}":e.rec_id}}).then((function(t){var n=t.data;n.success?D((function(t){return t.filter((function(t){return t.rec_id!==e.rec_id}))})):(0,s.N)({type:"error",message:n.message})}))}})}}]:[]))})]},e._id)}))}),(0,I.jsx)(s.u,{open:P,head:!0,label:"".concat(T?"Update":"Add"," Journal Entries"),className:_,setOpen:function(){k(null),A(!1)},children:(0,I.jsx)(C,{edit:T,onSuccess:function(e){D((function(t){return[].concat((0,i.Z)(e),(0,i.Z)(t.filter((function(t){return t.rec_id!==e[0].rec_id})))).sort((function(e,t){return new Date(e.dateTime)>new Date(t.dateTime)?1:-1}))})),k(null),A(!1)}})})]})}}}]);
//# sourceMappingURL=323.479d00ea.chunk.js.map