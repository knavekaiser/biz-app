"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[370],{7370:function(e,n,a){a.r(n),a.d(n,{default:function(){return g}});var s=a(2982),t=a(885),r=a(2791),l=a(4581),o=a(5470),c=a(2202),i=a(8750),d={content:"roles_content__tl6km",roles:"roles_roles__oMihK",addRoleForm:"roles_addRoleForm__BDfmR",roleDetail:"roles_roleDetail__1IpCL",box:"roles_box__BONYt",noContent:"roles_noContent__6xbtV",permissions:"roles_permissions__pd3Gr",name:"roles_name__UVKZC",mainForm:"roles_mainForm__-oNRW",detail:"roles_detail__Xb27o",label:"roles_label__FKIn7",head:"roles_head__FJQYV",itemForm:"roles_itemForm__UoQF8",itemName:"roles_itemName__XhztT"},u=a(5454),m=a(1080),_=a(1413),p=a(1134),f=a(1570),h=a(184),b=f.Ry({name:f.Z_().required(),permissions:f.IX().of(f.Z_())}),x=function(e){var n=e.edit,a=e.dynamicTables,t=e.onSuccess,c=(0,r.useContext)(l.D).user,f=(0,p.cI)({resolver:(0,u.y)(b)}),x=f.handleSubmit,v=f.register,N=f.reset,g=f.watch,j=f.setValue,Z=f.formState.errors,y=(0,u.i)(m.Hv.roles+"/".concat((null===n||void 0===n?void 0:n._id)||"")),C=y.post,k=y.put,S=y.loading,F=g("permissions");return(0,r.useEffect)((function(){N({name:(null===n||void 0===n?void 0:n.name)||"",permissions:(null===n||void 0===n?void 0:n.permissions)||[]})}),[n]),(0,h.jsx)("div",{className:"grid gap-1 p-1 ".concat(d.addRoleForm),children:(0,h.jsxs)("form",{onSubmit:x((function(e){(n?k:C)(e).then((function(e){var n=e.data;if(!n.success)return(0,i.N)({type:"error",message:n.message});t(n.data)})).catch((function(e){return(0,i.N)({type:"error",message:e.message})}))})),className:"".concat(d.mainForm," grid gap-1"),children:[(0,h.jsx)("div",{className:d.box,children:(0,h.jsx)(o.II,(0,_.Z)((0,_.Z)({label:"Name"},v("name")),{},{required:!0,error:Z.name}))}),(0,h.jsxs)("div",{className:"".concat(d.box," all-columns"),children:[(0,h.jsx)("h3",{children:"Permissions"}),(0,h.jsx)(o.iA,{className:d.permissions,columns:[{label:"Table"},{label:"Read",className:"align-center"},{label:"Create",className:"align-center"},{label:"Update",className:"align-center"},{label:"Delete",className:"align-center"}],children:[].concat((0,s.Z)(m.EY),(0,s.Z)(a)).map((function(e,n){return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:d.name,children:e.label}),e.actions.map((function(n,a){var t="".concat(e.value,"_").concat(n||a),r=(0,h.jsx)("td",{className:"align-center",children:(0,h.jsx)(o.XZ,{checked:(F||[]).includes(t),disabled:"dynamic_table_read"===t&&(F||[]).some((function(e){return e.startsWith(c._id)}))||t.endsWith("_read")&&(F||[]).some((function(e){return e!==t&&e.startsWith(t.replace("_read",""))})),onChange:function(e){(F||[]).includes(t)?j("permissions",F.filter((function(e){return e!==t}))):j("permissions",(0,s.Z)(new Set([].concat((0,s.Z)(F||[]),(0,s.Z)(t.startsWith(c._id)?["dynamic_table_read"]:[]),(0,s.Z)(/^(.*)(create|update|delete)$/.test(t)?[t.replace(/(create|update|delete)$/,"read")]:[]),[t]))))}})},t);return 0===a&&"read"===n||1===a&&"create"===n||2===a&&"update"===n||3===a&&"delete"===n?r:(0,h.jsx)("td",{},"".concat(e.value,"_").concat(a))}))]},e.value)}))})]}),(0,h.jsx)("div",{className:"btns",children:(0,h.jsx)("button",{className:"btn",disabled:S,children:n?"Update":"Submit"})})]})})},v=a(5804),N=a(657),g=function(e){var n=e.setSidebarOpen,a=(0,r.useContext)(l.D).checkPermission,_=(0,r.useState)([]),p=(0,t.Z)(_,2),f=p[0],b=p[1],g=(0,r.useState)([]),j=(0,t.Z)(g,2),Z=j[0],y=j[1],C=(0,r.useState)(null),k=(0,t.Z)(C,2),S=k[0],F=k[1],R=(0,r.useState)(!1),D=(0,t.Z)(R,2),I=D[0],w=D[1],A=(0,u.i)(m.Hv.collections).get,V=(0,u.i)(m.Hv.roles),H=V.get,T=V.loading,U=(0,u.i)(m.Hv.roles+"/{ID}").remove;return(0,r.useEffect)((function(){A().then((function(e){var n=e.data;n.success&&b(n.data.map((function(e){return{label:e.name,value:"".concat(e.user,"_").concat(e.name),actions:["read","create","update","delete"]}})))})),H().then((function(e){var n=e.data;if(n.success)return y(n.data)})).catch((function(e){console.log(e),(0,i.N)({type:"error",message:e.message})}))}),[]),(0,h.jsxs)("div",{className:"".concat(d.content," grid gap-1 m-a"),children:[(0,h.jsx)("div",{className:"flex ".concat(d.head),children:(0,h.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return n((function(e){return!e}))},children:[(0,h.jsx)(v.Ps6,{style:{fontSize:"1.75rem"}}),(0,h.jsx)("h2",{children:"All Roles"}),a("role_create")&&(0,h.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),w(!0)},children:(0,h.jsx)(N.ueT,{})})]})}),(0,h.jsx)(o.iA,{loading:T,className:d.roles,columns:[{label:"Name"},{label:"Action"}],children:Z.map((function(e){return(0,h.jsxs)("tr",{onClick:function(){F(e),w(!0)},style:{cursor:"pointer"},children:[(0,h.jsx)("td",{className:d.date,children:e.name}),(0,h.jsx)(o.p2,{className:d.actions,actions:[].concat((0,s.Z)(a("role_update")?[{icon:(0,h.jsx)(c.KHI,{}),label:"View",onClick:function(){F(e),w(!0)}}]:[]),(0,s.Z)(a("role_delete")?[{icon:(0,h.jsx)(c.lp8,{}),label:"Delete",onClick:function(){return(0,i.N)({type:"confirmation",message:"Are you sure you want to remove this role?",callback:function(){U({},{params:{"{ID}":e._id}}).then((function(n){var a=n.data;a.success?y((function(n){return n.filter((function(n){return n._id!==e._id}))})):(0,i.N)({type:"error",message:a.message})}))}})}}]:[]))})]},e._id)}))}),(0,h.jsx)(i.u,{open:I,head:!0,label:"".concat(S?"View / Update":"Add"," Role"),className:d.addRoleFormModal,setOpen:function(){F(null),w(!1)},children:(0,h.jsx)(x,{edit:S,dynamicTables:f,onSuccess:function(e){S?(y((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),F(null)):y((function(n){return[].concat((0,s.Z)(n),[e])})),w(!1)}})})]})}}}]);
//# sourceMappingURL=370.91013b24.chunk.js.map