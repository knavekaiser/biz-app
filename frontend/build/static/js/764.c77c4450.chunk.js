"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[764],{9764:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var r=n(1413),a=n(2982),s=n(885),l=n(2791),i=n(5470),c=n(8750),o="quotes_content__d6QGt",u="quotes_innerWrapper__0o8+D",d="quotes_sidebar__OueuR",h="quotes_addButton__XE+Gn",m="quotes_btns__y2nuy",p="quotes_listItem__ityEv",x="quotes_label__VuSPM",f="quotes_accountName__zyenQ",v="quotes_nestedList__B-cIy",_="quotes_open__aa1x+",g="quotes_innerContent__wCHU6",b="quotes_innerContentWrapper__rKsb7",j="quotes_vouchers__t8sKZ",N="quotes_footer__AWxAV",y="quotes_analysysPlaceholder__0wx94",S="quotes_masterFormModal__36AN0",q="quotes_masterForm__dXJKs",C="quotes_head__uo7Hz",Z=n(5454),A=n(1080),k=n(1134),T=n(1570),D=n(184),F=T.Ry({name:T.Z_().required("Please enter a name"),parent:T.Z_(),type:T.Z_().oneOf(["Cash","Bank","Customers","Suppliers","Sales","Purchase","Stock","null","Tax",null]).nullable(),isGroup:T.O7().required(),openingBalance:T.Rx().required("Please enter opening balance").typeError("Please enter a valid number")}),I=function(e){var t=e.edit,n=e.masters,s=void 0===n?[]:n,o=e.onSuccess,u=(0,k.cI)({resolver:(0,Z.y)(F)}),d=u.handleSubmit,h=u.register,m=u.reset,p=u.control,x=u.formState.errors,f=(0,Z.i)(A.Hv.accountingMasters+"/".concat((null===t||void 0===t?void 0:t._id)||"")),v=f.post,_=f.put,g=f.loading;return(0,l.useEffect)((function(){var e;m({name:(null===t||void 0===t?void 0:t.name)||"",parent:(null===t||void 0===t?void 0:t.parent)||"null",type:(null===t||void 0===t?void 0:t.type)||"null",isGroup:null===(e=null===t||void 0===t?void 0:t.isGroup)||void 0===e||e,openingBalance:(null===t||void 0===t?void 0:t.openingBalance)||0})}),[t]),(0,D.jsxs)("form",{onSubmit:d((function(e){"null"===e.parent&&(e.parent=null),"null"===e.type&&(e.type=null),(null!==t&&void 0!==t&&t._id?_:v)(e).then((function(e){var t=e.data;if(!t.success)return(0,c.N)({type:"error",message:t.message});o(t.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))})),className:"".concat(q," grid gap-1"),children:[(0,D.jsx)(i.II,(0,r.Z)((0,r.Z)({label:"Name"},h("name")),{},{required:!0,error:x.name})),(0,D.jsx)(i.hQ,{label:"Parent",name:"parent",control:p,options:[{label:"None",value:"null"}].concat((0,a.Z)(s.map((function(e){return{label:e.name,value:e._id}}))))}),(0,D.jsx)(i.hQ,{label:"Type",name:"type",control:p,options:[{label:"None",value:"null"},{label:"Cash",value:"Cash"},{label:"Bank",value:"Bank"},{label:"Customers",value:"Customers"},{label:"Suppliers",value:"Suppliers"},{label:"Sales",value:"Sales"},{label:"Purchase",value:"Purchase"},{label:"Stock",value:"Stock"},{label:"Tax",value:"Tax"}]}),(0,D.jsx)(i.hQ,{label:"Is Group",name:"isGroup",control:p,formOptions:{required:!0},options:[{label:"No",value:!1},{label:"Yes",value:!0}]}),(0,D.jsx)(i.II,(0,r.Z)((0,r.Z)({label:"Opening Balance",type:"number"},h("openingBalance")),{},{required:!0,error:x.openingBalance})),(0,D.jsx)("div",{className:"btns",children:(0,D.jsx)("button",{className:"btn",disabled:g,children:null!==t&&void 0!==t&&t._id?"Update":"Submit"})})]})},M=n(5804),G=n(3974),P=n(1765),w=n(4794),B=function e(t){var n=t.account,r=t.setAddMaster,a=t.onClick,i=void 0===a?function(){}:a,o=(0,l.useState)([]),u=(0,s.Z)(o,2),d=u[0],_=u[1],g=(0,l.useState)(!1),b=(0,s.Z)(g,2),j=b[0],N=b[1],y=(0,Z.i)(A.Hv.accountingMasters),S=y.get,q=y.loading;return(0,l.useEffect)((function(){n.children&&(n.children.length&&n.totalChildren>n.children.length?S({query:{parent:n._id}}).then((function(e){var t=e.data;t.success?(_(t.data),N(!0)):(0,c.N)({type:"error",message:t.message})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})})):(_(n.children),N(!(null===n||void 0===n||!n.isGroup)&&n.children.length>0)))}),[n.children]),(0,D.jsxs)("li",{style:{whiteSpace:"nowrap"},className:p,children:[(0,D.jsxs)("div",{className:x,children:[n.isGroup&&(0,D.jsx)(D.Fragment,{children:((null===d||void 0===d?void 0:d.length)||n.totalChildren)>0?(0,D.jsx)("button",{onClick:function(){(null===d||void 0===d?void 0:d.length)===n.totalChildren?N(!j):S({query:{parent:n._id}}).then((function(e){var t=e.data;t.success?(_(t.data),N(!0)):(0,c.N)({type:"error",message:t.message})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))},children:q?(0,D.jsx)(w.frZ,{className:"spin"}):j?(0,D.jsx)(M.IgQ,{}):(0,D.jsx)(M.b5v,{})}):(0,D.jsx)("button",{style:{height:"16px",width:"16px",border:"1px dashed #818181",borderRadius:"2px",pointerEvents:"none"}})}),(0,D.jsx)("strong",{className:n.isGroup?"":f,onClick:function(){n.isGroup||i(n)},children:n.name}),(0,D.jsxs)("div",{className:m,children:[(0,D.jsx)("button",{className:h,onClick:function(){return r(n)},children:(0,D.jsx)(G.Nte,{})}),n.isGroup&&(0,D.jsx)("button",{className:h,onClick:function(){return r({parent:n._id,type:n.type||""})},children:(0,D.jsx)(M.iTs,{})})]})]}),j&&d.length>0&&(0,D.jsx)("ul",{className:v,children:d.map((function(t){return(0,D.jsx)(e,{account:t,setAddMaster:r,onClick:i},t._id)}))})]})},E=function(e){var t=e.account,n=e.rows;return(0,D.jsx)("div",{className:b,children:(null===n||void 0===n?void 0:n.length)>0?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("p",{style:{fontWeight:"600",fontSize:"1.2em"},className:"mt-1 pl_5",children:t.name}),(0,D.jsx)(i.iA,{className:j,columns:[{label:"Date"},{label:"No"},{label:"Type"},{label:"Account Name"},{label:"Debit",className:"text-right"},{label:"Credit",className:"text-right"}],tfoot:(0,D.jsx)("tfoot",{style:{marginTop:"0"},children:(0,D.jsxs)("tr",{className:N,children:[(0,D.jsx)("td",{}),(0,D.jsx)("td",{}),(0,D.jsx)("td",{}),(0,D.jsx)("td",{className:"text-right",children:"Total"}),(0,D.jsx)("td",{className:"text-right",children:n.reduce((function(e,t){return e+t.debit}),0).toFixed(2)}),(0,D.jsx)("td",{className:"text-right",children:n.reduce((function(e,t){return e+t.credit}),0).toFixed(2)})]})}),children:n.map((function(e,t,n){var r,a,s,l;return(0,D.jsxs)("tr",{children:[(0,D.jsx)("td",{className:"grid",children:e.createdAt&&(null===(r=n[t-1])||void 0===r?void 0:r.rec_id)!==e.rec_id&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(i.W7,{style:{fontSize:"14px"},format:"DD MMM YYYY",children:e.createdAt}),(0,D.jsx)(i.W7,{format:"hh:mma",children:e.createdAt})]})}),(0,D.jsx)("td",{children:(null===(a=n[t-1])||void 0===a?void 0:a.rec_id)!==e.rec_id&&e.no}),(0,D.jsx)("td",{children:(null===(s=n[t-1])||void 0===s?void 0:s.rec_id)!==e.rec_id&&e.type}),(0,D.jsx)("td",{className:"grid",children:(null===(l=e.details)||void 0===l?void 0:l.length)>0?"Details:":e.accountName}),(0,D.jsx)("td",{className:"text-right",children:e.debit?e.debit.toFixed(2):null}),(0,D.jsx)("td",{className:"text-right",children:e.credit?e.credit.toFixed(2):null})]},t)}))})]}):(0,D.jsx)("p",{className:y,children:"No account has been selected."})})},W=function(e){var t=e.setSidebarOpen,n=(0,l.useRef)(),m=(0,l.useState)(null),p=(0,s.Z)(m,2),x=p[0],f=p[1],v=(0,l.useState)([]),y=(0,s.Z)(v,2),q=y[0],k=y[1],T=(0,l.useState)("voucherListing"),F=(0,s.Z)(T,2),G=F[0],w=F[1],W=(0,l.useState)(!0),Y=(0,s.Z)(W,2),O=Y[0],R=Y[1],H=(0,l.useState)({}),Q=(0,s.Z)(H,2),z=Q[0],L=Q[1],V=(0,l.useState)([]),K=(0,s.Z)(V,2),U=K[0],X=K[1],J=(0,l.useState)({}),$=(0,s.Z)(J,2),ee=$[0],te=($[1],(0,Z.i)(A.Hv.accountingMasters).get),ne=(0,Z.i)(A.Hv.accountingVouchers).get,re=(0,l.useMemo)((function(){return function(e){var t={};e.forEach((function(e){e.children=[],t[e._id]=e}));var n=[];return e.forEach((function(e){if(e.parent){var r=t[e.parent];r&&r.children.push(e)}else n.push(e)})),n}(q)}),[q]);return(0,l.useEffect)((function(){te({query:{isGroup:"true"}}).then((function(e){var t=e.data;if(t.success)return k(t.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[]),(0,l.useEffect)((function(){ne({query:ee}).then((function(e){var t=e.data;t.success?X(t.data):(0,c.N)({type:"error",message:t.message})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[ee]),(0,D.jsxs)("div",{className:"".concat(o," grid gap-1 m-a"),children:[(0,D.jsx)("div",{className:"flex ".concat(C),children:(0,D.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return t((function(e){return!e}))},children:[(0,D.jsx)(M.Ps6,{style:{fontSize:"1.75rem"}}),(0,D.jsx)("h2",{children:"Accounting"})]})}),(0,D.jsxs)("div",{className:"".concat(u," ").concat(O?_:""),children:[(0,D.jsxs)("div",{className:d,children:[(0,D.jsx)("button",{className:h,onClick:function(){return f({})},children:(0,D.jsx)(M.iTs,{})}),(0,D.jsx)("ul",{children:q.length>0?re.map((function(e){return(0,D.jsx)(B,{account:e,setAddMaster:f,onClick:function(e){var t=(U||[]).filter((function(t){return t.accountId===e._id})),n=(U||[]).filter((function(e){return t.some((function(t){return t.rec_id===e.rec_id}))})),s=[].concat((0,a.Z)(t),(0,a.Z)(n)).filter((function(e,t,n){return t===n.findIndex((function(t){return t.rec_id===e.rec_id&&t.index===e.index}))})),l=s.filter((function(t){return t.accountId!==e._id})).reduce((function(e,t){var n=e.findIndex((function(e){return e.some((function(e){return e.rec_id===t.rec_id}))}));return-1===n?e.push([t]):e[n].push(t),e}),[]).map((function(e){var t=s.find((function(t){return t.rec_id===e[0].rec_id}));return e.length<=1?(0,r.Z)((0,r.Z)({},e[0]),{},{debit:t.debit,credit:t.credit}):(0,r.Z)((0,r.Z)({},e[0]),{},{details:e.map((function(e){return{label:e.accountName,value:e.credit||e.debit}})),debit:t.debit,credit:t.credit})})).sort((function(e,t){return new Date(e)>new Date(t)?1:-1})).sort((function(e,t){return e.index>t.index?1:-1})).reduce((function(e,t){var n;return null!==(n=t.details)&&void 0!==n&&n.length?e.push.apply(e,[t].concat((0,a.Z)(t.details.map((function(e){return{createdAt:null,no:null,type:null,accountName:(0,D.jsxs)("p",{children:[e.label,": ",e.value.toFixed(2)]}),debit:null,credit:null}}))))):e.push(t),e}),[]);L({account:e,rows:l}),w("analysys")}},e._id)})):(0,D.jsx)("p",{style:{marginTop:"1rem",marginBottom:"1rem",textAlign:"center",textWrap:"balance",color:"#797979"},children:"No accounts have been added yet."})})]}),(0,D.jsxs)("div",{className:g,children:[(0,D.jsxs)("div",{className:"flex gap-1 align-center",children:[(0,D.jsx)("button",{className:"btn clear iconOnly",onClick:function(){return R(!O)},children:(0,D.jsx)(P.kpB,{})}),(0,D.jsx)(i.mQ,{activeTab:G,tabs:[{label:"Voucher Listing",value:"voucherListing"},{label:"Accounting Analysys",value:"analysys"}],onChange:function(e){return w(e.value)}})]}),"voucherListing"===G&&(0,D.jsx)("div",{className:b,children:(0,D.jsx)(i.iA,{ref:n,url:A.Hv.accountingVouchers,countRecord:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t,n,r){var a;return e+((null===(a=r[n-1])||void 0===a?void 0:a.rec_id)!==t.rec_id?1:0)}),0)},filters:ee,filterFields:[{label:"Type",fieldType:"select",name:"type",optionType:"predefined",options:[{label:"Invoice",value:"Invoice"},{label:"Purchase",value:"Purchase"},{label:"Receipt",value:"Receipt"},{label:"Payment",value:"Payment"}]},{label:"Start Date",fieldType:"input",inputType:"datetime-local",name:"startDate"},{label:"End Date",fieldType:"input",inputType:"datetime-local",name:"endDate"}],className:j,columns:[{label:"Date"},{label:"No"},{label:"Type"},{label:"Account Name"},{label:"Debit",className:"text-right"},{label:"Credit",className:"text-right"}],tfoot:function(e){return(0,D.jsx)("tfoot",{children:(0,D.jsxs)("tr",{className:N,children:[(0,D.jsx)("td",{}),(0,D.jsx)("td",{}),(0,D.jsx)("td",{}),(0,D.jsx)("td",{className:"text-right",children:"Total"}),(0,D.jsx)("td",{className:"text-right",children:e.reduce((function(e,t){return e+t.debit}),0).toFixed(2)}),(0,D.jsx)("td",{className:"text-right",children:e.reduce((function(e,t){return e+t.credit}),0).toFixed(2)})]})})},children:U.map((function(e,t,n){var r,a,s;return(0,D.jsxs)("tr",{children:[(0,D.jsx)("td",{className:"grid",children:(null===(r=n[t-1])||void 0===r?void 0:r.rec_id)!==e.rec_id&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(i.W7,{style:{fontSize:"14px"},format:"DD MMM YYYY",children:e.createdAt}),(0,D.jsx)(i.W7,{format:"hh:mma",children:e.createdAt})]})}),(0,D.jsx)("td",{children:(null===(a=n[t-1])||void 0===a?void 0:a.rec_id)!==e.rec_id&&e.no}),(0,D.jsx)("td",{children:(null===(s=n[t-1])||void 0===s?void 0:s.rec_id)!==e.rec_id&&e.type}),(0,D.jsx)("td",{children:e.accountName}),(0,D.jsx)("td",{className:"text-right",children:e.debit?e.debit.toFixed(2):null}),(0,D.jsx)("td",{className:"text-right",children:e.credit?e.credit.toFixed(2):null})]},t)}))})}),"analysys"===G&&(0,D.jsx)(E,{account:null===z||void 0===z?void 0:z.account,rows:null===z||void 0===z?void 0:z.rows})]})]}),(0,D.jsx)(c.u,{open:x,head:!0,label:"".concat(null!==x&&void 0!==x&&x._id?"Update":"Add"," Account"),className:S,setOpen:function(){f(null)},children:(0,D.jsx)(I,{edit:x,masters:q,onSuccess:function(){te({query:{isGroup:"true"}}).then((function(e){var t=e.data;if(t.success)return k(t.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})})),f(!1)}})})]})}}}]);
//# sourceMappingURL=764.c77c4450.chunk.js.map