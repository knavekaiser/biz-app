"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[946],{2946:function(e,n,t){t.r(n),t.d(n,{default:function(){return Z}});var a=t(2982),s=t(885),r=t(2791),o=t(4581),c=t(5470),i=t(2202),u=t(8750),l={content:"payments_content__fxmFN",payments:"payments_payments__I+3-I",addPaymentForm:"payments_addPaymentForm__SDWDG",paymentDetail:"payments_paymentDetail__xy-nX",box:"payments_box__wH4Wj",noContent:"payments_noContent__PVIKj",items:"payments_items__9I0yz",name:"payments_name__bV1rI",itemForm:"payments_itemForm__kAg2N",btns:"payments_btns__v9AzH",mainForm:"payments_mainForm__V0IlH",mainFormWrapper:"payments_mainFormWrapper__6UkMn",purchaseTable:"payments_purchaseTable__q89RT",detail:"payments_detail__Unhs4",label:"payments_label__juauM",viewOnly:"payments_viewOnly__FSwhu",print:"payments_print__Kza04",logo:"payments_logo__cx6Pp",taxes:"payments_taxes__hBYTB",totalAmount:"payments_totalAmount__67k5i",word:"payments_word__hqHWi",digit:"payments_digit__t3vKo",sign:"payments_sign__AtFBp",signature:"payments_signature__zjvFf",head:"payments_head__LU0mZ",date:"payments_date__l5z0L",no:"payments_no__pR4rg",customer:"payments_customer__M0exN",net:"payments_net__yjdrZ",actions:"payments_actions__bj6Es",itemName:"payments_itemName__aTNSZ"},d=t(5454),m=t(1080),p=t(1413),f=t(1134),v=t(1570),h=t(1146),x=t(184),_=v.Ry({date:v.Z_().required(),amount:v.Rx().min(1,"Enter more than 0").required().typeError("Enter a valid amount"),supplierAccountId:v.Z_().required(),cashAccountId:v.Z_().required(),vendorDetail:v.Z_().required("Vendor detail is a required field")}),y=v.Ry({no:v.Z_().required(),amount:v.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),net:v.Rx(),due:v.Rx()}),b=function(e){var n=e.label,t=e.value,a=e.className;return(0,x.jsxs)("p",{className:"".concat(l.detail," ").concat(a||""),children:[(0,x.jsxs)("span",{className:l.label,children:[n,":"]})," ",(0,x.jsx)("span",{className:l.value,children:t})]})},j=function(e){var n=e.edit,t=e.setEdit,a=(e.payments,e.purchases),s=e.onSuccess,m=((0,r.useContext)(o.D).config,(0,f.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(y)})),v=m.handleSubmit,h=m.register,_=m.reset,b=(m.watch,m.setValue),j=m.control,g=m.formState.errors;return(0,r.useEffect)((function(){_((0,p.Z)({},n))}),[n]),(0,x.jsxs)("form",{onSubmit:v((function(e){if(n||(e._id=Math.random().toString().substr(-8)),e.amount>e.due)return(0,u.N)({type:"error",message:"Enter an amount less or equal to ".concat(e.due)});e.no=+e.no,s(e),_()})),className:"".concat(l.itemForm," grid gap-1"),children:[(0,x.jsx)(c.OC,{control:j,label:"Purchase No.",options:a.filter((function(e){return e.due})).map((function(e){return{label:"".concat(e.no,". ").concat((0,c._7)(e.dateTime,"DD-MM-YY")," Due: ").concat(e.due),value:e.no,data:e}})),name:"no",formOptions:{required:!0},onChange:function(e){"string"===typeof e||(b("no",e.data.no),b("due",e.data.due),b("net",e.data.net))},type:"number",className:l.itemName}),(0,x.jsx)(c.II,(0,p.Z)((0,p.Z)({label:"Net",type:"number"},h("net")),{},{readOnly:!0})),(0,x.jsx)(c.II,(0,p.Z)((0,p.Z)({label:"Due",type:"number"},h("due")),{},{readOnly:!0})),(0,x.jsx)(c.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},h("amount")),{},{error:g.amount})),n?(0,x.jsxs)("div",{className:"flex ".concat(l.btns),children:[(0,x.jsx)("button",{type:"submit",children:(0,x.jsx)(i.l_A,{})}),(0,x.jsx)("button",{type:"button",onClick:function(){return t(null)},children:(0,x.jsx)(i.aHS,{})})]}):(0,x.jsx)("button",{className:"btn",children:n?"Update":"Add"})]})},g=function(e){var n,t=e.purchases,v=e.edit,h=e.items,y=e.setItems,b=e.payments,g=e.setErr,A=e.onSuccess,S=(e.setViewOnly,(0,r.useContext)(o.D)),I=S.config,Z=(S.setConfig,(0,r.useState)(!(null===v||void 0===v||null===(n=v.purchases)||void 0===n||!n.length))),D=(0,s.Z)(Z,2),C=D[0],P=D[1],k=(0,r.useState)(null),E=(0,s.Z)(k,2),w=E[0],F=E[1],q=(0,r.useState)("table"),M=(0,s.Z)(q,2),Y=M[0],O=M[1],H=(0,f.cI)({resolver:(0,d.y)(_)}),T=H.handleSubmit,V=H.register,R=H.reset,W=H.setValue,z=H.watch,B=H.control,U=H.formState.errors,K=(0,d.i)(m.Hv.payments+"/".concat((null===v||void 0===v?void 0:v._id)||"")),G=K.post,Q=K.put,L=K.loading,X=(0,r.useCallback)((function(e){if(h.length>0){h.reduce((function(e,n){return e+n.net}),0);var n=h.reduce((function(e,n){return e+n.amount}),0);h.reduce((function(e,n){return e+n.due}),0);if(n>e.amount)return(0,u.N)({type:"error",message:"Adjusted amount (".concat(n,") can not be more than the payment amount.")})}(v?Q:G)({dateTime:e.date,amount:e.amount,type:e.type,supplierAccountId:e.supplierAccountId,supplierAccountName:e.supplierAccountName,cashAccountId:e.cashAccountId,cashAccountName:e.cashAccountName,vendor:{detail:e.vendorDetail},purchases:h.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{_id:void 0})}))}).then((function(e){var n=e.data;if(!n.success)return(0,u.N)({type:"error",message:n.message});A(n.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[h]),J=z("vendorName");return(0,r.useEffect)((function(){var e,n,t,a,s,r,o,i,u;R((0,p.Z)((0,p.Z)({},v),{},{date:(0,c._7)(null===v||void 0===v?void 0:v.date,"YYYY-MM-DD"),cashAccountId:(null===v||void 0===v||null===(e=v.accountingEntries)||void 0===e||null===(n=e[0])||void 0===n?void 0:n.accountId)||"",cashAccountName:(null===v||void 0===v||null===(t=v.accountingEntries)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.accountName)||"",supplierAccountId:(null===v||void 0===v||null===(s=v.accountingEntries)||void 0===s||null===(r=s[1])||void 0===r?void 0:r.accountId)||"",supplierAccountName:(null===v||void 0===v||null===(o=v.accountingEntries)||void 0===o||null===(i=o[1])||void 0===i?void 0:i.accountName)||"",vendorDetail:(null===v||void 0===v||null===(u=v.vendor)||void 0===u?void 0:u.detail)||""}))}),[v]),(0,x.jsxs)("div",{className:"".concat(l.mainForm," grid gap-1"),children:[(0,x.jsxs)("form",{className:"".concat(l.mainFormWrapper," grid gap-1 all-columns"),onSubmit:T(X),children:[(0,x.jsx)(c.II,(0,p.Z)((0,p.Z)({label:"Date",type:"date"},V("date")),{},{required:!0,error:U.date})),(0,x.jsx)(c.OC,{label:"Cash/Bank Account",control:B,name:"cashAccountId",formOptions:{required:!0},url:m.Hv.accountingMasters,getQuery:function(e){return{types:"Cash,Bank",isGroup:"false",name:e}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(e){var n;W("cashAccountName",null===(n=e.account)||void 0===n?void 0:n.name)}}),(0,x.jsx)(c.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},V("amount")),{},{error:U.amount})),(0,x.jsx)("div",{className:"all-columns",children:(0,x.jsx)("h3",{children:"Account Information"})}),(0,x.jsx)(c.OC,{label:"Supplier Account",control:B,name:"supplierAccountId",formOptions:{required:!0},url:m.Hv.accountingMasters,getQuery:function(e){return{isGroup:"false",name:e}},handleData:function(e){return{label:"".concat(e.name).concat(e.type?" - ".concat(e.type):""),value:e._id,account:e}},onChange:function(e){var n;W("supplierAccountName",null===(n=e.account)||void 0===n?void 0:n.name)}}),(0,x.jsx)(c.gx,(0,p.Z)({label:"Detail"},V("vendorDetail")))]}),(0,x.jsx)("div",{className:"all-columns flex justify-center",children:(0,x.jsxs)("button",{className:"btn",onClick:function(){P(!C),y([])},children:[C?"Clear":"Adjust"," Purchases"]})}),C&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Adjusted Purchases"}),(0,x.jsx)(c.mQ,{secondary:!0,activeTab:Y,onChange:function(e){return O(e.value)},tabs:[{label:"Purchase Table",value:"table"},{label:"Search Purchase",value:"search"}]})]}),C&&"table"===Y&&(t.filter((function(e){var n;return(null===(n=e.vendor)||void 0===n?void 0:n.name)===J&&(h.some((function(n){return n.no===e.no}))||e.due)})).length>0?(0,x.jsx)(c.iA,{className:l.purchaseTable,columns:[{label:"Purchase No"},{label:"Date"},{label:"Vendor"},{label:"Net",className:"text-right"},{label:"Due",className:"text-right"},{label:"Adjust"}],children:t.filter((function(e){var n;return(null===(n=e.vendor)||void 0===n?void 0:n.name)===J&&(h.some((function(n){return n.no===e.no}))||e.due)})).map((function(e){return(0,x.jsx)(N,{purchase:e,config:I,items:h,setItems:y},e._id)}))}):(0,x.jsx)("p",{className:l.noContent,children:"No pending purchase from selected vendor."})),C&&"search"===Y&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(j,{purchases:t.filter((function(e){var n;return(null===(n=e.vendor)||void 0===n?void 0:n.name)===J})),edit:w,setEdit:F,payments:b,onSuccess:function(e){if(g(null),w)y((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),F(null);else{if(h.some((function(n){return n.no.toString()===e.no.toString()})))return(0,u.N)({type:"error",message:"Purchase has already been added."});y((function(n){return[].concat((0,a.Z)(n),[e])}))}}},w?"edit":"add"),h.length>0?(0,x.jsx)(c.iA,{className:l.items,columns:[{label:"Purchase No."},{label:"Amount",className:"text-right"},{label:"Action",action:!0}],children:h.map((function(e,n){return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:l.name,children:(0,x.jsx)("span",{className:"ellipsis",children:e.no})}),(0,x.jsx)("td",{className:"text-right",children:e.amount.fix(2,null===I||void 0===I?void 0:I.numberSeparator)}),(0,x.jsx)(c.p2,{actions:[{icon:(0,x.jsx)(i.KHI,{}),label:"Edit",onClick:function(){return F(e)}},{icon:(0,x.jsx)(i.lp8,{}),label:"Delete",onClick:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){y((function(n){return n.filter((function(n){return n._id!==e._id}))}))}})}}]})]},n)}))}):(0,x.jsx)("p",{className:l.noContent,children:"No purchases selected."})]}),(0,x.jsx)("form",{className:"".concat(l.btnsWrapper," grid gap-1 all-columns"),onSubmit:T(X),children:(0,x.jsx)("div",{className:"btns",children:(0,x.jsx)("button",{className:"btn",disabled:w||L,children:v?"Update":"Submit"})})})]})},N=function(e){var n,t,o,i=e.purchase,u=e.items,d=e.setItems,m=e.config,p=(0,r.useState)((null===(n=u.find((function(e){return e.no===i.no})))||void 0===n?void 0:n.amount)||""),f=(0,s.Z)(p,2),v=f[0],h=f[1];return(0,r.useEffect)((function(){var e;h((null===(e=u.find((function(e){return e.no===i.no})))||void 0===e?void 0:e.amount)||"")}),[u]),(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{children:[i.no,(null===m||void 0===m||null===(t=m.print)||void 0===t?void 0:t.purchaseNoSuffix)||""]}),(0,x.jsx)("td",{className:l.date,children:(0,x.jsx)(c.W7,{format:"DD/MM/YYYY",children:i.date})}),(0,x.jsx)("td",{className:l.vendor,children:null===(o=i.vendor)||void 0===o?void 0:o.name}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:i.net.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:i.due.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{children:(0,x.jsx)(c.II,{placeholder:"Adjust",type:"number",onBlur:function(e){var n=+e.target.value||0;if(n<=0)return e.target.value="",void d((function(e){return(0,a.Z)(e.filter((function(e){return e.no!==i.no})))}));i.due&&d((function(e){return[].concat((0,a.Z)(e.filter((function(e){return e.no!==i.no}))),[{_id:Math.random().toString().substr(-8),no:i.no,due:i.due,net:i.net,amount:Math.min(n,i.due)}])}))},value:v,onChange:function(e){return h(e.target.value)}})})]})},A=function(e){var n,t,a,i,u,f=e.edit,v=e.payments,_=e.onSuccess,y=(0,r.useContext)(o.D),j=(y.user,y.config),N=y.checkPermission,A=(0,r.useState)(!!f),S=(0,s.Z)(A,2),I=S[0],Z=S[1],D=(0,r.useState)((null===f||void 0===f?void 0:f.purchases)||[]),C=(0,s.Z)(D,2),P=C[0],k=C[1],E=(0,r.useState)(null),w=(0,s.Z)(E,2),F=w[0],q=w[1],M=(0,r.useRef)(),Y=((0,h.useReactToPrint)({content:function(){return M.current}}),(0,r.useState)([])),O=(0,s.Z)(Y,2),H=O[0],T=O[1],V=(0,d.i)(m.Hv.purchases).get;return(0,r.useEffect)((function(){V().then((function(e){var n=e.data;null!==n&&void 0!==n&&n.success&&T(n.data.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{due:e.due.fix(2),net:e.items.reduce((function(e,n){return e+n.qty*n.price}),0)+e.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(e.gst)})})))}))}),[]),(0,x.jsxs)("div",{className:"grid gap-1 p-1 ".concat(l.addPaymentForm," ").concat(I?l.viewOnly:""),children:[I&&(0,x.jsxs)("div",{className:"flex wrap gap-1 ".concat(l.paymentDetail),children:[(0,x.jsx)("div",{className:"flex gap-1 all-columns justify-end align-center",children:N("payment_update")&&(0,x.jsx)("button",{className:"btn",onClick:function(){return Z(!1)},children:"Edit"})}),(0,x.jsxs)("div",{className:l.box,children:[(0,x.jsx)("h3",{children:"Account Information"}),(0,x.jsx)(b,{label:"Name",value:null===(n=f.accountingEntries)||void 0===n||null===(t=n[0])||void 0===t?void 0:t.accountName}),(0,x.jsx)(b,{label:"Detail",value:(null===(a=f.vendor)||void 0===a||null===(i=a.detail)||void 0===i?void 0:i.split("\n").map((function(e,n,t){return(0,x.jsxs)("span",{children:[e,t[n+1]&&(0,x.jsx)("br",{})]},n)})))||null})]}),(0,x.jsxs)("div",{className:l.box,children:[(0,x.jsx)("h3",{children:"Payment Information"}),(0,x.jsx)(b,{label:"Inv No",className:"flex justify-space-between",value:"".concat(f.no).concat((null===j||void 0===j||null===(u=j.print)||void 0===u?void 0:u.paymentNoSuffix)||"")}),(0,x.jsx)(b,{label:"Date",className:"flex justify-space-between",value:(0,c._7)(null===f||void 0===f?void 0:f.date,"DD-MM-YYYY")}),(0,x.jsx)(b,{label:"Amount",value:f.amount.fix(2,null===j||void 0===j?void 0:j.numberSeparator),className:"flex justify-space-between"}),(0,x.jsx)(b,{label:"Adjusted",value:f.purchases.reduce((function(e,n){return e+n.amount}),0).fix(2,null===j||void 0===j?void 0:j.numberSeparator),className:"flex justify-space-between"})]})]}),F&&(0,x.jsx)("p",{className:"error",children:F}),!1,!I&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Payment Information"}),(0,x.jsx)(g,{purchases:H,edit:f,items:P,setItems:k,payments:v,setErr:q,onSuccess:_,setViewOnly:Z})]})]})},S=t(5804),I=t(657),Z=function(e){var n=e.setSidebarOpen,t=(0,r.useContext)(o.D),p=t.config,f=t.checkPermission,v=(0,r.useState)([]),h=(0,s.Z)(v,2),_=h[0],y=h[1],b=(0,r.useState)(null),j=(0,s.Z)(b,2),g=j[0],N=j[1],Z=(0,r.useState)(!1),D=(0,s.Z)(Z,2),C=D[0],P=D[1],k=(0,d.i)(m.Hv.payments),E=k.get,w=k.loading,F=(0,d.i)(m.Hv.payments+"/{ID}").remove;return(0,r.useEffect)((function(){E().then((function(e){var n=e.data;if(n.success)return y(n.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[]),(0,x.jsxs)("div",{className:"".concat(l.content," grid gap-1 m-a p-1"),children:[(0,x.jsx)("div",{className:"flex ".concat(l.head),children:(0,x.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return n((function(e){return!e}))},children:[(0,x.jsx)(S.Ps6,{style:{fontSize:"1.75rem"}}),(0,x.jsx)("h2",{children:"All Payments"}),f("payment_create")&&(0,x.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),P(!0)},children:(0,x.jsx)(I.ueT,{})})]})}),(0,x.jsx)(c.iA,{loading:w,className:l.payments,columns:[{label:"No."},{label:"Date"},{label:"Account"},{label:"Amount",className:"text-right"},{label:"Action"}],children:_.map((function(e){var n,t,s;return(0,x.jsxs)("tr",{onClick:function(){N(e),P(!0)},style:{cursor:"pointer"},children:[(0,x.jsxs)("td",{className:l.no,children:[e.no,(null===p||void 0===p||null===(n=p.print)||void 0===n?void 0:n.paymentNoSuffix)||""]}),(0,x.jsx)("td",{className:l.date,children:(0,x.jsx)(c.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,x.jsx)("td",{className:l.customer,children:null===(t=e.accountingEntries)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.accountName}),(0,x.jsx)("td",{className:"text-right ".concat(l.net),children:e.amount.fix(2,null===p||void 0===p?void 0:p.numberSeparator)}),(0,x.jsx)(c.p2,{className:l.actions,actions:[{icon:(0,x.jsx)(i.z5B,{}),label:"View",onClick:function(){N(e),P(!0)}}].concat((0,a.Z)(f("payment_delete")?[{icon:(0,x.jsx)(i.lp8,{}),label:"Delete",onClick:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this payment?",callback:function(){F({},{params:{"{ID}":e._id}}).then((function(n){var t=n.data;t.success?y((function(n){return n.filter((function(n){return n._id!==e._id}))})):(0,u.N)({type:"error",message:t.message})}))}})}}]:[]))})]},e._id)}))}),(0,x.jsx)(u.u,{open:C,head:!0,label:"".concat(g?"View / Update":"Add"," Payment"),className:l.addPaymentFormModal,setOpen:function(){N(null),P(!1)},children:(0,x.jsx)(A,{edit:g,payments:_,onSuccess:function(e){g?(y((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),N(null)):y((function(n){return[].concat((0,a.Z)(n),[e])})),P(!1)}})})]})}}}]);
//# sourceMappingURL=946.e6681090.chunk.js.map