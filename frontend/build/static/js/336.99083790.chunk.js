"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[336],{3336:function(e,n,a){a.r(n),a.d(n,{default:function(){return L}});var t=a(2982),l=a(885),i=a(2791),o=a(6871),r=a(5454),c=a(8750),s=a(1080),u=a(5470),d=a(2202),m={content:"payments_content__Ns1jT",collections:"payments_collections__toFwA",tableName:"payments_tableName__LtE-y",payments:"payments_payments__Ah4-6",addCollectionForm:"payments_addCollectionForm__Ai7TF",purchaseDetail:"payments_purchaseDetail__2IPjB",box:"payments_box__HonET",noContent:"payments_noContent__PizGe",items:"payments_items__7K7xf",name:"payments_name__h5Zd+",optionsWrapper:"payments_optionsWrapper__BvcZy",options:"payments_options__FrHMH",mainForm:"payments_mainForm__41jE7",detail:"payments_detail__fShIJ",label:"payments_label__qqvVF",viewOnly:"payments_viewOnly__krh-4",collectionFormModal:"payments_collectionFormModal__ZL2ka",dynamicForm:"payments_dynamicForm__LQdVa",productVariants:"payments_productVariants__Bs7CM",images:"payments_images__nGbFF",selected:"payments_selected__yPSWZ",products:"payments_products__KBzMQ",product:"payments_product__0R1U4",thumbnail:"payments_thumbnail__FhwYr",productDetail:"payments_productDetail__L6dkO",price:"payments_price__ayXD7",subtotal:"payments_subtotal__5vfe6",variantForm:"payments_variantForm__84Cje",variantImages:"payments_variantImages__Ia1Tz",fieldFormWrapper:"payments_fieldFormWrapper__1WfTf",dataDetail:"payments_dataDetail__EYaJH",inputDetail:"payments_inputDetail__ybl03",fieldForm:"payments_fieldForm__ABEcg",fields:"payments_fields__igOtL",nestedObjectFormModal:"payments_nestedObjectFormModal__bwoUE",dynamicFormModal:"payments_dynamicFormModal__Q+p0k"},p=a(1413),f=a(1134),b=a(1570),v=a(184);b.kM(b.Z_,"noneOf",(function(e,n){return this.test("noneOf",n,(function(a){var t=this.path,l=this.createError;return!e.includes(a)||l({path:t,message:(null===n||void 0===n?void 0:n.replace("{value}",a))||n})}))}));var y=b.Ry({name:b.Z_().required()}),x=b.Ry({label:b.Z_().required(),value:b.Z_().required()}),h=["title","description","images","price","whatsappNumber","category","subcategory"],j=function(e){var n,a,o,c=e.edit,d=e.fields,y=e.editCollection,x=e.collections,j=e.onSuccess,T=e.clear,Z=(0,f.cI)({resolver:(0,r.y)(b.Ry({name:b.Z_().noneOf(d.filter((function(e){return!c||c.name!==e.name})).map((function(e){return e.name})),"{value} already exists").required(),dataType:b.Z_().required(),label:b.Z_().required(),fieldType:b.Z_(),inputType:b.Z_(),required:b.O7()}))}),N=Z.handleSubmit,S=Z.register,C=Z.reset,F=Z.watch,O=Z.setValue,q=Z.control,I=Z.formState.errors,D=F("name"),w=F("inputType"),k=F("dataType"),A=F("dataElementType"),E=F("fields"),P=F("collection"),M=F("fieldType"),V=F("optionType"),H=F("options"),L=F("label");(0,i.useEffect)((function(){"Product"===(null===y||void 0===y?void 0:y.name)&&"latlng"===D&&(O("dataType","string"),O("fieldType","googleMap"),O("label","Location"))}),[D,y]);var R=(0,i.useCallback)((function(e){if("Product"===(null===y||void 0===y?void 0:y.name)){var n={};Object.entries(e).forEach((function(e){var a=(0,l.Z)(e,2),t=a[0],i=a[1];("subcategory"===t&&!h.filter((function(e){return"subcategory"!==e})).includes(t)||"subcategory"!==t)&&(n[t]=i)})),j(n)}else j(e);C({category:"",subcategory:"",name:"",inputType:"",dataType:"",dataElementType:"",dataElements:"",collection:"",fieldType:"",optionType:"",options:[],multiRange:"",label:"",required:"",decimalPlaces:"",unique:""})}),[c]);return(0,i.useEffect)((function(){C((0,p.Z)({},c))}),[c]),(0,v.jsxs)("div",{className:m.fieldFormWrapper,children:[(0,v.jsxs)("div",{className:m.dataDetail,children:[(0,v.jsxs)("form",{onSubmit:N(R),className:"".concat(m.fieldForm," grid gap-1"),children:[(0,v.jsxs)("div",{className:"flex all-columns gap-1 justify-space-between align-center",children:[(0,v.jsx)("h3",{children:"Data"}),"Product"===(null===y||void 0===y?void 0:y.name)&&!h.includes(D)&&(0,v.jsx)(u.OC,{label:"Subcategory",control:q,url:s.Hv.dynamic+"/Subcategory",getQuery:function(e,n){return(0,p.Z)((0,p.Z)({},e&&{name:e}),n&&{name:n})},handleData:function(e){return{label:e.name,value:e.name}},name:"subcategory"}),(0,v.jsx)(u.XZ,(0,p.Z)((0,p.Z)({},S("unique")),{},{label:"Unique"}))]}),(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({label:"Field Name",type:"text",required:!0,disabled:c},S("name")),{},{error:I.name})),(0,v.jsx)(u.hQ,{label:"Data Type",name:"dataType",control:q,formOptions:{required:!0},options:[{label:"String",value:"string"},{label:"Number",value:"number"},{label:"Date",value:"date"},{label:"Boolean",value:"boolean"},{label:"Array",value:"array"},{label:"Variant Array",value:"variantArray"},{label:"Object",value:"object"},{label:"Object ID",value:"objectId"}],disabled:c||["richText","googleMap"].includes(M)}),"objectId"===k&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.OC,{control:q,label:"Collection",options:x.filter((function(e){return e._id!==(null===y||void 0===y?void 0:y._id)})).map((function(e){return{label:e.name,value:e.name}})),name:"collection",formOptions:{required:!0},className:m.itemName}),P&&(0,v.jsx)(u.hQ,{label:"Foreign Field",name:"foreignField",control:q,formOptions:{required:!0},options:[{label:"ID",value:"_id"}].concat((0,t.Z)((null===(n=x.find((function(e){return e.name===P})))||void 0===n?void 0:n.fields.map((function(e){return{label:e.label,value:e.name}})))||[]))})]}),["array","variantArray"].includes(k)&&(0,v.jsx)(u.hQ,{label:"Data Element Type",name:"dataElementType",control:q,formOptions:{required:!0},options:[{label:"String",value:"string"},{label:"Number",value:"number"},{label:"Date",value:"date"},{label:"Object",value:"object"}]})]}),"object"===k&&!["includeProducts","excludeProducts"].includes(D)&&(0,v.jsx)(g,{name:L||D,value:E,setValue:function(e){return O("objectFields",e)},collection:y,collections:x}),["array","variantArray"].includes(k)&&"object"===A&&(0,v.jsx)(g,{name:L||D,value:E,setValue:function(e){return O("fields",e)},collection:y,collections:x})]}),(0,v.jsxs)("div",{className:m.inputDetail,children:[(0,v.jsxs)("form",{onSubmit:N(R),className:"".concat(m.fieldForm," grid gap-1"),children:[(0,v.jsxs)("div",{className:"flex all-columns justify-space-between align-center",children:[(0,v.jsx)("h3",{className:"all-columns",children:"Input Field"}),(0,v.jsx)(u.XZ,(0,p.Z)((0,p.Z)({},S("required")),{},{label:"Required"}))]}),(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({label:"Label",type:"text",required:!0},S("label")),{},{error:I.label})),!(["array","variantArray"].includes(k)&&"object"===A)&&(0,v.jsx)(u.hQ,{label:"Field Type",name:"fieldType",control:q,formOptions:{required:!0},options:[{label:"Input",value:"input"},{label:"Textarea",value:"textarea"},{label:"Rich Text",value:"richText"},{label:"Combobox",value:"combobox"},{label:"Autocomplete",value:"select"},{label:"Date Range",value:"dateRange"},{label:"Google Map",value:"googleMap"},{label:"Collection Filter",value:"collectionFilter"},{label:"None",value:"none"}],onChange:function(e){"richText"===(null===e||void 0===e?void 0:e.value)?O("dataType","object"):"googleMap"===(null===e||void 0===e?void 0:e.value)&&O("dataType","string")}}),!(["combobox","textarea","richText","collectionFilter","none","googleMap"].includes(M)||["array","variantArray"].includes(k)&&"object"===A||["includeProducts","excludeProducts"].includes(D)&&"object"===k)&&(0,v.jsx)(u.hQ,{label:"Input Type",name:"inputType",control:q,options:"dateRange"===M?[{label:"Calendar",value:"calendar"}]:[{label:"Text",value:"text"},{label:"Number",value:"number"}].concat((0,t.Z)("select"!==M?[{label:"Phone Number",value:"phone"},{label:"Date",value:"date"},{label:"File",value:"file"},{label:"Calendar",value:"calendar"},{label:"Password",value:"password"}]:[]))}),"number"===w&&(0,v.jsx)(u.hQ,{label:"Decimal Places",name:"decimalPlaces",control:q,options:[{label:"1",value:"0"},{label:"1.0",value:"0.0"},{label:"1.00",value:"0.00"},{label:"1.000",value:"0.000"},{label:"1.0000",value:"0.0000"},{label:"1.00000",value:"0.00000"}]}),["combobox","select"].includes(M)&&(0,v.jsx)(u.hQ,{label:"Options type",name:"optionType",control:q,formOptions:{required:!0},options:[{label:"Predefined",value:"array"},{label:"Other Collection",value:"collection",disabled:"combobox"===M}]}),["collection"].includes(V)&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.OC,{control:q,label:"Collection",options:x.filter((function(e){return e._id!==(null===y||void 0===y?void 0:y._id)})).map((function(e){return{label:e.name,value:e.name}})),name:"collection",formOptions:{required:!0},className:m.itemName}),P&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.hQ,{label:"Option Label",name:"optionLabel",control:q,formOptions:{required:!0},options:[{label:"ID",value:"_id"}].concat((0,t.Z)((null===(a=x.find((function(e){return e.name===P})))||void 0===a?void 0:a.fields.map((function(e){return{label:e.label,value:e.name}})))||[]))}),(0,v.jsx)(u.hQ,{label:"Option Value",name:"optionValue",control:q,formOptions:{required:!0},options:[{label:"ID",value:"_id"}].concat((0,t.Z)((null===(o=x.find((function(e){return e.name===P})))||void 0===o?void 0:o.fields.map((function(e){return{label:e.label,value:e.name}})))||[]))})]})]})]}),["combobox","select"].includes(M)&&"array"===V&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("h3",{children:[L," Options"]}),(0,v.jsx)(_,{dataType:k,options:H,setOptions:function(e){return O("options",e)}})]}),(0,v.jsxs)("form",{onSubmit:N(R),className:"".concat(m.fieldForm," grid gap-1"),children:[(["file"].includes(w)||["select","combobox"].includes(M))&&(0,v.jsx)(u.XZ,(0,p.Z)((0,p.Z)({},S("multiple")),{},{label:"Multiple"})),"calendar"===w&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.hQ,{label:"Date Window",name:"dateWindow",control:q,options:[{label:"All time",value:"allTime"},{label:"Past including Today",value:"pastIncludingToday"},{label:"Past excluding Today",value:"pastExcludingToday"},{label:"Future including Today",value:"futureIncludingToday"},{label:"Future excluding Today",value:"futureExcludingToday"}]}),(0,v.jsx)(u.hQ,{label:"Multiple Range",name:"multipleRanges",control:q,options:[{label:"Yes",value:!0},{label:"No",value:!1}]})]})]}),(0,v.jsxs)("form",{onSubmit:N(R),className:"flex gap-1 justify-center",children:[c&&(0,v.jsx)("button",{className:"btn",type:"button",onClick:T,children:"Clear"}),(0,v.jsxs)("button",{className:"btn",children:[c?"Update":"Add"," Field"]})]})]})]})},g=function(e){var n=e.name,a=e.value,o=void 0===a?[]:a,r=e.setValue,s=e.collection,p=e.collections,f=(0,i.useState)(null),b=(0,l.Z)(f,2),y=b[0],x=b[1],h=(0,i.useState)(null),g=(0,l.Z)(h,2),_=g[0],T=g[1];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"flex justify-space-between align-center",children:[(0,v.jsxs)("h3",{children:[n," Fields"]}),(0,v.jsxs)("button",{className:"btn",onClick:function(){return T(!0)},children:["Add ",n," Field"]})]}),(0,v.jsx)(u.iA,{className:m.fields,columns:[{label:"Name"},{label:"Data Type"},{label:"Label"},{label:"Field Type"},{label:"Input Type"},{label:"Required"},{label:"Action",action:!0}],placeholder:"No fields yet.",children:o.map((function(e,n){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"ellipsis",children:e.name})}),(0,v.jsx)("td",{children:e.dataType}),(0,v.jsx)("td",{children:e.label}),(0,v.jsx)("td",{children:e.fieldType}),(0,v.jsx)("td",{children:e.inputType}),(0,v.jsx)("td",{children:e.required?"Yes":"No"}),(0,v.jsx)(u.p2,{actions:[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){x(e),T(!0)}},{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Field?",callback:function(){r(o.filter((function(n){return n.name!==e.name})))}})}}]})]},n)}))}),(0,v.jsx)(c.u,{head:!0,label:"".concat(y?"Update":"Add"," ").concat(n," Field"),open:_,setOpen:function(){T(!1),x(null)},className:m.nestedObjectFormModal,children:(0,v.jsx)(j,{edit:y,fields:o,editCollection:s,collections:p,productCollection:p.find((function(e){return"Product"===(null===e||void 0===e?void 0:e.name)})),onSuccess:function(e){y?(r(o.map((function(n){return n.name.toLowerCase()===e.name.toLowerCase()?e:n}))),x(null)):r([].concat((0,t.Z)(o),[e])),T(!1)},clear:function(){return x(null)}},y?"edit":"add")})]})},_=function(e){var n=e.dataType,a=e.options,o=e.setOptions,r=(0,i.useState)(null),s=(0,l.Z)(r,2),p=s[0],f=s[1];return(0,v.jsx)("section",{className:m.optionsWrapper,children:(0,v.jsxs)(u.iA,{className:"".concat(m.options),columns:[{label:"Label"},{label:"Value"},{label:"Action"}],children:[(0,v.jsx)("tr",{className:"inlineForm",children:(0,v.jsx)("td",{children:(0,v.jsx)(T,{dataType:n,edit:p,onSuccess:function(e){o(p?(a||[]).map((function(n){return n._id===e._id?e:n})):[e].concat((0,t.Z)(a||[]))),f(null)},clearForm:function(){return f(null)}})})}),null===a||void 0===a?void 0:a.map((function(e,n){var t;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.label}),(0,v.jsx)("td",{children:null===(t=e.value)||void 0===t?void 0:t.toString()}),(0,v.jsx)(u.p2,{actions:[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){f(e)}},{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Option?",callback:function(){o((a||[]).filter((function(n){return n._id!==e._id})))}})}}]})]},n)}))]})})},T=function(e){var n=e.dataType,a=e.edit,t=e.onSuccess,l=e.clearForm,o=(0,f.cI)({resolver:(0,r.y)(x)}),c=o.handleSubmit,s=o.register,m=o.formState.errors,b=o.reset;return(0,i.useEffect)((function(){b({label:(null===a||void 0===a?void 0:a.label)||"",value:(null===a||void 0===a?void 0:a.value)||""})}),[a]),(0,v.jsxs)("form",{onSubmit:c((function(e){"boolean"===n?e.value=["1",1,"true"].includes(e.value.toLowerCase()):"number"===n&&(e.value=+e.value),t((0,p.Z)((0,p.Z)({},e),{},{_id:(null===a||void 0===a?void 0:a._id)||Math.random().toString(36).substr(-8)})),b()})),children:[(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({},s("label")),{},{placeholder:"Label",error:m.label})),(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({},s("value")),{},{placeholder:"Value",error:m.value})),(0,v.jsxs)("section",{className:"btns",children:[(0,v.jsx)("button",{className:"btn clear border iconOnly",type:"submit",children:a?(0,v.jsx)(d.l_A,{}):(0,v.jsx)(d.wEH,{})}),a&&(0,v.jsx)("button",{className:"btn clear border iconOnly",type:"button",onClick:function(){l()},children:(0,v.jsx)(d.aHS,{})})]})]})},Z=function(e){var n=e.edit,a=e.collections,o=e.onSuccess,b=(0,i.useState)((null===n||void 0===n?void 0:n.fields)||[]),x=(0,l.Z)(b,2),h=x[0],g=x[1],_=(0,i.useState)(null),T=(0,l.Z)(_,2),Z=T[0],N=T[1],S=(0,i.useState)(null),C=(0,l.Z)(S,2),F=C[0],O=C[1],q=(0,f.cI)({resolver:(0,r.y)(y)}),I=q.handleSubmit,D=q.register,w=q.reset,k=(q.setValue,q.watch),A=q.formState.errors,E=q.setError,P=(0,r.i)(s.Hv.collections+"/".concat((null===n||void 0===n?void 0:n._id)||"")),M=P.post,V=P.put,H=(P.loading,k("name")),L=(0,i.useCallback)((function(e){if(!e.name&&H&&(e.name=H),e.name){if(h.length<1)return O("Add at least one field");if("Product"===e.name){if(!h.find((function(e){return"images"===e.name})))return O('"images" is a required field');if(!h.find((function(e){return"title"===e.name})))return O('"title" is a required field');if(!h.find((function(e){return"price"===e.name})))return O('"price" is a required field');if(!h.find((function(e){return"whatsappNumber"===e.name})))return O('"whatsappNumber" is a required field')}(n?V:M)({name:e.name,fields:h.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{_id:void 0})}))}).then((function(e){var n=e.data;if(!n.success)return(0,c.N)({type:"error",message:n.message});o(n.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}else E("name",{type:"required",message:"Table name is required"})}),[h,H]);return(0,i.useEffect)((function(){h.length>0&&JSON.stringify(h)!==JSON.stringify((null===n||void 0===n?void 0:n.fields)||[])&&L({name:(null===n||void 0===n?void 0:n.name)||""})}),[h,n]),(0,i.useEffect)((function(){w((0,p.Z)({},n))}),[n]),(0,v.jsxs)("div",{className:"grid gap-1 p-1 ".concat(m.addCollectionForm),children:[(0,v.jsx)("h3",{children:"Table Information"}),(0,v.jsx)("form",{onSubmit:I(L),className:"".concat(m.mainForm," grid gap-1"),children:(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({label:"Table Name (singular)",type:"text"},D("name")),{},{required:!0,readOnly:n,error:A.name}))}),(0,v.jsx)("h3",{children:"Fields"}),(0,v.jsx)(u.iA,{className:m.fields,columns:[{label:"Name"}].concat((0,t.Z)("Product"===(null===n||void 0===n?void 0:n.name)?[{label:"Subcategory"}]:[]),[{label:"Data Type"},{label:"Label"},{label:"Field Type"},{label:"Input Type"},{label:"Required"},{label:"Action",action:!0}]),placeholder:"No fields yet.",children:h.map((function(e,a){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"ellipsis",children:e.name})}),"Product"===(null===n||void 0===n?void 0:n.name)&&(0,v.jsx)("td",{children:e.subcategory}),(0,v.jsx)("td",{children:e.dataType}),(0,v.jsx)("td",{children:e.label}),(0,v.jsx)("td",{children:e.fieldType}),(0,v.jsx)("td",{children:e.inputType}),(0,v.jsx)("td",{children:e.required?"Yes":"No"}),(0,v.jsx)(u.p2,{actions:[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){return N(e)}},{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Field?",callback:function(){g((function(n){return n.filter((function(n){return n.name!==e.name}))}))}})}}]})]},a)}))}),F&&(0,v.jsx)("p",{className:"error",children:F}),(0,v.jsx)(j,{edit:Z,editCollection:n,fields:h,collections:a,productCollection:a.find((function(e){return"Product"===(null===e||void 0===e?void 0:e.name)})),onSuccess:function(e){O(null),Z?(g((function(n){return n.map((function(n){return n.name.toLowerCase()===e.name.toLowerCase()?e:n}))})),N(null)):g((function(n){return[].concat((0,t.Z)(n),[e])}))},clear:function(){return N(null)}},Z?"edit":"add"),(0,v.jsx)("form",{onSubmit:I(L),className:"".concat(m.mainForm," grid gap-1")})]})},N=a(4581),S=a(4942),C=a(7762),F=a(8300),O=function(e){var n=e.prefill,a=e.collection,t=e.fields,o=e.productCollection,c=e.edit,d=e.loading,y=e.onSubmit,x=(0,i.useState)([]),h=(0,l.Z)(x,2),j=h[0],g=h[1],_=(0,f.cI)({resolver:(0,r.y)(b.Ry((0,p.Z)({},j.map((function(e){var n;return["objectId","string","date"].includes(e.dataType)&&(n=b.Z_()),"number"===e.dataType&&(n=b.Rx().typeError("Please enter a valid number")),"phone"===e.inputType&&(n=b.Z_().phone("Please enter a valid phone number")),["array","variantArray"].includes(e.dataType)&&(n=b.IX(),e.min&&(n=n.min(e.min,"At least ".concat(e.min," items required")))),e.required&&(n=n.required(n.errorMessage||"".concat(e.label," is required"))),n})).reduce((function(e,n,a){var t;return e[null===(t=j[a])||void 0===t?void 0:t.name]=n,e}),{}))))}),T=_.handleSubmit,Z=_.register,N=_.reset,C=_.setValue,F=_.watch,O=_.control,I=_.getValues,k=_.formState.errors,A=F("category"),E=F("addVariant"),P=F("subcategory");(0,i.useEffect)((function(){var e=(0,p.Z)((0,p.Z)({},c),{},{addNew:!1});c&&t.forEach((function(n){if("date"===n.inputType)e[n.name]=(0,u._7)(e[n.name],"YYYY-MM-DD");else if("datetime-local"===n.inputType)e[n.name]=(0,u._7)(e[n.name],"YYYY-MM-DD hh:mm");else if("objectId"===n.dataType&&"object"===typeof c[n.name])e[n.name]=c[n.name][n.optionValue];else if("objectId"===n.dataElementType&&"object"===typeof(c[n.name]||[])[0])e[n.name]=c[n.name].map((function(e){return e[n.optionValue]}));else if("variants"===n.name&&"Product"===(null===a||void 0===a?void 0:a.name)){var t;e.addVariant=!(null===(t=c.variants)||void 0===t||!t.length)}})),setTimeout((function(){return N(e)}),10)}),[c]),(0,i.useEffect)((function(){var e=(0,p.Z)((0,p.Z)((0,p.Z)({},j.map((function(e){return e.name})).reduce((function(e,n){return e[n]="",e}),{})),n),{},{addNew:!1});n&&(t.forEach((function(t){if("date"===t.inputType)e[t.name]=(0,u._7)(e[t.name],"YYYY-MM-DD");else if("datetime-local"===t.inputType)e[t.name]=(0,u._7)(e[t.name],"YYYY-MM-DD hh:mm");else if("objectId"===t.dataType&&"object"===typeof n[t.name])e[t.name]=n[t.name][t.optionValue];else if("objectId"===t.dataElementType&&"object"===typeof(n[t.name]||[])[0])e[t.name]=n[t.name].map((function(e){return e[t.optionValue]}));else if("variants"===t.name&&"Product"===(null===a||void 0===a?void 0:a.name)){var l;e.addVariant=!(null===(l=n.variants)||void 0===l||!l.length)}})),N(e))}),[n]),(0,i.useEffect)((function(){g(P?t.filter((function(e){return!e.subcategory||e.subcategory===P})).sort((function(e,n){return["category","subcategory"].includes(e.name)?-1:1})):t.filter((function(e){return["category","subcategory"].includes(e.name)})))}),[P]),(0,i.useEffect)((function(){A||C("subcategory","")}),[A]);var M=("Product"===(null===a||void 0===a?void 0:a.name)?j:t).map((function(e,n){if("Product"===(null===a||void 0===a?void 0:a.name)&&"variants"===e.name)return null;if("object"===e.dataType&&"collectionFilter"===e.fieldType){var t=F(e.name);return(0,v.jsx)(w,{field:e,value:t,productCollection:o,setValue:C},e.name)}if(["array","variantArray"].includes(e.dataType)&&"object"===e.dataElementType){var l=F(e.name);return(0,v.jsx)(D,{collection:a,values:l,field:e,setValue:C},e.name)}return"file"===e.inputType?(0,v.jsx)(u.Dj,{control:O,name:e.name,label:e.label,multiple:e.multiple,thumbnail:!0},e.name):"dateRange"===e.fieldType&&"calendar"===e.inputType?(0,v.jsx)(u.qe,{control:O,label:e.label,name:e.name,dateWindow:e.dateWindow,required:e.required,disabledDates:e.disabledDates||[],multipleRanges:e.multipleRanges},e.name):"input"===e.fieldType?"phone"===e.inputType?(0,v.jsx)(u.C2,{label:e.label,name:e.name,formOptions:{required:e.required},control:O},e.name):(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({},Z(e.name)),{},{type:e.inputType||"text",label:e.label,required:e.required,error:k[e.name],autoFocus:0===n}),e.name):"textarea"===e.fieldType?(0,v.jsx)(u.gx,(0,p.Z)((0,p.Z)({},Z(e.name)),{},{label:e.label,required:e.required,error:k[e.name],autoFocus:0===n}),e.name):"richText"===e.fieldType?(0,v.jsx)(u.Ho,{control:O,name:e.name,autoFocus:0===n,label:e.label,required:e.required},e.name):"combobox"===e.fieldType?(0,v.jsx)(u.hQ,{label:e.label,control:O,name:e.name,multiple:e.multiple,formOptions:{required:e.required},options:e.options||[]},e.name):"select"===e.fieldType?(0,v.jsx)(u.OC,(0,p.Z)((0,p.Z)((0,p.Z)((0,p.Z)((0,p.Z)({control:O,label:e.label},"predefined"===e.optionType&&{options:e.options||[]}),"collection"===e.optionType&&{url:"".concat(s.Hv.dynamic,"/").concat(e.collection)}),"Product"===a.name&&"collection"===e.optionType&&{url:"".concat(s.Hv.dynamic,"/").concat(e.collection,"?").concat(A?"category=".concat(A):"")}),"Product"===a.name&&"subcategory"===e.name&&{disabled:!A}),{},{getQuery:function(n,a){return(0,p.Z)((0,p.Z)({},n&&(0,S.Z)({},e.optionLabel,n)),a&&(0,S.Z)({},e.optionValue,a))},handleData:function(n){return{label:n[e.optionLabel],value:n[e.optionValue]}},multiple:e.multiple,name:e.name,formOptions:{required:e.required},className:m.itemName}),e.name):"googleMap"===e.fieldType?(0,v.jsx)(u.b6,{control:O,name:e.name,label:e.label,marker:!0,autoComplete:!0,formOptions:{required:e.required}},e.name):void 0}));return(0,v.jsxs)("form",{onSubmit:T((function(e){if("Product"===(null===a||void 0===a?void 0:a.name)){var n=j.map((function(e){return e.name})),t={};Object.entries(e).filter((function(e){var a=(0,l.Z)(e,2),t=a[0];a[1];return n.includes(t)})).forEach((function(e){var n=(0,l.Z)(e,2),a=n[0],i=n[1];t[a]=i})),y((0,p.Z)((0,p.Z)({},t),{},{_id:(null===c||void 0===c?void 0:c._id)||Math.random().toString(36).substr(-8)}),"Product"===a.name&&e.addNew)}else y((0,p.Z)((0,p.Z)({},e),{},{_id:(null===c||void 0===c?void 0:c._id)||Math.random().toString(36).substr(-8)}))})),className:"".concat(m.dynamicForm," grid gap-1 p-1"),children:[M,"Product"===(null===a||void 0===a?void 0:a.name)&&P&&(null===a||void 0===a?void 0:a.fields.some((function(e){return"variantArray"===e.dataType})))&&(0,v.jsx)(u.XZ,(0,p.Z)((0,p.Z)({},Z("addVariant")),{},{label:"Add Variant"})),E&&(0,v.jsx)(q,{collection:a,setValue:C,getValues:I}),(0,v.jsxs)("div",{className:"btns",children:[!c&&"Product"===a.name&&(0,v.jsx)("button",{className:"btn",disabled:d,onClick:function(){return C("addNew",!0)},children:c?"Update":"Submit"}),(0,v.jsxs)("button",{className:"btn",disabled:d,onClick:function(){return C("addNew",!1)},children:[c?"Update":"Submit"," & Close"]})]})]})},q=function(e){var n=e.collection,a=e.setValue,o=e.getValues,r=(0,i.useState)(!1),s=(0,l.Z)(r,2),p=s[0],f=s[1],b=(0,i.useState)(null),y=(0,l.Z)(b,2),x=y[0],h=y[1],j=(0,i.useState)(o("variants")||[]),g=(0,l.Z)(j,2),_=g[0],T=g[1],Z=(0,i.useState)(n.fields.filter((function(e){return"variantArray"===e.dataType}))),N=(0,l.Z)(Z,2),S=N[0];N[1];return(0,v.jsxs)("div",{className:m.productVariants,children:[(0,v.jsxs)("div",{className:"flex justify-space-between mb-1",children:[(0,v.jsx)("h3",{children:"Product Variants"}),(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){return f(!0)},children:"Add Variant"})]}),(0,v.jsx)(u.iA,{columns:[].concat((0,t.Z)(S.map((function(e){return{label:e.label}}))),[{label:"Price"},{label:"Images"},{label:"Actions"}]),children:_.map((function(e,n){var t,l;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e[null===(t=S[0])||void 0===t?void 0:t.name]}),(0,v.jsx)("td",{children:e[null===(l=S[1])||void 0===l?void 0:l.name]}),(0,v.jsx)("td",{children:e.price}),(0,v.jsx)("td",{children:(e.images||[]).length}),(0,v.jsx)(u.p2,{actions:[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){h(e),f(!0)}},{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Variant?",callback:function(){T(_.filter((function(n){return n._id!==e._id}))),a("variants",_.filter((function(n){return n._id!==e._id})))}})}}]})]},n)}))}),(0,v.jsx)(c.u,{head:!0,label:"".concat(x?"Update":"Add"," Item"),open:p,setOpen:function(){f(!1),h(null)},className:m.nestedObjectFormModal,children:(0,v.jsx)(I,{edit:x,fields:S,images:o("images"),onSubmit:function(e){x?(T(_.map((function(n){return n._id===e._id?e:n}))),a("variants",_.map((function(n){return n._id===e._id?e:n}))),h(null)):(T([].concat((0,t.Z)(_),[e])),a("variants",[].concat((0,t.Z)(_),[e]))),f(!1)}})})]})},I=function(e){var n=e.edit,a=e.fields,t=e.images,l=e.onSubmit,o=(0,f.cI)({resolver:(0,r.y)(b.Ry({price:b.Rx().typeError("Please enter a valid number")}))}),c=o.handleSubmit,d=o.control,y=o.register,x=o.reset;o.errors;(0,i.useEffect)((function(){n&&x((0,p.Z)({},n))}),[]);var h=a.map((function(e,n){return"combobox"===e.fieldType?(0,v.jsx)(u.hQ,{label:e.label,control:d,name:e.name,formOptions:{required:e.required},options:e.options||[]},e.name):"select"===e.fieldType?(0,v.jsx)(u.OC,(0,p.Z)((0,p.Z)((0,p.Z)({control:d,label:e.label},"predefined"===e.optionType&&{options:e.options}),"collection"===e.optionType&&{url:"".concat(s.Hv.dynamic,"/").concat(e.collection)}),{},{getQuery:function(n,a){return(0,p.Z)((0,p.Z)({},n&&(0,S.Z)({},e.optionLabel,n)),a&&(0,S.Z)({},e.optionValue,a))},handleData:function(n){return{label:n[e.optionLabel],value:n[e.optionValue]}},name:e.name,formOptions:{required:e.required},className:m.itemName}),e.name):void 0}));return(0,v.jsxs)("form",{className:"".concat(m.variantForm," p-1 grid gap-1"),onSubmit:c((function(e){l((0,p.Z)((0,p.Z)({},e),{},{_id:(null===n||void 0===n?void 0:n._id)||Math.random().toString(36).substr(-8)}))})),children:[(0,v.jsx)(u.rG,{control:d,label:"Images",name:"images",className:m.variantImages,multiple:!0,selectedClassName:m.selected,options:t.filter((function(e){return"string"===typeof e||"uploadFilePath"in e})).map((function(e){return"string"===typeof e?{value:e}:"uploadFilePath"in e?{value:e.uploadFilePath}:"type"in e&&e.type.startsWith("image")?{value:URL.createObjectURL(e)}:void 0})),renderItem:function(e){return(0,v.jsx)("img",{src:e.value})}}),h,(0,v.jsx)(u.II,(0,p.Z)({label:"Price Difference",type:"number"},y("price"))),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",children:n?"Update":"Submit"})})]})},D=function(e){var n=e.collection,a=e.field,o=e.values,r=void 0===o?[]:o,s=e.setValue,p=(0,i.useState)(!1),f=(0,l.Z)(p,2),b=f[0],y=f[1],x=(0,i.useState)(null),h=(0,l.Z)(x,2),j=h[0],g=h[1],_=(0,i.useContext)(N.D).config.siteConfig,T="Order"===n.name?n.fields.find((function(e){return"products"===e.name})).fields.filter((function(e){return!["product","variant"].includes(e.name)})):null;return(0,v.jsxs)("section",{className:m.nestedTable,onSubmit:function(e){return e.stopPropagation()},children:[(0,v.jsxs)("div",{className:"flex justify-space-between align-center mb-1",children:[(0,v.jsx)("h3",{children:a.label}),!("Order"===n.name&&"products"===a.name)&&(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){return y(!0)},children:"Add"})]}),"Order"===n.name&&"products"===a.name?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("ul",{className:m.products,children:(r||[]).map((function(e,n){var a,t,l;return(0,v.jsxs)("li",{className:m.product,children:[(0,v.jsx)("div",{className:m.thumbnail,children:(0,v.jsx)("img",{src:((null===(a=e.variant)||void 0===a?void 0:a.images)||e.product.images)[0]})}),(0,v.jsxs)("div",{className:m.productDetail,children:[(0,v.jsx)("h3",{children:null===(t=e.product)||void 0===t?void 0:t.title}),(T||[]).map((function(n){return(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:n.label}),":"," ",(0,v.jsx)("span",{children:e[n.name]})]},n.name)}))]}),(0,v.jsxs)("span",{className:m.price,children:[null===_||void 0===_?void 0:_.currency," ",((e.product.price+((null===(l=e.variant)||void 0===l?void 0:l.price)||0))*(e.qty||1)).toLocaleString()]})]},n)}))}),(0,v.jsx)("hr",{}),(0,v.jsxs)("p",{className:m.subtotal,children:["Subtotal (",r.reduce((function(e,n){return e+(n.qty||1)}),0)," item):"," ",(0,v.jsx)("strong",{children:_.currency+" "+r.reduce((function(e,n){var a;return e+(n.product.price+((null===(a=n.variant)||void 0===a?void 0:a.price)||0))*(n.qty||1)}),0).toLocaleString()})]})]}):(0,v.jsx)(u.tM,{fields:a.fields,data:r,actions:function(e){return[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){g(e),y(!0)}},{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Collection?",callback:function(){s(a.name,r.filter((function(n){return n._id!==e._id})))}})}}]}}),(0,v.jsx)(c.u,{head:!0,label:"".concat(j?"Update":"Add"," Item"),open:b,setOpen:function(){y(!1),g(null)},className:m.nestedObjectFormModal,children:(0,v.jsx)(O,{edit:j,fields:a.fields,onSubmit:function(e){j?(s(a.name,r.map((function(n){return n._id===e._id?e:n}))),g(null)):s(a.name,[].concat((0,t.Z)(r),[e])),y(!1)}})})]})},w=function(e){var n=e.field,a=e.value,t=e.productCollection,o=e.setValue,r=(0,i.useState)(!1),s=(0,l.Z)(r,2),d=s[0],p=s[1];return(0,v.jsxs)("section",{className:m.nestedTable,onSubmit:function(e){return e.stopPropagation()},children:[(0,v.jsxs)("div",{className:"flex justify-space-between align-center mb-1",children:[(0,v.jsxs)("h3",{children:[n.label," Filters"]}),(0,v.jsxs)("button",{className:"btn",type:"button",onClick:function(){return p(!0)},children:["Update ",n.label]})]}),(0,v.jsx)(u.iA,{className:m.fields,columns:[{label:"Field"},{label:"Data Type"},{label:"Filter Type"},{label:"value"}],children:Object.entries(a||{}).map((function(e,n){var a,i,o=(0,l.Z)(e,2),r=o[0],c=o[1];return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:r}),(0,v.jsx)("td",{children:null===(a=t.fields.find((function(e){return e.name===r})))||void 0===a?void 0:a.dataType}),(0,v.jsx)("td",{children:c.filterType}),(0,v.jsxs)("td",{children:["minMax"===c.filterType&&(0,v.jsxs)(v.Fragment,{children:["Min: ",c.min,"; Max: ",c.max]}),"arrayContains"===c.filterType&&(0,v.jsxs)(v.Fragment,{children:[(null===(i=c.array)||void 0===i?void 0:i.length)||0," items"]}),"stringContains"===c.filterType&&(0,v.jsx)(v.Fragment,{children:c.text})]})]},n)}))}),(0,v.jsx)(c.u,{head:!0,label:"".concat(n.label," Filters"),open:d,setOpen:function(){p(!1)},className:m.nestedObjectFormModal,children:(0,v.jsx)(k,{productCollection:t,value:a,onSubmit:function(e){o(n.name,e),p(!1)}})})]})},k=function(e){var n=e.value,a=void 0===n?{}:n,t=e.productCollection,o=e.onSubmit,r=(0,f.cI)(),c=r.handleSubmit,d=r.register,b=r.control,y=r.watch,x=r.reset,h=r.formState.errors,j=y("fields");return(0,i.useEffect)((function(){var e={fields:Object.keys(a)};Object.entries(a).forEach((function(n){var a=(0,l.Z)(n,2),i=a[0],o=a[1],r=t.fields.find((function(e){return e.name===i}));r&&("number"===r.dataType&&"minMax"===o.filterType?(e[i+"___min"]=o.min||"",e[i+"___max"]=o.max||""):"string"===r.dataType&&["input","textarea"].includes(r.fieldType)?e[i]=o.text:("combobox"===r.fieldType||"select"===r.fieldType)&&(e[i]=o.array))})),x(e)}),[]),(0,v.jsxs)("form",{onSubmit:c((function(e){var n={};Object.entries(e).forEach((function(a){var i=(0,l.Z)(a,2),o=i[0],r=i[1],c=o.split("___"),s=(0,l.Z)(c,2),u=s[0],d=s[1];if(d&&(o=u),e.fields.includes(o)){var m=t.fields.find((function(e){return e.name===o}));m&&("string"===m.dataType&&["input","textarea"].includes(m.fieldType)?n[o]={filterType:"stringContains",text:r}:"number"===m.dataType?n[u]=(0,p.Z)((0,p.Z)({},n[u]),{},(0,S.Z)({filterType:"minMax"},d,+r)):["string","objectId"].includes(m.dataType)&&"select"===m.fieldType&&(n[o]={filterType:"arrayContains",array:r}))}})),o(n)})),className:"grid gap-1 p-1",children:[(0,v.jsx)(u.rG,{control:b,name:"fields",className:m.itemColumnsRadio,multiple:!0,label:"Fields",options:t.fields.filter((function(e){return!("file"===e.inputType||"calendar"===e.inputType)})).map((function(e){return{label:e.label,value:e.name}}))}),(j||[]).map((function(e,n){var a=t.fields.find((function(n){return n.name===e}));if(a)return"string"===a.dataType&&["input","textarea"].includes(a.fieldType)?(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({},d(a.name)),{},{type:"text",label:"".concat(a.label," contains"),required:a.required,error:h[a.name]}),n):"number"===a.dataType?(0,v.jsxs)("div",{className:"flex gap-1",children:[(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({className:"all-columns"},d(a.name+"___min")),{},{type:"number",label:"Minimum ".concat(a.label),required:a.required,error:h[a.name+"___min"]})),(0,v.jsx)(u.II,(0,p.Z)((0,p.Z)({className:"all-columns"},d(a.name+"___max")),{},{type:"number",label:"Maximum ".concat(a.label),required:a.required,error:h[a.name+"___max"]}))]},n):"select"===a.fieldType?(0,v.jsx)(u.OC,(0,p.Z)((0,p.Z)((0,p.Z)({control:b,label:a.label,multiple:!0},"predefined"===a.optionType&&{options:a.options}),"collection"===a.optionType&&{url:"".concat(s.Hv.dynamic,"/").concat(a.collection)}),{},{getQuery:function(e,n){return(0,p.Z)((0,p.Z)({},e&&(0,S.Z)({},a.optionLabel,e)),n&&(0,S.Z)({},a.optionValue,n))},handleData:function(e){return{label:e[a.optionLabel],value:e[a.optionValue]}},name:a.name,formOptions:{required:!0},className:m.itemName}),n):"combobox"===a.fieldType?(0,v.jsx)(u.hQ,{label:a.label,control:b,name:a.name,multiple:!0,formOptions:{required:!0},options:a.options||[]},n):void 0})),(0,v.jsx)("div",{className:"flex justify-center",children:(0,v.jsx)("button",{className:"btn",children:"Update"})})]})},A=function(e){var n=e.collection,a=e.productCollection,t=e.edit,l=e.onSuccess,i=(0,r.i)("".concat(s.Hv.dynamic,"/").concat(n.name,"/").concat((null===t||void 0===t?void 0:t._id)||"")),o=i.post,u=i.put,d=i.loading;return(0,v.jsx)("div",{className:"grid gap-1",children:(0,v.jsx)(O,{collection:n,fields:n.fields,productCollection:a,edit:t,loading:d,onSubmit:function(e,a){var i=(0,p.Z)({},e);"Product"===n.name&&"variants"in i&&(i.variants=JSON.stringify(i.variants)),n.fields.some((function(e){return"object"===e.dataType}))&&n.fields.filter((function(e){return"object"===e.dataType})).forEach((function(n){e[n.name]&&(i[n.name]=JSON.stringify(e[n.name]))})),(0,F.Ty)("_id",i).forEach((function(e){e.path.reduce((function(e,n,a,t){return a===t.length-1&&e[n].length<=20&&delete e[n],e[n]}),i)})),n.fields.some((function(e){return"file"===e.inputType}))&&(i=new FormData,n.fields.forEach((function(a){if("Product"!==n.name||"variants"!==a.name){var t=e[a.name];if(void 0!==t)if("file"===a.inputType&&t.length){var l,o=(0,C.Z)(t);try{for(o.s();!(l=o.n()).done;){var r=l.value;i.append("".concat(a.name),r.uploadFilePath||r)}}catch(d){o.e(d)}finally{o.f()}}else if(["array","variantArray"].includes(a.dataType)){var c,s=(0,C.Z)(t);try{for(s.s();!(c=s.n()).done;){var u=c.value;i.append("".concat(a.name),u)}}catch(d){s.e(d)}finally{s.f()}}else{if("object"!==a.dataType)return i.append(a.name,t);i.append("".concat(a.name),JSON.stringify(t))}}})),"Product"===n.name&&"variants"in e&&i.append("variants",JSON.stringify(e.variants))),(t?u:o)(i).then((function(e){var n=e.data;if(!n.success)return(0,c.N)({type:"error",message:n.message});a?l(n.data,a):l(n.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}})})},E=function(){var e=(0,i.useState)({}),n=(0,l.Z)(e,2),a=n[0],f=n[1],b=(0,i.useContext)(N.D),y=b.business,x=b.checkPermission,h=(0,i.useState)([]),j=(0,l.Z)(h,2),g=j[0],_=j[1],T=(0,i.useState)(null),Z=(0,l.Z)(T,2),S=Z[0],C=Z[1],F=(0,i.useState)(!1),O=(0,l.Z)(F,2),q=O[0],I=O[1],D=(0,i.useState)(null),w=(0,l.Z)(D,2),k=w[0],E=w[1],P=(0,i.useState)(null),M=(0,l.Z)(P,2),V=M[0],H=M[1],L=(0,o.s0)(),R=(0,o.UO)()["*"],Q=(0,r.i)("".concat(s.Hv.collections,"/").concat(R)),Y=Q.get,U=Q.loading,W=(0,r.i)("".concat(s.Hv.collections,"/Product")),K=W.get,B=(W.loading,(0,r.i)("".concat(s.Hv.dynamic,"/").concat(R,"/{ID}")).remove);return(0,i.useEffect)((function(){Y().then((function(e){var n=e.data;if(n.success){for(var a=[],t=function(e){var t={};n.data.fields.forEach((function(n){var a,l,i;return"date"===n.dataType?t[n.name]=(new Date).toISOString().substring(0,10):"number"===n.dataType?t[n.name]=+(1e3*Math.random()).toFixed(0)+1e3:"objectId"===n.dataType?t[n.name]=(new Date).getTime().toString(16)+(+(1e19*Math.random()).toFixed(0)).toString(16):["combobox","select"].includes(n.fieldType)&&null!==(a=n.options)&&void 0!==a&&a.length?t[n.name]=(null===(l=n.options[e])||void 0===l?void 0:l.value)||(null===(i=n.options[0])||void 0===i?void 0:i.value):void(t[n.name]="".concat(n.label," ").concat(e))})),a.push(t)},l=0;l<5;l++)t(l);return _(a),E(n.data)}})).catch((function(e){return(0,c.N)({type:"error",message:e.message})})),"Campaign"===R&&K().then((function(e){var n=e.data;if(n.success)return H(n.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[]),(0,v.jsxs)("div",{className:"".concat(m.content," grid gap-1 m-a p-1"),children:[(0,v.jsxs)("div",{className:"".concat(window.innerWidth<=480?"grid gap-1":"flex"," justify-space-between"),children:[(0,v.jsxs)("h2",{children:["All ",R,"(s)"]}),(0,v.jsxs)("div",{className:"flex gap-1 wrap",children:[(0,v.jsx)(u.nI,{exportUrl:"".concat(s.Hv.dynamic,"/").concat(R),importUrl:x("".concat(null===y||void 0===y?void 0:y.business._id,"_").concat(R,"_create"))?"".concat(s.Hv.dynamicBulkCreate.replace(":table",R)):null,collection:k,templateData:g,onSuccess:function(){return f((function(e){return(0,p.Z)({},e)}))}}),(0,v.jsx)("button",{className:"btn",onClick:function(){return L(s.Hb.dashboard.replace("*","")+s.Hb.dynamicTables.replace("/*",""))},children:"Back"}),x("".concat(null===y||void 0===y?void 0:y.business._id,"_").concat(R,"_create"))&&(0,v.jsxs)("button",{className:"btn",onClick:function(){return I(!0)},children:["Add ",R]})]})]}),(0,v.jsx)(u.tM,{fields:null===k||void 0===k?void 0:k.fields,loading:U,url:"".concat(s.Hv.dynamic,"/").concat(R),filters:a,pagination:!0,select:!0,actions:function(e){return[].concat((0,t.Z)(x("".concat(null===y||void 0===y?void 0:y.business._id,"_").concat(R,"_update"))?[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){C(e),I(!0)}}]:[]),(0,t.Z)(x("".concat(null===y||void 0===y?void 0:y.business._id,"_").concat(R,"_delete"))?[{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Collection?",callback:function(){B({},{params:{"{ID}":e._id}}).then((function(e){var n=e.data;n.success?f((function(e){return(0,p.Z)({},e)})):(0,c.N)({type:"error",message:n.message})}))}})}}]:[]))}}),(0,v.jsx)(c.u,{head:!0,label:"".concat(S?"Update":"Add"," ").concat((null===k||void 0===k?void 0:k.name)||"Collection"),open:q,setOpen:function(){I(!1),C(null)},className:m.dynamicFormModal,children:(0,v.jsx)(A,(0,p.Z)((0,p.Z)({edit:S,collection:k,prefill:null!==q&&void 0!==q&&q.title?q:null},["Campaign","Order"].includes(null===k||void 0===k?void 0:k.name)&&{productCollection:V}),{},{onSuccess:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S?(f((function(e){return(0,p.Z)({},e)})),C(null)):f((function(e){return(0,p.Z)({},e)})),I(!!n&&{category:e.category,subcategory:e.subcategory,title:e.title,price:e.price,description:e.description,whatsappNumber:e.whatsappNumber})}}))})]})},P=b.Ry({schema_id:b.Z_().required()}),M=function(e){var n=e.onSuccess,a=(0,f.cI)({resolver:(0,r.y)(P)}),t=a.handleSubmit,o=a.control,d=(0,i.useState)([]),p=(0,l.Z)(d,2),b=p[0],y=p[1],x=(0,r.i)(s.Hv.schemaTemplates),h=x.get,j=x.loading,g=(0,r.i)(s.Hv.schemaTemplates),_=g.post,T=g.loading;return(0,i.useEffect)((function(){h().then((function(e){var n=e.data;null!==n&&void 0!==n&&n.success&&y(n.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[]),(0,v.jsx)("div",{className:"grid gap-1 p-1",children:(0,v.jsxs)("form",{onSubmit:t((function(e){_(e).then((function(e){var a=e.data;if(!a.success)return(0,c.N)({type:"error",message:a.message});(0,c.N)({type:"success",message:a.message,callback:function(){n(a.data)}})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))})),className:"".concat(m.mainForm," grid gap-1"),children:[(0,v.jsx)(u.OC,{control:o,name:"schema_id",label:"Select Schema",options:b.map((function(e){return{label:e.name,value:e._id}})),formOptions:{required:!0}}),(0,v.jsx)("div",{className:"btns mt-1",children:(0,v.jsx)("button",{className:"btn",disabled:j||T,children:"Submit"})})]})})},V=a(5804),H=a(657),L=function(e){var n=e.setSidebarOpen,a=(0,i.useContext)(N.D).checkPermission,p=(0,i.useState)(null),f=(0,l.Z)(p,2),b=f[0],y=f[1],x=(0,i.useState)(!1),h=(0,l.Z)(x,2),j=h[0],g=h[1],_=(0,i.useState)(!1),T=(0,l.Z)(_,2),S=T[0],C=T[1],F=(0,i.useState)([]),O=(0,l.Z)(F,2),q=O[0],I=O[1],D=(0,r.i)(s.Hv.collections),w=D.get,k=D.loading,A=(0,r.i)(s.Hv.collections+"/{ID}"),P=A.remove,L=A.loading,R=(0,o.s0)(),Q=(0,o.UO)()["*"],Y=(0,i.useCallback)((function(){w().then((function(e){var n=e.data;if(n.success)return I(n.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[]);return(0,i.useEffect)((function(){Y()}),[]),Q?(0,v.jsx)(E,{}):(0,v.jsxs)("div",{className:"".concat(m.content," grid gap-1 m-a p-1"),children:[(0,v.jsxs)("div",{className:"flex justify-space-between",children:[(0,v.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return n((function(e){return!e}))},children:[(0,v.jsx)(V.Ps6,{style:{fontSize:"1.75rem"}}),(0,v.jsx)("h2",{children:"All Tables"}),(0,v.jsx)("button",{className:"btn clear iconOnly",onClick:function(){return g(!0)},children:(0,v.jsx)(H.ueT,{})})]}),(0,v.jsxs)("div",{className:"flex gap-1",children:[(0,v.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return C(!0)},children:"Import Schema"}),(0,v.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return g(!0)},children:"Add Table"})]})]}),(0,v.jsx)(u.iA,{loading:k,className:m.collections,columns:[{label:"Name"},{label:"Action"}],children:q.map((function(e,n){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{className:m.tableName,onClick:function(n){"TD"===n.target.tagName&&R(s.Hb.dynamicTable.replace(":table",e.name))},children:e.name}),(0,v.jsx)(u.p2,{actions:[].concat((0,t.Z)(a("dynamic_table_update")?[{icon:(0,v.jsx)(d.KHI,{}),label:"Edit",onClick:function(){y(e),g(!0)}}]:[]),(0,t.Z)(a("dynamic_table_delete")?[{icon:(0,v.jsx)(d.lp8,{}),label:"Delete",disabled:L,onClick:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this Collection?",callback:function(){P({},{params:{"{ID}":e._id}}).then((function(n){var a=n.data;null!==a&&void 0!==a&&a.success&&I((function(n){return n.filter((function(n){return n._id!==e._id}))}))})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}})}}]:[]))})]},n)}))}),(0,v.jsx)(c.u,{head:!0,label:b?"Update Collection":"Add Collection",open:j,setOpen:function(){g(!1),y(null)},className:m.collectionFormModal,children:(0,v.jsx)(Z,{collections:q,edit:b,onSuccess:function(e){b?(I((function(n){return n.map((function(n){return n._id.toLowerCase()===b._id.toLowerCase()?e:n}))})),y(e)):(y(e),I((function(n){return[].concat((0,t.Z)(n),[e])})))}})}),(0,v.jsx)(c.u,{head:!0,label:"Import Schema",open:S,setOpen:function(){C(!1)},className:m.collectionFormModal,children:(0,v.jsx)(M,{onSuccess:function(e){C(!1),Y()}})})]})}}}]);
//# sourceMappingURL=336.99083790.chunk.js.map