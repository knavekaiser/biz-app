"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[916],{5916:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var a=n(2982),r=n(1413),i=n(885),s=n(2791),l=n(6884),o={content:"store_content__5-Bs0",sales:"store_sales__GIqxi",filters:"store_filters__LKG6N",addStoreFormModal:"store_addStoreFormModal__zzuJo",productForm:"store_productForm__hyIkr",mainForm:"store_mainForm__EPMXD",print:"store_print__XB1OQ"},u=n(1080),d=n(96),c=n(5454),m=n(6355),f=n(4942),p=n(1134),b=n(1570),v=n(184),g=function(e){var t=e._fields,n=e.business,a=e.edit,i=e.onSuccess,d=(0,p.cI)({resolver:(0,c.y)(b.Ry((0,r.Z)((0,r.Z)({},t.map((function(e){var t;return["objectId","string","date"].includes(e.dataType)&&(t=b.Z_()),"number"===e.dataType&&(t=b.Rx().typeError("Please enter a valid number")),"phone"===e.inputType&&(t=b.Z_().phone("Please enter a valid phone number")),["array","variantArray"].includes(e.dataType)&&(t=b.IX(),e.min&&(t=t.min(e.min,"At least ".concat(e.min," items required")))),e.required&&(t=t.required(t.errorMessage||"".concat(e.label," is required"))),t})).reduce((function(e,n,a){var r;return e[null===(r=t[a])||void 0===r?void 0:r.name]=n,e}),{})),{},{url:b.Z_()})))}),m=d.handleSubmit,g=d.register,h=d.reset,y=d.control,x=(d.watch,d.formState.errors),j=t.map((function(e,t){return"object"===e.dataType&&"collectionFilter"===e.fieldType||["array","variantArray"].includes(e.dataType)&&"object"===e.dataElementType?null:"file"===e.inputType?(0,v.jsx)(l.Dj,{control:y,name:e.name,label:e.label,multiple:"images"!==e.name&&e.multiple,formOptions:{required:e.required},thumbnail:!0},e.name):"dateRange"===e.fieldType&&"calendar"===e.inputType?(0,v.jsx)(l.qe,{control:y,label:e.label,name:e.name,dateWindow:e.dateWindow,required:e.required,disabledDates:e.disabledDates||[],multipleRanges:e.multipleRanges},e.name):"input"===e.fieldType?"phone"===e.inputType?(0,v.jsx)(l.C2,{label:e.label,name:e.name,formOptions:{required:e.required},control:y},e.name):(0,v.jsx)(l.II,(0,r.Z)((0,r.Z)({},g(e.name)),{},{type:e.inputType||"text",label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"textarea"===e.fieldType?(0,v.jsx)(l.gx,(0,r.Z)((0,r.Z)({},g(e.name)),{},{label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"combobox"===e.fieldType?(0,v.jsx)(l.hQ,{label:e.label,control:y,name:e.name,multiple:e.multiple,formOptions:{required:e.required},options:e.options||[]},e.name):"select"===e.fieldType?(0,v.jsx)(l.OC,(0,r.Z)((0,r.Z)((0,r.Z)({control:y,label:e.label},"predefined"===e.optionType&&{options:e.options||[]}),"collection"===e.optionType&&{url:"".concat(u.Hv.adminDynamic,"/").concat(e.collection)}),{},{getQuery:function(t,a){return(0,r.Z)((0,r.Z)({business:n},t&&(0,f.Z)({},e.optionLabel,t)),a&&(0,f.Z)({},e.optionValue,a))},handleData:function(t){return{label:t[e.optionLabel],value:t[e.optionValue]}},multiple:e.multiple,name:e.name,formOptions:{required:e.required},className:o.itemName}),e.name):void 0}));return(0,s.useEffect)((function(){h((0,r.Z)((0,r.Z)({},a),{},{images:null!==a&&void 0!==a&&a.image?[null===a||void 0===a?void 0:a.image]:[]}))}),[a]),(0,v.jsx)("div",{children:(0,v.jsxs)("form",{className:"grid gap-1 p-1",onSubmit:m((function(e){var t;null!==(t=e.images)&&void 0!==t&&t[0]&&(e.image=e.images[0],delete e.images),i((0,r.Z)((0,r.Z)({},e),{},{_id:(null===a||void 0===a?void 0:a._id)||Math.random().toString(32).substr(-8)}))})),children:[j,(0,v.jsx)(l.II,(0,r.Z)({label:"URL"},g("url"))),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",children:a?"Update":"Submit"})})]})})},h=function(e){var t=e.edit,n=e.onSuccess,f=(0,s.useState)([]),h=(0,i.Z)(f,2),y=h[0],x=h[1],j=(0,s.useState)(null),_=(0,i.Z)(j,2),Z=_[0],N=_[1],C=(0,p.cI)({resolver:(0,c.y)(b.Ry({start:b.Z_().required().typeError("Please select start date"),end:b.Z_().required().typeError("Please select start date"),category:b.Z_().required("field is required")}))}),S=C.handleSubmit,q=C.register,D=C.reset,I=C.control,M=C.watch,O=C.setValue,T=C.formState.errors,A=(0,s.useState)([]),F=(0,i.Z)(A,2),k=F[0],E=F[1],Y=(0,s.useState)([]),B=(0,i.Z)(Y,2),H=B[0],w=B[1],P=(0,s.useState)(null),R=(0,i.Z)(P,2),U=R[0],L=R[1],Q=(0,c.i)(u.Hv.stores+"/".concat((null===t||void 0===t?void 0:t._id)||"")),W=Q.post,X=Q.put,G=Q.loading,K=M("business"),V=M("category"),z=M("subCategory"),J=M("products"),$=M("featured"),ee=(0,c.i)(u.Hv.adminDynamic+"/Category"),te=ee.get,ne=(ee.loading,(0,c.i)(u.Hv.adSchemas)),ae=ne.get;ne.loading;(0,s.useEffect)((function(){te().then((function(e){var t=e.data;return t.success?t.data.length>0?void E(t.data):(0,d.N)({type:"error",message:"Please add at least one category to proceed."}):(0,d.N)({type:"error",message:t.message})})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[]),(0,s.useEffect)((function(){ae({query:{category:V}}).then((function(e){var n=e.data;n.success&&(w(n.data),null!==t&&void 0!==t&&t.subCategory&&L(n.data.find((function(e){return e.name===(null===t||void 0===t?void 0:t.subCategory)}))||null))})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[V]),(0,s.useEffect)((function(){x(((null===U||void 0===U?void 0:U.fields)||[]).filter((function(e){return!e.subCategory||e.subCategory===z})).filter((function(e){return!["subCategory","category","variants","richtext","specification"].includes(e.name)})))}),[U,z]);var re=M("start"),ie=M("end");return(0,s.useEffect)((function(){var e;D((0,r.Z)((0,r.Z)({},t),{},{featured:(null===t||void 0===t?void 0:t.featured)||!1,products:(null===t||void 0===t?void 0:t.products)||[],business:(null===t||void 0===t||null===(e=t.business)||void 0===e?void 0:e._id)||"",order:(null===t||void 0===t?void 0:t.order)||[],start:null!==t&&void 0!==t&&t.start?(0,l._7)(t.start,"YYYY-MM-DD"):"",end:null!==t&&void 0!==t&&t.end?(0,l._7)(t.end,"YYYY-MM-DD"):""}))}),[t]),(0,v.jsxs)("div",{className:"grid gap-1 p-1",children:[(0,v.jsxs)("form",{onSubmit:S((function(e){delete e.image;var a=(0,r.Z)({},e);e.products.forEach((function(e,t){var n;null!==(n=e.image)&&void 0!==n&&n.type&&(a["products__".concat(t,"__image")]=e.image)}));var s=new FormData;Object.entries(a).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],a=t[1];null!==a&&void 0!==a&&a.type?s.append(n,a):"object"===typeof a?s.append(n,JSON.stringify(a)):s.append(n,a)})),(t?X:W)(s).then((function(e){var t=e.data;if(!t.success)return(0,d.N)({type:"error",message:t.message});n(t.data)})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))})),className:"".concat(o.mainForm," grid gap-1"),children:[(0,v.jsx)(l.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",formOptions:{required:!0}}),K&&(0,v.jsx)(l.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Category",options:k.map((function(e){return{label:e.name,value:e.name}})),name:"category",onChange:function(e){null!==e&&void 0!==e&&e.value||O("subCategory","")},formOptions:{required:!0}}),V&&(0,v.jsx)(l.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Sub Category",options:H.filter((function(e){return e.category===V})).map((function(e){return{label:e.name,value:e.name}})),name:"subCategory",onChange:function(e){e.value&&L(H.find((function(t){return t.name===e.value})))},formOptions:{required:!0}}),V&&z&&(0,v.jsxs)("div",{className:"grid gap-1",children:[(0,v.jsx)(l.II,(0,r.Z)((0,r.Z)({type:"date",label:"Start Date*",max:ie},q("start")),{},{error:T.start})),(0,v.jsx)(l.II,(0,r.Z)((0,r.Z)({type:"date",label:"End Date*",min:re},q("end")),{},{error:T.end})),(0,v.jsx)(l.XZ,(0,r.Z)({label:"Featured"},q("featured"))),(0,v.jsxs)("div",{className:"flex justify-space-between align-center",children:[(0,v.jsx)("h3",{children:"Products"}),((J||[]).length<1||$)&&(0,v.jsx)("button",{type:"button",className:"btn",onClick:function(){return N(!0)},children:"Add Product"})]}),(0,v.jsx)(l.iA,{columns:[{label:"Title"},{label:"Image"},{label:"Actions"}],children:(J||[]).map((function(e){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.title}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:"string"===typeof e.image?e.image:URL.createObjectURL(e.image)})}),(0,v.jsx)(l.p2,{actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){N(e)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,d.N)({type:"confirmation",message:"Are you sure you want to remove this product?",callback:function(){O("products",J.filter((function(t){return t._id!==e._id})))}})}}]})]},e._id)}))})]}),V&&z&&y.length>0&&(0,v.jsx)(l.rG,{control:I,name:"order",multiple:!0,label:"Card Elements (Move items to reorder)",sortable:!0,options:y.filter((function(e){return!["title","images"].includes(e.name)})).sort((function(e,n,a){return((null===t||void 0===t?void 0:t.order)||[]).includes(e.name)?((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(t){return t===e.name}))>((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(e){return e===n.name}))?1:-1:1})).reverse().map((function(e,t,n){return{label:e.label,value:e.name,order:n.length-t}}))}),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",disabled:G,children:t?"Update":"Submit"})})]}),(0,v.jsx)(d.u,{open:Z,setOpen:function(){return N(null)},head:!0,label:"".concat(null!==t&&void 0!==t&&t._id?"Update":"Add"," Product"),className:o.productForm,children:(0,v.jsx)(g,{_fields:y,business:K,edit:null!==Z&&void 0!==Z&&Z._id?Z:null,onSuccess:function(e){O("products",null!==Z&&void 0!==Z&&Z._id?J.map((function(t){return t._id===e._id?e:t})):[].concat((0,a.Z)(J),[e])),N(null)}})})]})},y=n(6871),x=function(e){e.filters;var t=e.setFilters,n=(0,p.cI)(),a=n.handleSubmit,s=(n.register,n.control),d=n.reset;n.watch;return(0,v.jsxs)("form",{className:o.filters,onSubmit:a((function(e){t(Object.entries(e).reduce((function(e,t){var n=(0,i.Z)(t,2),a=n[0],r=n[1];return void 0!==r&&(e[a]=r),e}),{}))})),children:[(0,v.jsx)(l.OC,{control:s,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",className:o.itemName}),(0,v.jsx)(l.OC,{control:s,label:"Category",url:u.Hv.admin,getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",className:o.itemName}),(0,v.jsx)(l.hQ,{label:"Featured",control:s,name:"featured",options:[{label:"Yes",value:!0},{label:"No",value:!1}]}),(0,v.jsxs)("div",{className:"btns",children:[(0,v.jsx)("button",{className:"btn",children:"Search"}),(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){d(),t({})},children:"Clear"})]})]})},j=function(){var e=(0,s.useState)([]),t=(0,i.Z)(e,2),n=t[0],r=t[1],f=(0,s.useState)(!1),p=(0,i.Z)(f,2),b=p[0],g=p[1],j=(0,s.useState)(null),_=(0,i.Z)(j,2),Z=_[0],N=_[1],C=(0,s.useState)({}),S=(0,i.Z)(C,2),q=S[0],D=S[1],I=(0,c.i)(u.Hv.stores),M=I.get,O=I.loading,T=(0,y.s0)(),A=(0,c.i)(u.Hv.stores+"/{ID}"),F=A.remove;A.deleting;return(0,s.useEffect)((function(){M({query:q}).then((function(e){var t=e.data;t.success?r(t.data):(0,d.N)({type:"error",message:t.message})})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[q]),(0,v.jsxs)("div",{className:"".concat(o.content," grid gap-1 m-a p-1"),children:[(0,v.jsxs)("div",{className:"flex justify-space-between",children:[(0,v.jsx)("h2",{children:"All Listings"}),(0,v.jsxs)("div",{className:"flex gap-1",children:[(0,v.jsx)("button",{className:"btn",onClick:function(){return T(u.Hb.dashboard.replace("*","")+u.Hb.stores)},children:"Back"}),(0,v.jsx)("button",{className:"btn",onClick:function(){return g(!0)},children:"Add Listing"})]})]}),(0,v.jsx)(x,{filters:q,setFilters:D}),(0,v.jsx)(l.iA,{loading:O,className:o.sales,columns:[{label:"Created At"},{label:"Business"},{label:"Category"},{label:"Sub Category"},{label:"Created By"},{label:"Effective Period"},{label:"Featured"},{label:"Action"}],children:n.map((function(e){var t,n;return(0,v.jsxs)("tr",{style:{cursor:"pointer"},children:[(0,v.jsx)("td",{children:(0,v.jsx)(l.W7,{format:"MMM DD, YY hh:mma",children:e.createdAt})}),(0,v.jsx)("td",{children:null===(t=e.business)||void 0===t?void 0:t.name}),(0,v.jsx)("td",{children:e.category}),(0,v.jsx)("td",{children:e.subCategory}),(0,v.jsx)("td",{children:null===(n=e.createdBy)||void 0===n?void 0:n.name}),(0,v.jsxs)("td",{children:[(0,v.jsx)(l.W7,{format:"MMM DD, YY",children:e.start})," -"," ",(0,v.jsx)(l.W7,{format:"MMM DD, YY",children:e.end})]}),(0,v.jsx)("td",{children:e.featured?"Yes":"No"}),(0,v.jsx)(l.p2,{className:o.actions,actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){N(e),g(!0)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,d.N)({type:"confirmation",message:"Are you sure you want to remove this listing?",callback:function(){F({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?r((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,d.N)({type:"error",message:n.message})}))}})}}]})]},e._id)}))}),(0,v.jsx)(d.u,{open:b,head:!0,label:"".concat(Z?"Update":"Add"," Store"),className:o.addStoreFormModal,setOpen:function(){N(null),g(!1)},children:(0,v.jsx)(h,{edit:Z,onSuccess:function(e){Z?(r((function(t){return e?t.map((function(t){return t._id===e._id?e:t})):t.filter((function(e){return e._id!==Z._id}))})),N(null)):r((function(t){return[].concat((0,a.Z)(t),[e])})),g(!1)}})})]})}}}]);
//# sourceMappingURL=916.ca32df0d.chunk.js.map