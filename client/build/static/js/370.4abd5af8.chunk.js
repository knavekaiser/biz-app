"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[370],{7370:function(e,n,a){a.r(n),a.d(n,{default:function(){return j}});var s=a(2982),t=a(885),r=a(2791),c=a(4581),l=a(3806),o=a(2202),i=a(8750),d={content:"roles_content__7vddl",roles:"roles_roles__IXgwH",addRoleForm:"roles_addRoleForm__gw1ju",roleDetail:"roles_roleDetail__Ns1JZ",box:"roles_box__c7xQ0",noContent:"roles_noContent__TV7sS",permissions:"roles_permissions__eDI5R",name:"roles_name__-FVjs",mainForm:"roles_mainForm__PfIjB",detail:"roles_detail__9YIVy",label:"roles_label__vRLQk",head:"roles_head__m0eUZ",itemForm:"roles_itemForm__5GcJC",itemName:"roles_itemName__Ox8V2"},u=a(5454),m=a(1080),_=a(1413),f=a(1134),p=a(1570),h=a(184),x=p.Ry({name:p.Z_().required(),permissions:p.IX().of(p.Z_())}),b=function(e){var n=e.edit,a=e.dynamicTables,t=e.onSuccess,o=(0,r.useContext)(c.D).user,p=(0,f.cI)({resolver:(0,u.y)(x)}),b=p.handleSubmit,v=p.register,g=p.reset,j=p.watch,N=p.setValue,Z=p.formState.errors,y=(0,u.i)(m.Hv.roles+"/".concat((null===n||void 0===n?void 0:n._id)||"")),S=y.post,k=y.put,C=y.loading,I=j("permissions");return(0,r.useEffect)((function(){g({name:(null===n||void 0===n?void 0:n.name)||"",permissions:(null===n||void 0===n?void 0:n.permissions)||[]})}),[n]),(0,h.jsx)("div",{className:"grid gap-1 p-1 ".concat(d.addRoleForm),children:(0,h.jsxs)("form",{onSubmit:b((function(e){(n?k:S)(e).then((function(e){var n=e.data;if(!n.success)return(0,i.N)({type:"error",message:n.message});t(n.data)})).catch((function(e){return(0,i.N)({type:"error",message:e.message})}))})),className:"".concat(d.mainForm," grid gap-1"),children:[(0,h.jsx)("div",{className:d.box,children:(0,h.jsx)(l.II,(0,_.Z)((0,_.Z)({label:"Name"},v("name")),{},{required:!0,error:Z.name}))}),(0,h.jsxs)("div",{className:"".concat(d.box," all-columns"),children:[(0,h.jsx)("h3",{children:"Permissions"}),(0,h.jsx)(l.iA,{className:d.permissions,columns:[{label:"Table"},{label:"Read",className:"align-center"},{label:"Create",className:"align-center"},{label:"Update",className:"align-center"},{label:"Delete",className:"align-center"}],children:[].concat((0,s.Z)(m.EY),(0,s.Z)(a)).map((function(e,n){return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:d.name,children:e.label}),e.actions.map((function(n,a){var t="".concat(e.value,"_").concat(n||a),r=(0,h.jsx)("td",{className:"align-center",children:(0,h.jsx)(l.XZ,{checked:(I||[]).includes(t),disabled:"dynamic_table_read"===t&&(I||[]).some((function(e){return e.startsWith(o._id)}))||t.endsWith("_read")&&(I||[]).some((function(e){return e!==t&&e.startsWith(t.replace("_read",""))})),onChange:function(e){(I||[]).includes(t)?N("permissions",I.filter((function(e){return e!==t}))):N("permissions",(0,s.Z)(new Set([].concat((0,s.Z)(I||[]),(0,s.Z)(t.startsWith(o._id)?["dynamic_table_read"]:[]),(0,s.Z)(/^(.*)(create|update|delete)$/.test(t)?[t.replace(/(create|update|delete)$/,"read")]:[]),[t]))))}})},t);return 0===a&&"read"===n||1===a&&"create"===n||2===a&&"update"===n||3===a&&"delete"===n?r:(0,h.jsx)("td",{},"".concat(e.value,"_").concat(a))}))]},e.value)}))})]}),(0,h.jsx)("div",{className:"btns",children:(0,h.jsx)("button",{className:"btn",disabled:C,children:n?"Update":"Submit"})})]})})},v=a(5804),g=a(657),j=function(e){var n=e.setSidebarOpen,a=(0,r.useContext)(c.D).checkPermission,_=(0,r.useState)([]),f=(0,t.Z)(_,2),p=f[0],x=f[1],j=(0,r.useState)([]),N=(0,t.Z)(j,2),Z=N[0],y=N[1],S=(0,r.useState)(null),k=(0,t.Z)(S,2),C=k[0],I=k[1],F=(0,r.useState)(!1),R=(0,t.Z)(F,2),w=R[0],D=R[1],V=(0,u.i)(m.Hv.collections).get,A=(0,u.i)(m.Hv.roles),H=A.get,P=A.loading,T=(0,u.i)(m.Hv.roles+"/{ID}").remove;return(0,r.useEffect)((function(){V().then((function(e){var n=e.data;n.success&&x(n.data.map((function(e){return{label:e.name,value:"".concat(e.user,"_").concat(e.name),actions:["read","create","update","delete"]}})))})),H().then((function(e){var n=e.data;if(n.success)return y(n.data)})).catch((function(e){console.log(e),(0,i.N)({type:"error",message:e.message})}))}),[]),(0,h.jsxs)("div",{className:"".concat(d.content," grid gap-1 m-a"),children:[(0,h.jsx)("div",{className:"flex ".concat(d.head),children:(0,h.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return n((function(e){return!e}))},children:[(0,h.jsx)(v.Ps6,{style:{fontSize:"1.75rem"}}),(0,h.jsx)("h2",{children:"All Roles"}),a("role_create")&&(0,h.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),D(!0)},children:(0,h.jsx)(g.ueT,{})})]})}),(0,h.jsx)(l.iA,{loading:P,className:d.roles,columns:[{label:"Name"},{label:"Action"}],children:Z.map((function(e){return(0,h.jsxs)("tr",{onClick:function(){I(e),D(!0)},style:{cursor:"pointer"},children:[(0,h.jsx)("td",{className:d.date,children:e.name}),(0,h.jsx)(l.p2,{className:d.actions,actions:[].concat((0,s.Z)(a("role_update")?[{icon:(0,h.jsx)(o.KHI,{}),label:"View",callBack:function(){I(e),D(!0)}}]:[]),(0,s.Z)(a("role_delete")?[{icon:(0,h.jsx)(o.lp8,{}),label:"Delete",callBack:function(){return(0,i.N)({type:"confirmation",message:"Are you sure you want to remove this role?",callback:function(){T({},{params:{"{ID}":e._id}}).then((function(n){var a=n.data;a.success?y((function(n){return n.filter((function(n){return n._id!==e._id}))})):(0,i.N)({type:"error",message:a.message})}))}})}}]:[]))})]},e._id)}))}),(0,h.jsx)(i.u,{open:w,head:!0,label:"".concat(C?"View / Update":"Add"," Role"),className:d.addRoleFormModal,setOpen:function(){I(null),D(!1)},children:(0,h.jsx)(b,{edit:C,dynamicTables:p,onSuccess:function(e){C?(y((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),I(null)):y((function(n){return[].concat((0,s.Z)(n),[e])})),D(!1)}})})]})}}}]);
//# sourceMappingURL=370.4abd5af8.chunk.js.map