"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[165],{5023:function(e,n,t){t.r(n),t.d(n,{default:function(){return q}});var r=t(2982),a=t(885),s=t(2791),i=t(4581),l=t(6884),c=t(6355),o=t(96),u={content:"purchases_content__m4WWX",purchases:"purchases_purchases__kCm5r",addPurchaseForm:"purchases_addPurchaseForm__LOznS",purchaseDetail:"purchases_purchaseDetail__cnKge",box:"purchases_box__NQhVd",noContent:"purchases_noContent__kqRH8",items:"purchases_items__3BPqW",name:"purchases_name__5FnAQ",itemForm:"purchases_itemForm__TNDpM",mainForm:"purchases_mainForm__dABpj",detail:"purchases_detail__v7UUb",label:"purchases_label__rWLQQ",viewOnly:"purchases_viewOnly__NbCnR",print:"purchases_print__LIm3D",logo:"purchases_logo__qjCru",taxes:"purchases_taxes__U4fZ2",totalAmount:"purchases_totalAmount__uioqy",word:"purchases_word__XJuLP",digit:"purchases_digit__2OhU1",sign:"purchases_sign__slMYm",signature:"purchases_signature__5yZi8",date:"purchases_date__e5owG",no:"purchases_no__4oXoh",vendor:"purchases_vendor__4fU8v",net:"purchases_net__8T7Eo",actions:"purchases_actions__5k5p+",itemName:"purchases_itemName__7a2oC"},d=t(5454),m=t(1080),h=t(1413),p=t(1134),x=t(1570),v=t(1146),f=t(184),j=function(e){var n=e.label,t=e.value;return(0,f.jsxs)("p",{className:u.detail,children:[(0,f.jsx)("span",{className:u.label,children:n}),":"," ",(0,f.jsx)("span",{className:u.value,children:t})]})},b=(0,s.forwardRef)((function(e,n){var t,c,o,d,m,p,x,v,b,N=e.purchase,g=e.user,_=(0,s.useContext)(i.D).config,y=(0,s.useState)(null),D=(0,a.Z)(y,2),S=D[0],q=D[1];return(0,s.useEffect)((function(){var e=["no","product","qty","unit","total"],n=(0,r.Z)(_.print.itemColumns.sort((function(n,t){return e.indexOf(n)>e.indexOf(t)?1:-1})).filter((function(e){return!["no","product"].includes(e)})));q({gridTemplateColumns:"".concat(_.print.itemColumns.includes("no")?"3rem":""," ").concat(_.print.itemColumns.includes("product")?42-6*n.length+"rem":""," repeat(auto-fit, minmax(86px, 1fr))")})}),[N]),(0,f.jsxs)("div",{className:u.print,ref:n,children:[(0,f.jsxs)("header",{children:[g.logo&&(0,f.jsx)("img",{className:u.logo,src:g.logo}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h2",{children:g.name}),g.motto&&(0,f.jsx)("p",{children:g.motto})]}),(0,f.jsx)("h4",{children:"Invoice"})]}),(0,f.jsxs)("div",{className:"".concat(u.info," flex wrap gap-1 mt-1"),children:[(0,f.jsxs)("div",{className:"".concat(u.box," flex-1"),children:[(0,f.jsx)("p",{children:"To:"}),(0,f.jsx)(j,{label:"Name",value:null===(t=N.vendor)||void 0===t?void 0:t.name}),(0,f.jsx)(j,{label:"Detail",value:(null===(c=N.vendor)||void 0===c||null===(o=c.detail)||void 0===o?void 0:o.split("\n").map((function(e,n,t){return(0,f.jsxs)("span",{children:[e,t[n+1]&&(0,f.jsx)("br",{})]},n)})))||null})]}),(0,f.jsxs)("div",{className:"".concat(u.box," flex-1"),children:[(0,f.jsx)(j,{label:"Inv No",value:"".concat(N.no).concat((null===(d=_.print)||void 0===d?void 0:d.purchaseNoSuffix)||"")}),(0,f.jsx)(j,{label:"Date",value:(0,l._7)(null===N||void 0===N?void 0:N.date,"DD-MM-YYYY")}),(0,f.jsx)(j,{label:"GSTIN",value:g.gstin}),(0,f.jsx)(j,{label:"PAN",value:g.pan}),g.bankDetails&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(j,{label:"Bank",value:g.bankDetails.bankName}),(0,f.jsx)(j,{label:"Branch",value:g.bankDetails.branch}),(0,f.jsx)(j,{label:"A/C No.",value:g.bankDetails.accNo})]}),(0,f.jsx)(j,{label:"IFSC",value:g.ifsc}),(0,f.jsx)(j,{label:"Address",value:g.address}),(0,f.jsx)(j,{label:"Phone",value:g.phone}),(0,f.jsx)(j,{label:"Email",value:g.email})]})]}),_.print.itemColumns.length>0&&(0,f.jsx)(l.iA,{className:"".concat(u.items," mt-1"),theadTrStyle:(0,h.Z)({},S),columns:_.print.itemColumns.map((function(e){return"no"===e?{label:"No"}:"product"===e?{label:"Product"}:"price"===e?{label:"Price",className:"text-right"}:"qty"===e?{label:"QTY",className:"text-right"}:"unit"===e?{label:"Unit"}:"total"===e?{label:"Total (".concat(_.print.currency,")"),className:"text-right"}:void 0})),children:N.items.map((function(e,n){return(0,f.jsxs)("tr",{style:(0,h.Z)({},S),children:[_.print.itemColumns.includes("no")&&(0,f.jsx)("td",{children:n+1}),_.print.itemColumns.includes("product")&&(0,f.jsx)("td",{children:(0,f.jsx)("span",{className:"ellipsis",children:e.name})}),_.print.itemColumns.includes("price")&&(0,f.jsx)("td",{className:"text-right",children:e.price.fix(2,null===_||void 0===_?void 0:_.numberSeparator)}),_.print.itemColumns.includes("qty")&&(0,f.jsx)("td",{className:"text-right",children:e.qty}),_.print.itemColumns.includes("unit")&&(0,f.jsx)("td",{children:e.unit}),_.print.itemColumns.includes("total")&&(0,f.jsx)("td",{className:"text-right",children:(e.price*e.qty).fix(2,null===_||void 0===_?void 0:_.numberSeparator)})]},n)}))}),N.gst&&(0,f.jsx)(l.iA,{className:"".concat(u.taxes," mt-1"),columns:[{label:"No."},{label:"Description of Tax"},{label:"Rate of Tax",className:"text-right"},{label:"Taxable Amount (".concat(_.print.currency,")"),className:"text-right"},{label:"Tax Amount (".concat(_.print.currency,")"),className:"text-right"}],children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:"1"}),(0,f.jsx)("td",{children:"Integrated GST"}),(0,f.jsx)("td",{className:"text-right",children:N.gst.fix(2,null===_||void 0===_?void 0:_.numberSeparator)}),(0,f.jsx)("td",{className:"text-right",children:N.items.reduce((function(e,n){return e+n.qty*n.price}),0).fix(2,null===_||void 0===_?void 0:_.numberSeparator)}),(0,f.jsx)("td",{className:"text-right",children:N.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(N.gst).fix(2,null===_||void 0===_?void 0:_.numberSeparator)})]})}),(0,f.jsxs)("div",{className:"".concat(u.totalAmount," mt-1"),children:[(0,f.jsxs)("p",{className:u.word,children:["Total:"," ",(N.items.reduce((function(e,n){return e+n.qty*n.price}),0)+N.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(N.gst||0)).toWords()]}),(0,f.jsx)("p",{className:u.digit,children:(N.items.reduce((function(e,n){return e+n.qty*n.price}),0)+N.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(N.gst||0)).fix(2,null===_||void 0===_?void 0:_.numberSeparator)})]}),((null===(m=g.terms)||void 0===m?void 0:m.length)||(null===(p=g.ownerDetails)||void 0===p?void 0:p.name))&&(0,f.jsxs)("footer",{className:"flex gap-1 align-end mt-1",children:[(null===(x=g.terms)||void 0===x?void 0:x.length)>0&&(0,f.jsxs)("div",{className:"".concat(u.box," flex-1 mb-2"),children:[(0,f.jsx)("strong",{children:"Terms & Conditions:"})," ",(0,f.jsx)("ol",{className:"ml-2 mt-1",children:null===(v=g.terms)||void 0===v?void 0:v.map((function(e,n){return(0,f.jsx)("li",{children:e},n)}))})]}),(null===(b=g.ownerDetails)||void 0===b?void 0:b.name)&&(0,f.jsxs)("div",{className:u.sign,children:[(0,f.jsxs)("p",{children:["For ",g.name]}),g.ownerDetails.signature&&(0,f.jsx)("img",{className:u.signature,src:g.ownerDetails.signature}),(0,f.jsx)("p",{children:(0,f.jsx)("strong",{children:g.ownerDetails.name})})]})]})]})})),N=x.Ry({date:x.Z_().required(),gst:x.Rx().required().typeError("Enter a valid Number"),vendorName:x.Z_().required(),vendorDetail:x.Z_().required()}),g=x.Ry({name:x.Z_().required(),price:x.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),qty:x.Rx().min(1,"Qty can not be less than 1").required().typeError("Enter a valid Number"),unit:x.Vo((function(e){switch(typeof e){case"object":return x.Ry().typeError("Select a unit").required();case"string":return x.Z_().required();default:return x.nK().required()}}))}),_=function(e){var n=e.label,t=e.value,r=e.className;return(0,f.jsxs)("p",{className:"".concat(u.detail," ").concat(r||""),children:[(0,f.jsxs)("span",{className:u.label,children:[n,":"]})," ",(0,f.jsx)("span",{className:u.value,children:t})]})},y=function(e){var n=e.edit,t=e.purchases,a=e.onSuccess,c=(0,s.useContext)(i.D).config,o=(0,p.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(g)}),m=o.handleSubmit,x=o.register,v=o.reset,j=o.watch,b=o.setValue,N=o.control,_=o.formState.errors;return(0,s.useEffect)((function(){v((0,h.Z)({},n))}),[n]),(0,f.jsxs)("form",{onSubmit:m((function(e){n||(e._id=Math.random().toString().substr(-8)),a(e),v()})),className:"".concat(u.itemForm," grid gap-1"),children:[(0,f.jsx)(l.Um,{label:"Product",data:t.reduce((function(e,n){return[].concat((0,r.Z)(e),(0,r.Z)(n.items))}),[]).map((function(e){return{label:e.name,value:e.name,data:e}})),register:x,name:"name",formOptions:{required:!0},renderListItem:function(e){return(0,f.jsx)(f.Fragment,{children:e.label})},watch:j,setValue:b,onChange:function(e){"string"===typeof e?b("name",e):(b("name",e.name),b("price",e.price))},error:_.name,className:u.itemName}),(0,f.jsx)(l.II,(0,h.Z)((0,h.Z)({label:"Price",type:"number",required:!0},x("price")),{},{error:_.price})),(0,f.jsx)(l.II,(0,h.Z)((0,h.Z)({label:"Qty",type:"number",required:!0},x("qty")),{},{error:_.qty})),(0,f.jsx)(l.hQ,{label:"Unit",control:N,name:"unit",formOptions:{required:!0},options:c.unitsOfMeasure.map((function(e){return{label:e,value:e}}))}),(0,f.jsx)("button",{className:"btn",children:"Add"})]})},D=function(e){var n=e.disabled,t=e.edit,r=e.items,a=e.purchases,c=e.setErr,x=e.onSuccess,v=(e.setViewOnly,(0,s.useContext)(i.D)),j=(v.config,v.setConfig,(0,p.cI)({resolver:(0,d.y)(N)})),b=j.handleSubmit,g=j.register,_=j.reset,y=j.setValue,D=j.watch,S=j.formState.errors,q=(0,d.i)(m.Hv.purchases+"/".concat((null===t||void 0===t?void 0:t._id)||"")),Z=q.post,C=q.put,w=q.loading;return(0,s.useEffect)((function(){var e,n;_((0,h.Z)((0,h.Z)({},t),{},{date:(0,l._7)(null===t||void 0===t?void 0:t.date,"YYYY-MM-DD"),vendorName:(null===t||void 0===t||null===(e=t.vendor)||void 0===e?void 0:e.name)||"",vendorDetail:(null===t||void 0===t||null===(n=t.vendor)||void 0===n?void 0:n.detail)||""}))}),[t]),(0,f.jsxs)("form",{onSubmit:b((function(e){if(r.length<1)return c("Add at least one item");(t?C:Z)({dateTime:e.date,gst:e.gst,vendor:{name:e.vendorName,detail:e.vendorDetail},items:r.map((function(e){return(0,h.Z)((0,h.Z)({},e),{},{_id:void 0})}))}).then((function(e){var n=e.data;if(!n.success)return(0,o.N)({type:"error",message:n.message});x(n.data)})).catch((function(e){return(0,o.N)({type:"error",message:e.message})}))})),className:"".concat(u.mainForm," grid gap-1"),children:[(0,f.jsx)(l.II,(0,h.Z)((0,h.Z)({label:"Date",type:"date"},g("date")),{},{required:!0,error:S.date})),(0,f.jsx)(l.II,(0,h.Z)((0,h.Z)({label:"GST %",type:"number",required:!0},g("gst")),{},{error:S.gst})),(0,f.jsx)("div",{className:"all-columns",children:(0,f.jsx)("h3",{children:"Vendor Information"})}),(0,f.jsx)(l.Um,{label:"Name",data:a.map((function(e){return{label:e.vendor.name,value:e.vendor.name,data:e.vendor}})),register:g,name:"vendorName",formOptions:{required:!0},renderListItem:function(e){return(0,f.jsx)(f.Fragment,{children:e.label})},watch:D,setValue:y,onChange:function(e){"string"===typeof e?y("vendorName",e):(y("vendorName",e.name),y("vendorDetail",e.detail))},error:S.vendorName}),(0,f.jsx)(l.gx,(0,h.Z)((0,h.Z)({label:"Detail"},g("vendorDetail")),{},{required:!0,error:S.vendorDetail})),(0,f.jsx)("div",{className:"btns",children:(0,f.jsx)("button",{className:"btn",disabled:n||w,children:t?"Update":"Submit"})})]})},S=function(e){var n,t,d,m,h=e.edit,p=e.purchases,x=e.onSuccess,j=(0,s.useContext)(i.D),N=j.user,g=j.config,S=j.checkPermission,q=(0,s.useState)(!!h),Z=(0,a.Z)(q,2),C=Z[0],w=Z[1],I=(0,s.useState)((null===h||void 0===h?void 0:h.items)||[]),k=(0,a.Z)(I,2),A=k[0],P=k[1],T=(0,s.useState)(null),Y=(0,a.Z)(T,2),E=Y[0],F=Y[1],O=(0,s.useState)(null),M=(0,a.Z)(O,2),R=M[0],V=M[1],U=(0,s.useRef)(),B=(0,v.useReactToPrint)({content:function(){return U.current}});return(0,f.jsxs)("div",{className:"grid gap-1 p-1 ".concat(u.addPurchaseForm," ").concat(C?u.viewOnly:""),children:[C&&(0,f.jsxs)("div",{className:"flex wrap gap-1 ".concat(u.purchaseDetail),children:[(0,f.jsxs)("div",{className:"flex gap-1 all-columns justify-end align-center",children:[S("purchase_update")&&(0,f.jsx)("button",{className:"btn",onClick:function(){return w(!1)},children:"Edit"}),(0,f.jsx)("button",{className:"btn",onClick:B,children:"Print"})]}),(0,f.jsxs)("div",{className:u.box,children:[(0,f.jsx)("h3",{children:"Vendor Information"}),(0,f.jsx)(_,{label:"Name",value:null===(n=h.vendor)||void 0===n?void 0:n.name}),(0,f.jsx)(_,{label:"Detail",value:(null===(t=h.vendor)||void 0===t||null===(d=t.detail)||void 0===d?void 0:d.split("\n").map((function(e,n,t){return(0,f.jsxs)("span",{children:[e,t[n+1]&&(0,f.jsx)("br",{})]},n)})))||null})]}),(0,f.jsxs)("div",{className:u.box,children:[(0,f.jsx)("h3",{children:"Purchase Information"}),(0,f.jsx)(_,{label:"Inv No",value:"".concat(h.no).concat((null===(m=g.print)||void 0===m?void 0:m.purchaseNoSuffix)||"")}),(0,f.jsx)(_,{label:"Date",value:(0,l._7)(null===h||void 0===h?void 0:h.date,"DD-MM-YYYY")}),(0,f.jsx)(_,{label:"Gross",value:h.items.reduce((function(e,n){return e+n.qty*n.price}),0).fix(2,null===g||void 0===g?void 0:g.numberSeparator),className:"flex justify-space-between"}),(0,f.jsx)(_,{label:"GST",value:h.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent((null===h||void 0===h?void 0:h.gst)||0).fix(2,null===g||void 0===g?void 0:g.numberSeparator),className:"flex justify-space-between"}),(0,f.jsx)(_,{label:"Total",value:(h.items.reduce((function(e,n){return e+n.qty*n.price}),0)+h.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(h.gst)).fix(2,null===g||void 0===g?void 0:g.numberSeparator),className:"flex justify-space-between"})]})]}),(0,f.jsx)("h3",{children:"Items"}),A.length>0?(0,f.jsx)(l.iA,{className:u.items,columns:[{label:"Product"},{label:"Qty",className:"text-right"},{label:"Unit"},{label:"Rate",className:"text-right"},{label:"Total",className:"text-right"}].concat((0,r.Z)(C?[]:[{label:"Action",action:!0}])),children:A.map((function(e,n){return(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{className:u.name,children:(0,f.jsx)("span",{className:"ellipsis",children:e.name})}),(0,f.jsx)("td",{className:"text-right",children:e.qty}),(0,f.jsx)("td",{children:e.unit}),(0,f.jsx)("td",{className:"text-right",children:e.price.fix(2,null===g||void 0===g?void 0:g.numberSeparator)}),(0,f.jsx)("td",{className:"text-right",children:(e.price*e.qty).fix(2,null===g||void 0===g?void 0:g.numberSeparator)}),!C&&(0,f.jsx)(l.p2,{actions:[{icon:(0,f.jsx)(c.KHI,{}),label:"Edit",callBack:function(){return F(e)}},{icon:(0,f.jsx)(c.lp8,{}),label:"Delete",callBack:function(){return(0,o.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){P((function(n){return n.filter((function(n){return n._id!==e._id}))}))}})}}]})]},n)}))}):(0,f.jsx)("p",{className:u.noContent,children:"No items yet."}),R&&(0,f.jsx)("p",{className:"error",children:R}),h&&(0,f.jsx)("div",{style:{display:"none"},children:(0,f.jsx)(b,{ref:U,purchase:h,user:N})}),!C&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(y,{edit:E,purchases:p,onSuccess:function(e){V(null),E?(P((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),F(null)):P((function(n){return[].concat((0,r.Z)(n),[e])}))}},E?"edit":"add"),(0,f.jsx)("h3",{className:"mt-1",children:"Other Information"}),(0,f.jsx)(D,{disabled:E,edit:h,items:A,purchases:p,setErr:V,onSuccess:x,setViewOnly:w})]})]})},q=function(){var e=(0,s.useContext)(i.D),n=e.config,t=e.checkPermission,h=(0,s.useState)([]),p=(0,a.Z)(h,2),x=p[0],v=p[1],j=(0,s.useState)(null),b=(0,a.Z)(j,2),N=b[0],g=b[1],_=(0,s.useState)(!1),y=(0,a.Z)(_,2),D=y[0],q=y[1],Z=(0,d.i)(m.Hv.purchases),C=Z.get,w=Z.loading,I=(0,d.i)(m.Hv.purchases+"/{ID}").remove;return(0,s.useEffect)((function(){C().then((function(e){var n=e.data;if(n.success)return v(n.data)})).catch((function(e){return(0,o.N)({type:"error",message:e.message})}))}),[]),(0,f.jsxs)("div",{className:"".concat(u.content," grid gap-1 m-a p-1"),children:[(0,f.jsxs)("div",{className:"flex",children:[(0,f.jsx)("h2",{children:"All Purchases"}),t("purchase_create")&&(0,f.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return q(!0)},children:"Add Purchase"})]}),(0,f.jsx)(l.iA,{loading:w,className:u.purchases,columns:[{label:"No."},{label:"Date"},{label:"Customer"},{label:"Net Amount",className:"text-right"},{label:"Action"}],children:x.map((function(e){var a,s;return(0,f.jsxs)("tr",{onClick:function(){g(e),q(!0)},style:{cursor:"pointer"},children:[(0,f.jsxs)("td",{className:u.no,children:[e.no,(null===n||void 0===n||null===(a=n.print)||void 0===a?void 0:a.purchaseNoSuffix)||""]}),(0,f.jsx)("td",{className:u.date,children:(0,f.jsx)(l.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,f.jsx)("td",{className:u.vendor,children:null===(s=e.vendor)||void 0===s?void 0:s.name}),(0,f.jsx)("td",{className:"text-right ".concat(u.net),children:(e.items.reduce((function(e,n){return e+n.qty*n.price}),0)+e.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(e.gst)).fix(2,null===n||void 0===n?void 0:n.numberSeparator)}),(0,f.jsx)(l.p2,{className:u.actions,actions:[{icon:(0,f.jsx)(c.z5B,{}),label:"View",callBack:function(){g(e),q(!0)}}].concat((0,r.Z)(t("purchase_delete")?[{icon:(0,f.jsx)(c.lp8,{}),label:"Delete",callBack:function(){return(0,o.N)({type:"confirmation",message:"Are you sure you want to remove this purchase?",callback:function(){I({},{params:{"{ID}":e._id}}).then((function(n){var t=n.data;t.success?v((function(n){return n.filter((function(n){return n._id!==e._id}))})):(0,o.N)({type:"error",message:t.message})}))}})}}]:[]))})]},e._id)}))}),(0,f.jsx)(o.u,{open:D,head:!0,label:"".concat(N?"View / Update":"Add"," Purchase"),className:u.addPurchaseFormModal,setOpen:function(){g(null),q(!1)},children:(0,f.jsx)(S,{edit:N,purchases:x,onSuccess:function(e){N?(v((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),g(null)):v((function(n){return[].concat((0,r.Z)(n),[e])})),q(!1)}})})]})}}}]);
//# sourceMappingURL=165.c1fdd62d.chunk.js.map