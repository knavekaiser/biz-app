"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[916],{5916:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(2982),a=n(1413),i=n(885),l=n(2791),s=n(3806),o={content:"store_content__5-Bs0",head:"store_head__VGYzD",filterBtn:"store_filterBtn__ACEyc",indicator:"store_indicator__ouHaY",active:"store_active__koN+r",filterWrapper:"store_filterWrapper__obDEH",filters:"store_filters__LKG6N",sales:"store_sales__GIqxi",addStoreFormModal:"store_addStoreFormModal__zzuJo",productForm:"store_productForm__hyIkr",mainForm:"store_mainForm__EPMXD",print:"store_print__XB1OQ"},u=n(1080),c=n(8750),d=n(5454),m=n(2202),f=n(4942),p=n(1134),b=n(1570),v=n(184),g=function(e){var t=e._fields,n=e.business,r=e.edit,i=e.onSuccess,c=(0,p.cI)({resolver:(0,d.y)(b.Ry((0,a.Z)((0,a.Z)({},t.map((function(e){var t;return["objectId","string","date"].includes(e.dataType)&&(t=b.Z_()),"number"===e.dataType&&(t=b.Rx().typeError("Please enter a valid number")),"phone"===e.inputType&&(t=b.Z_().phone("Please enter a valid phone number")),["array","variantArray"].includes(e.dataType)&&(t=b.IX(),e.min&&(t=t.min(e.min,"At least ".concat(e.min," items required")))),e.required&&(t=t.required(t.errorMessage||"".concat(e.label," is required"))),t})).reduce((function(e,n,r){var a;return e[null===(a=t[r])||void 0===a?void 0:a.name]=n,e}),{})),{},{url:b.Z_()})))}),m=c.handleSubmit,g=c.register,h=c.reset,y=c.control,x=(c.watch,c.formState.errors),j=t.map((function(e,t){return"object"===e.dataType&&"collectionFilter"===e.fieldType||["array","variantArray"].includes(e.dataType)&&"object"===e.dataElementType?null:"file"===e.inputType?(0,v.jsx)(s.Dj,{control:y,name:e.name,label:e.label,multiple:"images"!==e.name&&e.multiple,formOptions:{required:e.required},thumbnail:!0},e.name):"dateRange"===e.fieldType&&"calendar"===e.inputType?(0,v.jsx)(s.qe,{control:y,label:e.label,name:e.name,dateWindow:e.dateWindow,required:e.required,disabledDates:e.disabledDates||[],multipleRanges:e.multipleRanges},e.name):"input"===e.fieldType?"phone"===e.inputType?(0,v.jsx)(s.C2,{label:e.label,name:e.name,formOptions:{required:e.required},control:y},e.name):(0,v.jsx)(s.II,(0,a.Z)((0,a.Z)({},g(e.name)),{},{type:e.inputType||"text",label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"textarea"===e.fieldType?(0,v.jsx)(s.gx,(0,a.Z)((0,a.Z)({},g(e.name)),{},{label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"combobox"===e.fieldType?(0,v.jsx)(s.hQ,{label:e.label,control:y,name:e.name,multiple:e.multiple,formOptions:{required:e.required},options:e.options||[]},e.name):"select"===e.fieldType?(0,v.jsx)(s.OC,(0,a.Z)((0,a.Z)((0,a.Z)({control:y,label:e.label},"predefined"===e.optionType&&{options:e.options||[]}),"collection"===e.optionType&&{url:"".concat(u.Hv.adminDynamic,"/").concat(e.collection)}),{},{getQuery:function(t,r){return(0,a.Z)((0,a.Z)({business:n},t&&(0,f.Z)({},e.optionLabel,t)),r&&(0,f.Z)({},e.optionValue,r))},handleData:function(t){return{label:t[e.optionLabel],value:t[e.optionValue]}},multiple:e.multiple,name:e.name,formOptions:{required:e.required},className:o.itemName}),e.name):void 0}));return(0,l.useEffect)((function(){h((0,a.Z)((0,a.Z)({},r),{},{images:null!==r&&void 0!==r&&r.image?[null===r||void 0===r?void 0:r.image]:[]}))}),[r]),(0,v.jsx)("div",{children:(0,v.jsxs)("form",{className:"grid gap-1 p-1",onSubmit:m((function(e){var t;null!==(t=e.images)&&void 0!==t&&t[0]&&(e.image=e.images[0],delete e.images),i((0,a.Z)((0,a.Z)({},e),{},{_id:(null===r||void 0===r?void 0:r._id)||Math.random().toString(32).substr(-8)}))})),children:[j,(0,v.jsx)(s.II,(0,a.Z)({label:"URL"},g("url"))),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",children:r?"Update":"Submit"})})]})})},h=function(e){var t=e.edit,n=e.onSuccess,f=(0,l.useState)([]),h=(0,i.Z)(f,2),y=h[0],x=h[1],j=(0,l.useState)(null),_=(0,i.Z)(j,2),Z=_[0],N=_[1],S=(0,p.cI)({resolver:(0,d.y)(b.Ry({start:b.Z_().required().typeError("Please select start date"),end:b.Z_().required().typeError("Please select start date"),category:b.Z_().required("field is required")}))}),D=S.handleSubmit,q=S.register,C=S.reset,O=S.control,I=S.watch,M=S.setValue,T=S.formState.errors,F=(0,l.useState)([]),A=(0,i.Z)(F,2),Y=A[0],k=A[1],E=(0,l.useState)([]),B=(0,i.Z)(E,2),w=B[0],H=B[1],P=(0,l.useState)(null),R=(0,i.Z)(P,2),U=(R[0],R[1]),W=(0,d.i)(u.Hv.stores+"/".concat((null===t||void 0===t?void 0:t._id)||"")),L=W.post,Q=W.put,z=W.loading,G=I("business"),V=I("category"),X=I("subcategory"),K=I("products"),J=I("featured"),$=(0,d.i)(u.Hv.adminDynamic+"/Store Category"),ee=$.get,te=($.loading,(0,d.i)(u.Hv.adminDynamic+"/Store Subcategory")),ne=te.get;te.loading;(0,l.useEffect)((function(){ee().then((function(e){var t=e.data;return t.success?t.data.length>0?void k(t.data):(0,c.N)({type:"error",message:"Please add at least one category to proceed."}):(0,c.N)({type:"error",message:t.message})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[]),(0,l.useEffect)((function(){ne({query:{category:V}}).then((function(e){var n=e.data;n.success&&(H(n.data),null!==t&&void 0!==t&&t.subcategory&&U(n.data.find((function(e){return e.name===(null===t||void 0===t?void 0:t.subcategory)}))||null))})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[V]);var re=I("start"),ae=I("end");return(0,l.useEffect)((function(){var e;C((0,a.Z)((0,a.Z)({},t),{},{featured:(null===t||void 0===t?void 0:t.featured)||!1,products:(null===t||void 0===t?void 0:t.products)||[],business:(null===t||void 0===t||null===(e=t.business)||void 0===e?void 0:e._id)||"",order:(null===t||void 0===t?void 0:t.order)||[],start:null!==t&&void 0!==t&&t.start?(0,s._7)(t.start,"YYYY-MM-DD"):"",end:null!==t&&void 0!==t&&t.end?(0,s._7)(t.end,"YYYY-MM-DD"):""}))}),[t]),(0,v.jsxs)("div",{className:"grid gap-1 p-1",children:[(0,v.jsxs)("form",{onSubmit:D((function(e){delete e.image;var r=(0,a.Z)({},e);e.products.forEach((function(e,t){var n;null!==(n=e.image)&&void 0!==n&&n.type&&(r["products__".concat(t,"__image")]=e.image)}));var l=new FormData;Object.entries(r).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];null!==r&&void 0!==r&&r.type?l.append(n,r):"object"===typeof r?l.append(n,JSON.stringify(r)):l.append(n,r)})),(t?Q:L)(l).then((function(e){var t=e.data;if(!t.success)return(0,c.N)({type:"error",message:t.message});n(t.data)})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))})),className:"".concat(o.mainForm," grid gap-1"),children:[(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:O,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,a.Z)((0,a.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",formOptions:{required:!0}}),G&&(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:O,label:"Category",options:Y.map((function(e){return{label:e.name,value:e.name}})),name:"category",onChange:function(e){null!==e&&void 0!==e&&e.value||M("subcategory","")},formOptions:{required:!0}}),V&&(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:O,label:"Subcategory",options:w.filter((function(e){var t;return(null===(t=e.category)||void 0===t?void 0:t.name)===V})).map((function(e){return{label:e.name,value:e.name,fields:e.fields}})),name:"subcategory",onChange:function(e){e.value&&(U(w.find((function(t){return t.name===e.value}))),x(e.fields||[]))},formOptions:{required:!0}}),V&&X&&(0,v.jsxs)("div",{className:"grid gap-1",children:[(0,v.jsx)(s.II,(0,a.Z)((0,a.Z)({type:"date",label:"Start Date*",max:ae},q("start")),{},{error:T.start})),(0,v.jsx)(s.II,(0,a.Z)((0,a.Z)({type:"date",label:"End Date*",min:re},q("end")),{},{error:T.end})),(0,v.jsx)(s.XZ,(0,a.Z)({label:"Featured"},q("featured"))),(0,v.jsxs)("div",{className:"flex justify-space-between align-center",children:[(0,v.jsx)("h3",{children:"Products"}),((K||[]).length<1||J)&&(0,v.jsx)("button",{type:"button",className:"btn",onClick:function(){return N(!0)},children:"Add Product"})]}),(0,v.jsx)(s.iA,{columns:[{label:"Title"},{label:"Image"},{label:"Actions"}],children:(K||[]).map((function(e){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.title}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:"string"===typeof e.image?e.image:URL.createObjectURL(e.image)})}),(0,v.jsx)(s.p2,{actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){N(e)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this product?",callback:function(){M("products",K.filter((function(t){return t._id!==e._id})))}})}}]})]},e._id)}))})]}),V&&X&&y.length>0&&(0,v.jsx)(s.rG,{control:O,name:"order",multiple:!0,label:"Card Elements (Move items to reorder)",sortable:!0,options:y.filter((function(e){return!["title","images"].includes(e.name)})).sort((function(e,n,r){return((null===t||void 0===t?void 0:t.order)||[]).includes(e.name)?((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(t){return t===e.name}))>((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(e){return e===n.name}))?1:-1:1})).reverse().map((function(e,t,n){return{label:e.label,value:e.name,order:n.length-t}}))}),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",disabled:z,children:t?"Update":"Submit"})})]}),(0,v.jsx)(c.u,{open:Z,setOpen:function(){return N(null)},head:!0,label:"".concat(null!==t&&void 0!==t&&t._id?"Update":"Add"," Product"),className:o.productForm,children:(0,v.jsx)(g,{_fields:y,business:G,edit:null!==Z&&void 0!==Z&&Z._id?Z:null,onSuccess:function(e){M("products",null!==Z&&void 0!==Z&&Z._id?K.map((function(t){return t._id===e._id?e:t})):[].concat((0,r.Z)(K),[e])),N(null)}})})]})},y=n(6871),x=n(5804),j=n(657),_=n(8744),Z=function(e){var t,n=e.showFilter,r=(e.filters,e.setFilters),c=(0,l.useRef)(),d=(0,p.cI)(),m=d.handleSubmit,f=(d.register,d.control),b=d.reset;d.watch;return(0,v.jsx)("div",{style:{height:"".concat(n&&(null===(t=c.current)||void 0===t?void 0:t.scrollHeight)||0,"px")},className:o.filterWrapper,children:(0,v.jsxs)("form",{ref:c,className:o.filters,onSubmit:m((function(e){r(Object.entries(e).reduce((function(e,t){var n=(0,i.Z)(t,2),r=n[0],a=n[1];return void 0!==a&&(e[r]=a),e}),{}))})),children:[(0,v.jsx)(s.OC,{control:f,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,a.Z)((0,a.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",className:o.itemName}),(0,v.jsx)(s.OC,{control:f,label:"Category",url:u.Hv.adminDynamic+"/Store Category",getQuery:function(e,t){return(0,a.Z)((0,a.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"category",className:o.itemName}),(0,v.jsx)(s.hQ,{label:"Featured",control:f,name:"featured",options:[{label:"Yes",value:!0},{label:"No",value:!1}]}),(0,v.jsxs)("div",{className:"btns",children:[(0,v.jsx)("button",{className:"btn",children:"Search"}),(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){b(),r({})},children:"Clear"})]})]})})},N=function(e){var t=e.setSidebarOpen,n=(0,l.useState)([]),a=(0,i.Z)(n,2),f=a[0],p=a[1],b=(0,l.useState)(!1),g=(0,i.Z)(b,2),N=g[0],S=g[1],D=(0,l.useState)(null),q=(0,i.Z)(D,2),C=q[0],O=q[1],I=(0,l.useState)({}),M=(0,i.Z)(I,2),T=M[0],F=M[1],A=(0,l.useState)(!1),Y=(0,i.Z)(A,2),k=Y[0],E=Y[1],B=(0,d.i)(u.Hv.stores),w=B.get,H=B.loading,P=((0,y.s0)(),(0,d.i)(u.Hv.stores+"/{ID}")),R=P.remove;P.deleting;return(0,l.useEffect)((function(){w({query:T}).then((function(e){var t=e.data;t.success?p(t.data):(0,c.N)({type:"error",message:t.message})})).catch((function(e){return(0,c.N)({type:"error",message:e.message})}))}),[T]),(0,v.jsxs)("div",{className:"".concat(o.content," grid gap-1 m-a"),children:[(0,v.jsxs)("div",{className:"".concat(o.head," flex justify-space-between"),children:[(0,v.jsxs)("div",{className:"flex align-center pointer gap_5  ml-1",onClick:function(){return t((function(e){return!e}))},children:[(0,v.jsx)(x.Ps6,{style:{fontSize:"1.75rem"}}),(0,v.jsx)("h2",{children:"All Listings"}),(0,v.jsx)("button",{className:"btn clear iconOnly",onClick:function(e){e.stopPropagation(),S(!0)},children:(0,v.jsx)(j.ueT,{})})]}),(0,v.jsx)("div",{className:"flex gap-1",children:(0,v.jsxs)("button",{title:"Toggle Filters",className:"btn clear ".concat(o.filterBtn),onClick:function(){return E(!k)},children:[(0,v.jsx)("span",{className:"".concat(o.indicator," ").concat(Object.values(T).length>0?o.active:"")}),(0,v.jsx)(_.lOx,{})]})})]}),(0,v.jsx)(Z,{showFilter:k,filters:T,setFilters:F}),(0,v.jsx)(s.iA,{loading:H,className:o.sales,columns:[{label:"Created At"},{label:"Business"},{label:"Category"},{label:"Subcategory"},{label:"Created By"},{label:"Effective Period"},{label:"Featured"},{label:"Action"}],children:f.map((function(e){var t,n;return(0,v.jsxs)("tr",{style:{cursor:"pointer"},children:[(0,v.jsx)("td",{children:(0,v.jsx)(s.W7,{format:"MMM DD, YY hh:mma",children:e.createdAt})}),(0,v.jsx)("td",{children:null===(t=e.business)||void 0===t?void 0:t.name}),(0,v.jsx)("td",{children:e.category}),(0,v.jsx)("td",{children:e.subcategory}),(0,v.jsx)("td",{children:null===(n=e.createdBy)||void 0===n?void 0:n.name}),(0,v.jsxs)("td",{children:[(0,v.jsx)(s.W7,{format:"MMM DD, YY",children:e.start})," -"," ",(0,v.jsx)(s.W7,{format:"MMM DD, YY",children:e.end})]}),(0,v.jsx)("td",{children:e.featured?"Yes":"No"}),(0,v.jsx)(s.p2,{className:o.actions,actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){O(e),S(!0)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,c.N)({type:"confirmation",message:"Are you sure you want to remove this listing?",callback:function(){R({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?p((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,c.N)({type:"error",message:n.message})}))}})}}]})]},e._id)}))}),(0,v.jsx)(c.u,{open:N,head:!0,label:"".concat(C?"Update":"Add"," Store"),className:o.addStoreFormModal,setOpen:function(){O(null),S(!1)},children:(0,v.jsx)(h,{edit:C,onSuccess:function(e){C?(p((function(t){return e?t.map((function(t){return t._id===e._id?e:t})):t.filter((function(e){return e._id!==C._id}))})),O(null)):p((function(t){return[].concat((0,r.Z)(t),[e])})),S(!1)}})})]})}}}]);
//# sourceMappingURL=916.ac32de9c.chunk.js.map