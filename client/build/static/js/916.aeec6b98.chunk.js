"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[916],{5916:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var a=n(2982),r=n(1413),i=n(885),l=n(2791),s=n(6884),o={content:"store_content__5-Bs0",sales:"store_sales__GIqxi",filters:"store_filters__LKG6N",addStoreFormModal:"store_addStoreFormModal__zzuJo",productForm:"store_productForm__hyIkr",mainForm:"store_mainForm__EPMXD",print:"store_print__XB1OQ"},u=n(1080),d=n(96),c=n(5454),m=n(6355),f=n(4942),p=n(1134),b=n(1570),v=n(184),g=function(e){var t=e._fields,n=e.business,a=e.edit,i=e.onSuccess,d=(0,p.cI)({resolver:(0,c.y)(b.Ry((0,r.Z)((0,r.Z)({},t.map((function(e){var t;return["objectId","string","date"].includes(e.dataType)&&(t=b.Z_()),"number"===e.dataType&&(t=b.Rx().typeError("Please enter a valid number")),"phone"===e.inputType&&(t=b.Z_().phone("Please enter a valid phone number")),["array","variantArray"].includes(e.dataType)&&(t=b.IX(),e.min&&(t=t.min(e.min,"At least ".concat(e.min," items required")))),e.required&&(t=t.required(t.errorMessage||"".concat(e.label," is required"))),t})).reduce((function(e,n,a){var r;return e[null===(r=t[a])||void 0===r?void 0:r.name]=n,e}),{})),{},{url:b.Z_()})))}),m=d.handleSubmit,g=d.register,y=d.reset,h=d.control,x=(d.watch,d.formState.errors),j=t.map((function(e,t){return"object"===e.dataType&&"collectionFilter"===e.fieldType||["array","variantArray"].includes(e.dataType)&&"object"===e.dataElementType?null:"file"===e.inputType?(0,v.jsx)(s.Dj,{control:h,name:e.name,label:e.label,multiple:"images"!==e.name&&e.multiple,formOptions:{required:e.required},thumbnail:!0},e.name):"dateRange"===e.fieldType&&"calendar"===e.inputType?(0,v.jsx)(s.qe,{control:h,label:e.label,name:e.name,dateWindow:e.dateWindow,required:e.required,disabledDates:e.disabledDates||[],multipleRanges:e.multipleRanges},e.name):"input"===e.fieldType?"phone"===e.inputType?(0,v.jsx)(s.C2,{label:e.label,name:e.name,formOptions:{required:e.required},control:h},e.name):(0,v.jsx)(s.II,(0,r.Z)((0,r.Z)({},g(e.name)),{},{type:e.inputType||"text",label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"textarea"===e.fieldType?(0,v.jsx)(s.gx,(0,r.Z)((0,r.Z)({},g(e.name)),{},{label:e.label,required:e.required,error:x[e.name],autoFocus:0===t}),e.name):"combobox"===e.fieldType?(0,v.jsx)(s.hQ,{label:e.label,control:h,name:e.name,multiple:e.multiple,formOptions:{required:e.required},options:e.options||[]},e.name):"select"===e.fieldType?(0,v.jsx)(s.OC,(0,r.Z)((0,r.Z)((0,r.Z)({control:h,label:e.label},"predefined"===e.optionType&&{options:e.options||[]}),"collection"===e.optionType&&{url:"".concat(u.Hv.adminDynamic,"/").concat(e.collection)}),{},{getQuery:function(t,a){return(0,r.Z)((0,r.Z)({business:n},t&&(0,f.Z)({},e.optionLabel,t)),a&&(0,f.Z)({},e.optionValue,a))},handleData:function(t){return{label:t[e.optionLabel],value:t[e.optionValue]}},multiple:e.multiple,name:e.name,formOptions:{required:e.required},className:o.itemName}),e.name):void 0}));return(0,l.useEffect)((function(){y((0,r.Z)((0,r.Z)({},a),{},{images:null!==a&&void 0!==a&&a.image?[null===a||void 0===a?void 0:a.image]:[]}))}),[a]),(0,v.jsx)("div",{children:(0,v.jsxs)("form",{className:"grid gap-1 p-1",onSubmit:m((function(e){var t;null!==(t=e.images)&&void 0!==t&&t[0]&&(e.image=e.images[0],delete e.images),i((0,r.Z)((0,r.Z)({},e),{},{_id:(null===a||void 0===a?void 0:a._id)||Math.random().toString(32).substr(-8)}))})),children:[j,(0,v.jsx)(s.II,(0,r.Z)({label:"URL"},g("url"))),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",children:a?"Update":"Submit"})})]})})},y=function(e){var t=e.edit,n=e.onSuccess,f=(0,l.useState)([]),y=(0,i.Z)(f,2),h=y[0],x=y[1],j=(0,l.useState)(null),_=(0,i.Z)(j,2),Z=_[0],N=_[1],S=(0,p.cI)({resolver:(0,c.y)(b.Ry({start:b.Z_().required().typeError("Please select start date"),end:b.Z_().required().typeError("Please select start date"),category:b.Z_().required("field is required")}))}),C=S.handleSubmit,q=S.register,D=S.reset,I=S.control,M=S.watch,O=S.setValue,T=S.formState.errors,A=(0,l.useState)([]),F=(0,i.Z)(A,2),k=F[0],Y=F[1],E=(0,l.useState)([]),B=(0,i.Z)(E,2),H=B[0],w=B[1],P=(0,l.useState)(null),R=(0,i.Z)(P,2),U=(R[0],R[1]),L=(0,c.i)(u.Hv.stores+"/".concat((null===t||void 0===t?void 0:t._id)||"")),Q=L.post,W=L.put,X=L.loading,G=M("business"),K=M("category"),V=M("subCategory"),z=M("products"),J=M("featured"),$=(0,c.i)(u.Hv.adminDynamic+"/Store Category"),ee=$.get,te=($.loading,(0,c.i)(u.Hv.adminDynamic+"/Store Subcategory")),ne=te.get;te.loading;(0,l.useEffect)((function(){ee().then((function(e){var t=e.data;return t.success?t.data.length>0?void Y(t.data):(0,d.N)({type:"error",message:"Please add at least one category to proceed."}):(0,d.N)({type:"error",message:t.message})})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[]),(0,l.useEffect)((function(){ne({query:{category:K}}).then((function(e){var n=e.data;n.success&&(w(n.data),null!==t&&void 0!==t&&t.subCategory&&U(n.data.find((function(e){return e.name===(null===t||void 0===t?void 0:t.subCategory)}))||null))})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[K]);var ae=M("start"),re=M("end");return(0,l.useEffect)((function(){var e;D((0,r.Z)((0,r.Z)({},t),{},{featured:(null===t||void 0===t?void 0:t.featured)||!1,products:(null===t||void 0===t?void 0:t.products)||[],business:(null===t||void 0===t||null===(e=t.business)||void 0===e?void 0:e._id)||"",order:(null===t||void 0===t?void 0:t.order)||[],start:null!==t&&void 0!==t&&t.start?(0,s._7)(t.start,"YYYY-MM-DD"):"",end:null!==t&&void 0!==t&&t.end?(0,s._7)(t.end,"YYYY-MM-DD"):""}))}),[t]),(0,v.jsxs)("div",{className:"grid gap-1 p-1",children:[(0,v.jsxs)("form",{onSubmit:C((function(e){delete e.image;var a=(0,r.Z)({},e);e.products.forEach((function(e,t){var n;null!==(n=e.image)&&void 0!==n&&n.type&&(a["products__".concat(t,"__image")]=e.image)}));var l=new FormData;Object.entries(a).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],a=t[1];null!==a&&void 0!==a&&a.type?l.append(n,a):"object"===typeof a?l.append(n,JSON.stringify(a)):l.append(n,a)})),(t?W:Q)(l).then((function(e){var t=e.data;if(!t.success)return(0,d.N)({type:"error",message:t.message});n(t.data)})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))})),className:"".concat(o.mainForm," grid gap-1"),children:[(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",formOptions:{required:!0}}),G&&(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Category",options:k.map((function(e){return{label:e.name,value:e.name}})),name:"category",onChange:function(e){null!==e&&void 0!==e&&e.value||O("subCategory","")},formOptions:{required:!0}}),K&&(0,v.jsx)(s.OC,{disabled:null===t||void 0===t?void 0:t._id,control:I,label:"Subcategory",options:H.filter((function(e){var t;return(null===(t=e.category)||void 0===t?void 0:t.name)===K})).map((function(e){return{label:e.name,value:e._id,fields:e.fields}})),name:"subCategory",onChange:function(e){e.value&&(U(H.find((function(t){return t.name===e.value}))),x(e.fields||[]))},formOptions:{required:!0}}),K&&V&&(0,v.jsxs)("div",{className:"grid gap-1",children:[(0,v.jsx)(s.II,(0,r.Z)((0,r.Z)({type:"date",label:"Start Date*",max:re},q("start")),{},{error:T.start})),(0,v.jsx)(s.II,(0,r.Z)((0,r.Z)({type:"date",label:"End Date*",min:ae},q("end")),{},{error:T.end})),(0,v.jsx)(s.XZ,(0,r.Z)({label:"Featured"},q("featured"))),(0,v.jsxs)("div",{className:"flex justify-space-between align-center",children:[(0,v.jsx)("h3",{children:"Products"}),((z||[]).length<1||J)&&(0,v.jsx)("button",{type:"button",className:"btn",onClick:function(){return N(!0)},children:"Add Product"})]}),(0,v.jsx)(s.iA,{columns:[{label:"Title"},{label:"Image"},{label:"Actions"}],children:(z||[]).map((function(e){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.title}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:"string"===typeof e.image?e.image:URL.createObjectURL(e.image)})}),(0,v.jsx)(s.p2,{actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){N(e)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,d.N)({type:"confirmation",message:"Are you sure you want to remove this product?",callback:function(){O("products",z.filter((function(t){return t._id!==e._id})))}})}}]})]},e._id)}))})]}),K&&V&&h.length>0&&(0,v.jsx)(s.rG,{control:I,name:"order",multiple:!0,label:"Card Elements (Move items to reorder)",sortable:!0,options:h.filter((function(e){return!["title","images"].includes(e.name)})).sort((function(e,n,a){return((null===t||void 0===t?void 0:t.order)||[]).includes(e.name)?((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(t){return t===e.name}))>((null===t||void 0===t?void 0:t.order)||[]).findIndex((function(e){return e===n.name}))?1:-1:1})).reverse().map((function(e,t,n){return{label:e.label,value:e.name,order:n.length-t}}))}),(0,v.jsx)("div",{className:"btns",children:(0,v.jsx)("button",{className:"btn",disabled:X,children:t?"Update":"Submit"})})]}),(0,v.jsx)(d.u,{open:Z,setOpen:function(){return N(null)},head:!0,label:"".concat(null!==t&&void 0!==t&&t._id?"Update":"Add"," Product"),className:o.productForm,children:(0,v.jsx)(g,{_fields:h,business:G,edit:null!==Z&&void 0!==Z&&Z._id?Z:null,onSuccess:function(e){O("products",null!==Z&&void 0!==Z&&Z._id?z.map((function(t){return t._id===e._id?e:t})):[].concat((0,a.Z)(z),[e])),N(null)}})})]})},h=n(6871),x=function(e){e.filters;var t=e.setFilters,n=(0,p.cI)(),a=n.handleSubmit,l=(n.register,n.control),d=n.reset;n.watch;return(0,v.jsxs)("form",{className:o.filters,onSubmit:a((function(e){t(Object.entries(e).reduce((function(e,t){var n=(0,i.Z)(t,2),a=n[0],r=n[1];return void 0!==r&&(e[a]=r),e}),{}))})),children:[(0,v.jsx)(s.OC,{control:l,label:"Business",url:u.Hv.findBusinesses,getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"business",className:o.itemName}),(0,v.jsx)(s.OC,{control:l,label:"Category",url:u.Hv.adminDynamic+"/Store Category",getQuery:function(e,t){return(0,r.Z)((0,r.Z)({},e&&{name:e}),t&&{_id:t})},handleData:function(e){return{label:e.name,value:e._id}},name:"category",className:o.itemName}),(0,v.jsx)(s.hQ,{label:"Featured",control:l,name:"featured",options:[{label:"Yes",value:!0},{label:"No",value:!1}]}),(0,v.jsxs)("div",{className:"btns",children:[(0,v.jsx)("button",{className:"btn",children:"Search"}),(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){d(),t({})},children:"Clear"})]})]})},j=function(){var e=(0,l.useState)([]),t=(0,i.Z)(e,2),n=t[0],r=t[1],f=(0,l.useState)(!1),p=(0,i.Z)(f,2),b=p[0],g=p[1],j=(0,l.useState)(null),_=(0,i.Z)(j,2),Z=_[0],N=_[1],S=(0,l.useState)({}),C=(0,i.Z)(S,2),q=C[0],D=C[1],I=(0,c.i)(u.Hv.stores),M=I.get,O=I.loading,T=(0,h.s0)(),A=(0,c.i)(u.Hv.stores+"/{ID}"),F=A.remove;A.deleting;return(0,l.useEffect)((function(){M({query:q}).then((function(e){var t=e.data;t.success?r(t.data):(0,d.N)({type:"error",message:t.message})})).catch((function(e){return(0,d.N)({type:"error",message:e.message})}))}),[q]),(0,v.jsxs)("div",{className:"".concat(o.content," grid gap-1 m-a p-1"),children:[(0,v.jsxs)("div",{className:"flex justify-space-between",children:[(0,v.jsx)("h2",{children:"All Listings"}),(0,v.jsxs)("div",{className:"flex gap-1",children:[(0,v.jsx)("button",{className:"btn",onClick:function(){return T(u.Hb.dashboard.replace("*","")+u.Hb.stores)},children:"Back"}),(0,v.jsx)("button",{className:"btn",onClick:function(){return g(!0)},children:"Add Listing"})]})]}),(0,v.jsx)(x,{filters:q,setFilters:D}),(0,v.jsx)(s.iA,{loading:O,className:o.sales,columns:[{label:"Created At"},{label:"Business"},{label:"Category"},{label:"Sub Category"},{label:"Created By"},{label:"Effective Period"},{label:"Featured"},{label:"Action"}],children:n.map((function(e){var t,n;return(0,v.jsxs)("tr",{style:{cursor:"pointer"},children:[(0,v.jsx)("td",{children:(0,v.jsx)(s.W7,{format:"MMM DD, YY hh:mma",children:e.createdAt})}),(0,v.jsx)("td",{children:null===(t=e.business)||void 0===t?void 0:t.name}),(0,v.jsx)("td",{children:e.category}),(0,v.jsx)("td",{children:e.subCategory}),(0,v.jsx)("td",{children:null===(n=e.createdBy)||void 0===n?void 0:n.name}),(0,v.jsxs)("td",{children:[(0,v.jsx)(s.W7,{format:"MMM DD, YY",children:e.start})," -"," ",(0,v.jsx)(s.W7,{format:"MMM DD, YY",children:e.end})]}),(0,v.jsx)("td",{children:e.featured?"Yes":"No"}),(0,v.jsx)(s.p2,{className:o.actions,actions:[{icon:(0,v.jsx)(m.KHI,{}),label:"Update",callBack:function(){N(e),g(!0)}},{icon:(0,v.jsx)(m.AMf,{}),label:"Delete",callBack:function(){return(0,d.N)({type:"confirmation",message:"Are you sure you want to remove this listing?",callback:function(){F({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?r((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,d.N)({type:"error",message:n.message})}))}})}}]})]},e._id)}))}),(0,v.jsx)(d.u,{open:b,head:!0,label:"".concat(Z?"Update":"Add"," Store"),className:o.addStoreFormModal,setOpen:function(){N(null),g(!1)},children:(0,v.jsx)(y,{edit:Z,onSuccess:function(e){Z?(r((function(t){return e?t.map((function(t){return t._id===e._id?e:t})):t.filter((function(e){return e._id!==Z._id}))})),N(null)):r((function(t){return[].concat((0,a.Z)(t),[e])})),g(!1)}})})]})}}}]);
//# sourceMappingURL=916.aeec6b98.chunk.js.map