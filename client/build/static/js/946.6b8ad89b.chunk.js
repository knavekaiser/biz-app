"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[946],{2946:function(e,n,t){t.r(n),t.d(n,{default:function(){return D}});var a=t(2982),r=t(885),s=t(2791),o=t(4581),i=t(6884),l=t(6355),u=t(96),c={content:"payments_content__Ypvnj",payments:"payments_payments__L6INF",addPaymentForm:"payments_addPaymentForm__swVDe",paymentDetail:"payments_paymentDetail__Rf+jz",box:"payments_box__FrNDT",noContent:"payments_noContent__1w5P2",items:"payments_items__Tbm8u",name:"payments_name__Fk-vF",itemForm:"payments_itemForm__8qgch",btns:"payments_btns__drJwf",mainForm:"payments_mainForm__uZJ90",mainFormWrapper:"payments_mainFormWrapper__43wpb",purchaseTable:"payments_purchaseTable__s9H35",detail:"payments_detail__9XBo3",label:"payments_label__LJA4P",viewOnly:"payments_viewOnly__-wCBj",print:"payments_print__FTq7A",logo:"payments_logo__VYOFg",taxes:"payments_taxes__D-IRh",totalAmount:"payments_totalAmount__p+RH4",word:"payments_word__LTJ40",digit:"payments_digit__TDs-2",sign:"payments_sign__bx8lV",signature:"payments_signature__69YiV",date:"payments_date__tAqGl",no:"payments_no__vvUwl",customer:"payments_customer__9I89M",net:"payments_net__w6-SO",actions:"payments_actions__OF-vd",itemName:"payments_itemName__T-gDM"},d=t(5454),m=t(1080),p=t(1413),f=t(1134),v=t(1570),h=t(1146),x=t(184),_=v.Ry({date:v.Z_().required(),type:v.Z_().required(),amount:v.Rx().min(1,"Enter more than 0").required().typeError("Enter a valid amount"),vendorName:v.Z_().required("Vendor name is a required field"),vendorDetail:v.Z_().required("Vendor detail is a required field")}),b=v.Ry({no:v.Z_().required(),amount:v.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),net:v.Rx(),due:v.Rx()}),y=function(e){var n=e.label,t=e.value,a=e.className;return(0,x.jsxs)("p",{className:"".concat(c.detail," ").concat(a||""),children:[(0,x.jsxs)("span",{className:c.label,children:[n,":"]})," ",(0,x.jsx)("span",{className:c.value,children:t})]})},j=function(e){var n=e.edit,t=e.setEdit,a=(e.payments,e.purchases),r=e.onSuccess,m=((0,s.useContext)(o.D).config,(0,f.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(b)})),v=m.handleSubmit,h=m.register,_=m.reset,y=(m.watch,m.setValue),j=m.control,N=m.formState.errors;return(0,s.useEffect)((function(){_((0,p.Z)({},n))}),[n]),(0,x.jsxs)("form",{onSubmit:v((function(e){if(n||(e._id=Math.random().toString().substr(-8)),e.amount>e.due)return(0,u.N)({type:"error",message:"Enter an amount less or equal to ".concat(e.due)});e.no=+e.no,r(e),_()})),className:"".concat(c.itemForm," grid gap-1"),children:[(0,x.jsx)(i.OC,{control:j,label:"Purchase No.",options:a.filter((function(e){return e.due})).map((function(e){return{label:"".concat(e.no,". ").concat((0,i._7)(e.dateTime,"DD-MM-YY")," Due: ").concat(e.due),value:e.no,data:e}})),name:"no",formOptions:{required:!0},onChange:function(e){"string"===typeof e||(y("no",e.data.no),y("due",e.data.due),y("net",e.data.net))},type:"number",className:c.itemName}),(0,x.jsx)(i.II,(0,p.Z)((0,p.Z)({label:"Net",type:"number"},h("net")),{},{readOnly:!0})),(0,x.jsx)(i.II,(0,p.Z)((0,p.Z)({label:"Due",type:"number"},h("due")),{},{readOnly:!0})),(0,x.jsx)(i.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},h("amount")),{},{error:N.amount})),n?(0,x.jsxs)("div",{className:"flex ".concat(c.btns),children:[(0,x.jsx)("button",{type:"submit",children:(0,x.jsx)(l.l_A,{})}),(0,x.jsx)("button",{type:"button",onClick:function(){return t(null)},children:(0,x.jsx)(l.aHS,{})})]}):(0,x.jsx)("button",{className:"btn",children:n?"Update":"Add"})]})},N=function(e){var n,t=e.purchases,v=e.edit,h=e.items,b=e.setItems,y=e.payments,N=e.setErr,S=e.onSuccess,D=(e.setViewOnly,(0,s.useContext)(o.D)),Z=D.config,I=(D.setConfig,(0,s.useState)(!(null===v||void 0===v||null===(n=v.purchases)||void 0===n||!n.length))),A=(0,r.Z)(I,2),C=A[0],w=A[1],F=(0,s.useState)(null),P=(0,r.Z)(F,2),k=P[0],q=P[1],Y=(0,s.useState)("table"),E=(0,r.Z)(Y,2),O=E[0],T=E[1],M=(0,f.cI)({resolver:(0,d.y)(_)}),V=M.handleSubmit,R=M.register,B=M.reset,H=M.setValue,W=M.watch,J=M.control,L=M.formState.errors,U=(0,d.i)(m.Hv.payments+"/".concat((null===v||void 0===v?void 0:v._id)||"")),z=U.post,Q=U.put,G=U.loading,K=(0,s.useCallback)((function(e){if(h.length>0){h.reduce((function(e,n){return e+n.net}),0);var n=h.reduce((function(e,n){return e+n.amount}),0);h.reduce((function(e,n){return e+n.due}),0);if(n>e.amount)return(0,u.N)({type:"error",message:"Adjusted amount (".concat(n,") can not be more than the payment amount.")})}(v?Q:z)({dateTime:e.date,amount:e.amount,type:e.type,vendor:{name:e.vendorName,detail:e.vendorDetail},purchases:h.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{_id:void 0})}))}).then((function(e){var n=e.data;if(!n.success)return(0,u.N)({type:"error",message:n.message});S(n.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[h]),X=W("vendorName");return(0,s.useEffect)((function(){var e,n;B((0,p.Z)((0,p.Z)({},v),{},{date:(0,i._7)(null===v||void 0===v?void 0:v.date,"YYYY-MM-DD"),vendorName:(null===v||void 0===v||null===(e=v.vendor)||void 0===e?void 0:e.name)||"",vendorDetail:(null===v||void 0===v||null===(n=v.vendor)||void 0===n?void 0:n.detail)||""}))}),[v]),(0,x.jsxs)("div",{className:"".concat(c.mainForm," grid gap-1"),children:[(0,x.jsxs)("form",{className:"".concat(c.mainFormWrapper," grid gap-1 all-columns"),onSubmit:V(K),children:[(0,x.jsx)(i.II,(0,p.Z)((0,p.Z)({label:"Date",type:"date"},R("date")),{},{required:!0,error:L.date})),(0,x.jsx)(i.hQ,{label:"Type",name:"type",control:J,formOptions:{required:!0},options:[{label:"Cash",value:"Cash"},{label:"Bank Transfer",value:"Bank Transfer"}]}),(0,x.jsx)(i.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},R("amount")),{},{error:L.amount})),(0,x.jsx)("div",{className:"all-columns",children:(0,x.jsx)("h3",{children:"Vendor Information"})}),(0,x.jsx)(i.OC,{disabled:v,control:J,label:"Name",options:t.map((function(e){return{label:e.vendor.name,value:e.vendor.name,data:e.vendor}})),name:"vendorName",formOptions:{required:!0},renderListItem:function(e){return(0,x.jsx)(x.Fragment,{children:e.label})},onChange:function(e){H("vendorName",e.data.name),H("vendorDetail",e.data.detail),b([])}}),(0,x.jsx)(i.gx,(0,p.Z)({label:"Detail",readOnly:!0},R("vendorDetail")))]}),(0,x.jsx)("div",{className:"all-columns flex justify-center",children:(0,x.jsxs)("button",{className:"btn",onClick:function(){w(!C),b([])},children:[C?"Clear":"Adjust"," Purchases"]})}),C&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Adjusted Purchases"}),(0,x.jsx)(i.mQ,{secondary:!0,activeTab:O,onChange:function(e){return T(e.value)},tabs:[{label:"Purchase Table",value:"table"},{label:"Search Purchase",value:"search"}]})]}),C&&"table"===O&&(t.filter((function(e){return e.vendor.name===X&&(h.some((function(n){return n.no===e.no}))||e.due)})).length>0?(0,x.jsx)(i.iA,{className:c.purchaseTable,columns:[{label:"Purchase No"},{label:"Date"},{label:"Vendor"},{label:"Net",className:"text-right"},{label:"Due",className:"text-right"},{label:"Adjust"}],children:t.filter((function(e){return e.vendor.name===X&&(h.some((function(n){return n.no===e.no}))||e.due)})).map((function(e){return(0,x.jsx)(g,{purchase:e,config:Z,items:h,setItems:b},e._id)}))}):(0,x.jsx)("p",{className:c.noContent,children:"No pending purchase from selected vendor."})),C&&"search"===O&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(j,{purchases:t.filter((function(e){return e.vendor.name===X})),edit:k,setEdit:q,payments:y,onSuccess:function(e){if(N(null),k)b((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),q(null);else{if(h.some((function(n){return n.no.toString()===e.no.toString()})))return(0,u.N)({type:"error",message:"Purchase has already been added."});b((function(n){return[].concat((0,a.Z)(n),[e])}))}}},k?"edit":"add"),h.length>0?(0,x.jsx)(i.iA,{className:c.items,columns:[{label:"Purchase No."},{label:"Amount",className:"text-right"},{label:"Action",action:!0}],children:h.map((function(e,n){return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:c.name,children:(0,x.jsx)("span",{className:"ellipsis",children:e.no})}),(0,x.jsx)("td",{className:"text-right",children:e.amount.fix(2,null===Z||void 0===Z?void 0:Z.numberSeparator)}),(0,x.jsx)(i.p2,{actions:[{icon:(0,x.jsx)(l.KHI,{}),label:"Edit",callBack:function(){return q(e)}},{icon:(0,x.jsx)(l.lp8,{}),label:"Delete",callBack:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){b((function(n){return n.filter((function(n){return n._id!==e._id}))}))}})}}]})]},n)}))}):(0,x.jsx)("p",{className:c.noContent,children:"No purchases selected."})]}),(0,x.jsx)("form",{className:"".concat(c.btnsWrapper," grid gap-1 all-columns"),onSubmit:V(K),children:(0,x.jsx)("div",{className:"btns",children:(0,x.jsx)("button",{className:"btn",disabled:k||G,children:v?"Update":"Submit"})})})]})},g=function(e){var n,t,o,l=e.purchase,u=e.items,d=e.setItems,m=e.config,p=(0,s.useState)((null===(n=u.find((function(e){return e.no===l.no})))||void 0===n?void 0:n.amount)||""),f=(0,r.Z)(p,2),v=f[0],h=f[1];return(0,s.useEffect)((function(){var e;h((null===(e=u.find((function(e){return e.no===l.no})))||void 0===e?void 0:e.amount)||"")}),[u]),(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{children:[l.no,(null===m||void 0===m||null===(t=m.print)||void 0===t?void 0:t.purchaseNoSuffix)||""]}),(0,x.jsx)("td",{className:c.date,children:(0,x.jsx)(i.W7,{format:"DD/MM/YYYY",children:l.date})}),(0,x.jsx)("td",{className:c.vendor,children:null===(o=l.vendor)||void 0===o?void 0:o.name}),(0,x.jsx)("td",{className:"text-right ".concat(c.net),children:l.net.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{className:"text-right ".concat(c.net),children:l.due.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,x.jsx)("td",{children:(0,x.jsx)(i.II,{placeholder:"Adjust",type:"number",onBlur:function(e){var n=+e.target.value||0;if(n<=0)return e.target.value="",void d((function(e){return(0,a.Z)(e.filter((function(e){return e.no!==l.no})))}));l.due&&d((function(e){return[].concat((0,a.Z)(e.filter((function(e){return e.no!==l.no}))),[{_id:Math.random().toString().substr(-8),no:l.no,due:l.due,net:l.net,amount:Math.min(n,l.due)}])}))},value:v,onChange:function(e){return h(e.target.value)}})})]})},S=function(e){var n,t,a,l,u=e.edit,f=e.payments,v=e.onSuccess,_=(0,s.useContext)(o.D),b=(_.user,_.config),j=_.checkPermission,g=(0,s.useState)(!!u),S=(0,r.Z)(g,2),D=S[0],Z=S[1],I=(0,s.useState)((null===u||void 0===u?void 0:u.purchases)||[]),A=(0,r.Z)(I,2),C=A[0],w=A[1],F=(0,s.useState)(null),P=(0,r.Z)(F,2),k=P[0],q=P[1],Y=(0,s.useRef)(),E=((0,h.useReactToPrint)({content:function(){return Y.current}}),(0,s.useState)([])),O=(0,r.Z)(E,2),T=O[0],M=O[1],V=(0,d.i)(m.Hv.purchases).get;return(0,s.useEffect)((function(){V().then((function(e){var n=e.data;null!==n&&void 0!==n&&n.success&&M(n.data.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{due:e.due.fix(2),net:e.items.reduce((function(e,n){return e+n.qty*n.price}),0)+e.items.reduce((function(e,n){return e+n.qty*n.price}),0).percent(e.gst)})})))}))}),[]),(0,x.jsxs)("div",{className:"grid gap-1 p-1 ".concat(c.addPaymentForm," ").concat(D?c.viewOnly:""),children:[D&&(0,x.jsxs)("div",{className:"flex wrap gap-1 ".concat(c.paymentDetail),children:[(0,x.jsx)("div",{className:"flex gap-1 all-columns justify-end align-center",children:j("payment_update")&&(0,x.jsx)("button",{className:"btn",onClick:function(){return Z(!1)},children:"Edit"})}),(0,x.jsxs)("div",{className:c.box,children:[(0,x.jsx)("h3",{children:"Vendor Information"}),(0,x.jsx)(y,{label:"Name",value:null===(n=u.vendor)||void 0===n?void 0:n.name}),(0,x.jsx)(y,{label:"Detail",value:(null===(t=u.vendor)||void 0===t||null===(a=t.detail)||void 0===a?void 0:a.split("\n").map((function(e,n,t){return(0,x.jsxs)("span",{children:[e,t[n+1]&&(0,x.jsx)("br",{})]},n)})))||null})]}),(0,x.jsxs)("div",{className:c.box,children:[(0,x.jsx)("h3",{children:"Payment Information"}),(0,x.jsx)(y,{label:"Inv No",value:"".concat(u.no).concat((null===b||void 0===b||null===(l=b.print)||void 0===l?void 0:l.paymentNoSuffix)||"")}),(0,x.jsx)(y,{label:"Date",value:(0,i._7)(null===u||void 0===u?void 0:u.date,"DD-MM-YYYY")}),(0,x.jsx)(y,{label:"Amount",value:u.amount.fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"}),(0,x.jsx)(y,{label:"Adjusted",value:u.purchases.reduce((function(e,n){return e+n.amount}),0).fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"})]})]}),k&&(0,x.jsx)("p",{className:"error",children:k}),!1,!D&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("h3",{children:"Payment Information"}),(0,x.jsx)(N,{purchases:T,edit:u,items:C,setItems:w,payments:f,setErr:q,onSuccess:v,setViewOnly:Z})]})]})},D=function(){var e=(0,s.useContext)(o.D),n=e.config,t=e.checkPermission,p=(0,s.useState)([]),f=(0,r.Z)(p,2),v=f[0],h=f[1],_=(0,s.useState)(null),b=(0,r.Z)(_,2),y=b[0],j=b[1],N=(0,s.useState)(!1),g=(0,r.Z)(N,2),D=g[0],Z=g[1],I=(0,d.i)(m.Hv.payments),A=I.get,C=I.loading,w=(0,d.i)(m.Hv.payments+"/{ID}").remove;return(0,s.useEffect)((function(){A().then((function(e){var n=e.data;if(n.success)return h(n.data)})).catch((function(e){return(0,u.N)({type:"error",message:e.message})}))}),[]),(0,x.jsxs)("div",{className:"".concat(c.content," grid gap-1 m-a p-1"),children:[(0,x.jsxs)("div",{className:"flex",children:[(0,x.jsx)("h2",{children:"All Payments"}),t("payment_create")&&(0,x.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return Z(!0)},children:"Add Payment"})]}),(0,x.jsx)(i.iA,{loading:C,className:c.payments,columns:[{label:"No."},{label:"Date"},{label:"Customer"},{label:"Amount",className:"text-right"},{label:"Action"}],children:v.map((function(e){var r,s;return(0,x.jsxs)("tr",{onClick:function(){j(e),Z(!0)},style:{cursor:"pointer"},children:[(0,x.jsxs)("td",{className:c.no,children:[e.no,(null===n||void 0===n||null===(r=n.print)||void 0===r?void 0:r.paymentNoSuffix)||""]}),(0,x.jsx)("td",{className:c.date,children:(0,x.jsx)(i.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,x.jsx)("td",{className:c.customer,children:null===(s=e.customer)||void 0===s?void 0:s.name}),(0,x.jsx)("td",{className:"text-right ".concat(c.net),children:e.amount.fix(2,null===n||void 0===n?void 0:n.numberSeparator)}),(0,x.jsx)(i.p2,{className:c.actions,actions:[{icon:(0,x.jsx)(l.z5B,{}),label:"View",callBack:function(){j(e),Z(!0)}}].concat((0,a.Z)(t("payment_delete")?[{icon:(0,x.jsx)(l.lp8,{}),label:"Delete",callBack:function(){return(0,u.N)({type:"confirmation",message:"Are you sure you want to remove this payment?",callback:function(){w({},{params:{"{ID}":e._id}}).then((function(n){var t=n.data;t.success?h((function(n){return n.filter((function(n){return n._id!==e._id}))})):(0,u.N)({type:"error",message:t.message})}))}})}}]:[]))})]},e._id)}))}),(0,x.jsx)(u.u,{open:D,head:!0,label:"".concat(y?"View / Update":"Add"," Payment"),className:c.addPaymentFormModal,setOpen:function(){j(null),Z(!1)},children:(0,x.jsx)(S,{edit:y,payments:v,onSuccess:function(e){y?(h((function(n){return n.map((function(n){return n._id===e._id?e:n}))})),j(null)):h((function(n){return[].concat((0,a.Z)(n),[e])})),Z(!1)}})})]})}}}]);
//# sourceMappingURL=946.6b8ad89b.chunk.js.map