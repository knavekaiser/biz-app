"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[518],{2518:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var r=n(2982),i=n(885),a=n(2791),s=n(4581),o=n(3806),c=n(6355),l=n(96),u={content:"receipts_content__tjD09",receipts:"receipts_receipts__J+7yN",addReceiptForm:"receipts_addReceiptForm__dyLnV",receiptDetail:"receipts_receiptDetail__Za7ZS",box:"receipts_box__TW5Ir",noContent:"receipts_noContent__LnHPZ",items:"receipts_items__gQVA0",name:"receipts_name__J21St",itemForm:"receipts_itemForm__gx0OI",btns:"receipts_btns__0zRsL",mainForm:"receipts_mainForm__8uFYK",mainFormWrapper:"receipts_mainFormWrapper__I8Dji",invoiceTable:"receipts_invoiceTable__Xf6Ti",detail:"receipts_detail__Eb99S",label:"receipts_label__NxfIW",viewOnly:"receipts_viewOnly__NMTW8",print:"receipts_print__eOdlV",logo:"receipts_logo__SbMqJ",taxes:"receipts_taxes__CL35q",totalAmount:"receipts_totalAmount__tGiyf",word:"receipts_word__x4Ke7",digit:"receipts_digit__0aLcw",sign:"receipts_sign__PSjYO",signature:"receipts_signature__hhVf1",date:"receipts_date__XtCul",no:"receipts_no__spJFs",customer:"receipts_customer__CJNoe",net:"receipts_net__S0CDO",actions:"receipts_actions__+XYdH",itemName:"receipts_itemName__FL707"},d=n(5454),m=n(1080),p=n(1413),f=n(1134),v=n(1570),x=n(1146),h=n(184),_=v.Ry({date:v.Z_().required(),type:v.Z_().required(),amount:v.Rx().min(1,"Enter more than 0").required().typeError("Enter a valid amount"),customerName:v.Z_().required("Customer name is a required field"),customerDetail:v.Z_().required("Customer detail is a required field")}),b=v.Ry({no:v.Z_().required(),amount:v.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),net:v.Rx(),due:v.Rx()}),j=function(e){var t=e.label,n=e.value,r=e.className;return(0,h.jsxs)("p",{className:"".concat(u.detail," ").concat(r||""),children:[(0,h.jsxs)("span",{className:u.label,children:[t,":"]})," ",(0,h.jsx)("span",{className:u.value,children:n})]})},N=function(e){var t=e.edit,n=e.setEdit,r=(e.receipts,e.invoices),i=e.onSuccess,m=((0,a.useContext)(s.D).config,(0,f.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(b)})),v=m.handleSubmit,x=m.register,_=m.reset,j=(m.watch,m.setValue),N=(m.clearErrors,m.control),g=m.formState.errors;return(0,a.useEffect)((function(){_((0,p.Z)({},t))}),[t]),(0,h.jsxs)("form",{onSubmit:v((function(e){if(t||(e._id=Math.random().toString().substr(-8)),e.amount>e.due)return(0,l.N)({type:"error",message:"Enter an amount less or equal to ".concat(e.due)});e.no=+e.no,i(e),_()})),className:"".concat(u.itemForm," grid gap-1"),children:[(0,h.jsx)(o.OC,{control:N,label:"Invoice No.",options:r.filter((function(e){return e.due})).map((function(e){return{label:"".concat(e.no,". ").concat((0,o._7)(e.dateTime,"DD-MM-YY")," Due: ").concat(e.due),value:e.no,data:e}})),name:"no",formOptions:{required:!0},onChange:function(e){"string"===typeof e||(j("no",e.data.no),j("due",e.data.due),j("net",e.data.net))},type:"number",className:u.itemName}),(0,h.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Net",type:"number"},x("net")),{},{readOnly:!0})),(0,h.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Due",type:"number"},x("due")),{},{readOnly:!0})),(0,h.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},x("amount")),{},{error:g.amount})),t?(0,h.jsxs)("div",{className:"flex ".concat(u.btns),children:[(0,h.jsx)("button",{type:"submit",children:(0,h.jsx)(c.l_A,{})}),(0,h.jsx)("button",{type:"button",onClick:function(){return n(null)},children:(0,h.jsx)(c.aHS,{})})]}):(0,h.jsx)("button",{className:"btn",children:t?"Update":"Add"})]})},g=function(e){var t,n=e.invoices,v=e.edit,x=e.items,b=e.setItems,j=e.receipts,g=e.setErr,S=e.onSuccess,Z=(e.setViewOnly,(0,a.useContext)(s.D)),I=Z.config,D=(Z.setConfig,(0,a.useState)(!(null===v||void 0===v||null===(t=v.invoices)||void 0===t||!t.length))),C=(0,i.Z)(D,2),A=C[0],Y=C[1],k=(0,a.useState)(null),q=(0,i.Z)(k,2),w=q[0],E=q[1],F=(0,a.useState)("table"),O=(0,i.Z)(F,2),R=O[0],M=O[1],T=(0,f.cI)({resolver:(0,d.y)(_)}),V=T.handleSubmit,W=T.register,B=T.reset,H=T.setValue,L=T.watch,P=(T.clearErrors,T.control),J=T.formState.errors,K=(0,d.i)(m.Hv.receipts+"/".concat((null===v||void 0===v?void 0:v._id)||"")),Q=K.post,U=K.put,X=K.loading,z=(0,a.useCallback)((function(e){if(x.length>0){x.reduce((function(e,t){return e+t.net}),0);var t=x.reduce((function(e,t){return e+t.amount}),0);x.reduce((function(e,t){return e+t.due}),0);if(t>e.amount)return(0,l.N)({type:"error",message:"Adjusted amount (".concat(t,") can not be more than the receipt amount.")})}(v?U:Q)({dateTime:e.date,amount:e.amount,type:e.type,customer:{name:e.customerName,detail:e.customerDetail},invoices:x.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{_id:void 0})}))}).then((function(e){var t=e.data;if(!t.success)return(0,l.N)({type:"error",message:t.message});S(t.data)})).catch((function(e){return(0,l.N)({type:"error",message:e.message})}))}),[x]),G=L("customerName");return(0,a.useEffect)((function(){var e,t;B((0,p.Z)((0,p.Z)({},v),{},{date:(0,o._7)(null===v||void 0===v?void 0:v.date,"YYYY-MM-DD"),customerName:(null===v||void 0===v||null===(e=v.customer)||void 0===e?void 0:e.name)||"",customerDetail:(null===v||void 0===v||null===(t=v.customer)||void 0===t?void 0:t.detail)||""}))}),[v]),(0,h.jsxs)("div",{className:"".concat(u.mainForm," grid gap-1"),children:[(0,h.jsxs)("form",{className:"".concat(u.mainFormWrapper," grid gap-1 all-columns"),onSubmit:V(z),children:[(0,h.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Date",type:"date"},W("date")),{},{required:!0,error:J.date})),(0,h.jsx)(o.hQ,{label:"Type",name:"type",control:P,formOptions:{required:!0},options:[{label:"Cash",value:"Cash"},{label:"Bank Transfer",value:"Bank Transfer"}]}),(0,h.jsx)(o.II,(0,p.Z)((0,p.Z)({label:"Amount",type:"number",step:"0.01",required:!0},W("amount")),{},{error:J.amount})),(0,h.jsx)("div",{className:"all-columns",children:(0,h.jsx)("h3",{children:"Customer Information"})}),(0,h.jsx)(o.OC,{disabled:v,control:P,label:"Name",options:(0,r.Z)(new Set(n.map((function(e){return e.customer.name})))).map((function(e){var t;return{label:e,value:e,data:null===(t=n.find((function(t){return t.customer.name===e})))||void 0===t?void 0:t.customer}})),name:"customerName",formOptions:{required:!0},renderListItem:function(e){return(0,h.jsx)(h.Fragment,{children:e.label})},onChange:function(e){H("customerName",e.data.name),H("customerDetail",e.data.detail),b([])}}),(0,h.jsx)(o.gx,(0,p.Z)({label:"Detail",readOnly:!0},W("customerDetail")))]}),(0,h.jsx)("div",{className:"all-columns flex justify-center",children:(0,h.jsxs)("button",{className:"btn",onClick:function(){Y(!A),b([])},children:[A?"Clear":"Adjust"," Invoices"]})}),A&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("h3",{children:"Adjusted Invoices"}),(0,h.jsx)(o.mQ,{secondary:!0,activeTab:R,onChange:function(e){return M(e.value)},tabs:[{label:"Invoice Table",value:"table"},{label:"Search Invoice",value:"search"}]})]}),A&&"table"===R&&(n.filter((function(e){return e.customer.name===G&&(x.some((function(t){return t.no===e.no}))||e.due)})).length>0?(0,h.jsx)(o.iA,{className:u.invoiceTable,columns:[{label:"Invoice No"},{label:"Date"},{label:"Customer"},{label:"Net",className:"text-right"},{label:"Due",className:"text-right"},{label:"Adjust"}],children:n.filter((function(e){return e.customer.name===G&&(x.some((function(t){return t.no===e.no}))||e.due)})).map((function(e){return(0,h.jsx)(y,{invoice:e,config:I,items:x,setItems:b},e._id)}))}):(0,h.jsx)("p",{className:u.noContent,children:"No pending invoice from selected customer."})),A&&"search"===R&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(N,{invoices:n.filter((function(e){return e.customer.name===G})),edit:w,setEdit:E,receipts:j,onSuccess:function(e){if(g(null),w)b((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),E(null);else{if(x.some((function(t){return t.no.toString()===e.no.toString()})))return(0,l.N)({type:"error",message:"Invoice has already been added."});b((function(t){return[].concat((0,r.Z)(t),[e])}))}}},w?"edit":"add"),x.length>0?(0,h.jsx)(o.iA,{className:u.items,columns:[{label:"Invoice No."},{label:"Amount",className:"text-right"},{label:"Action",action:!0}],children:x.map((function(e,t){return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:u.name,children:(0,h.jsx)("span",{className:"ellipsis",children:e.no})}),(0,h.jsx)("td",{className:"text-right",children:e.amount.fix(2,null===I||void 0===I?void 0:I.numberSeparator)}),(0,h.jsx)(o.p2,{actions:[{icon:(0,h.jsx)(c.KHI,{}),label:"Edit",callBack:function(){return E(e)}},{icon:(0,h.jsx)(c.lp8,{}),label:"Delete",callBack:function(){return(0,l.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){b((function(t){return t.filter((function(t){return t._id!==e._id}))}))}})}}]})]},t)}))}):(0,h.jsx)("p",{className:u.noContent,children:"No invoices selected."})]}),(0,h.jsx)("form",{className:"".concat(u.btnsWrapper," grid gap-1 all-columns"),onSubmit:V(z),children:(0,h.jsx)("div",{className:"btns",children:(0,h.jsx)("button",{className:"btn",disabled:w||X,children:v?"Update":"Submit"})})})]})},y=function(e){var t,n,s,c=e.invoice,l=e.items,d=e.setItems,m=e.config,p=(0,a.useState)((null===(t=l.find((function(e){return e.no===c.no})))||void 0===t?void 0:t.amount)||""),f=(0,i.Z)(p,2),v=f[0],x=f[1];return(0,a.useEffect)((function(){var e;x((null===(e=l.find((function(e){return e.no===c.no})))||void 0===e?void 0:e.amount)||"")}),[l]),(0,h.jsxs)("tr",{children:[(0,h.jsxs)("td",{children:[c.no,(null===m||void 0===m||null===(n=m.print)||void 0===n?void 0:n.invoiceNoSuffix)||""]}),(0,h.jsx)("td",{className:u.date,children:(0,h.jsx)(o.W7,{format:"DD/MM/YYYY",children:c.date})}),(0,h.jsx)("td",{className:u.customer,children:null===(s=c.customer)||void 0===s?void 0:s.name}),(0,h.jsx)("td",{className:"text-right ".concat(u.net),children:c.net.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,h.jsx)("td",{className:"text-right ".concat(u.net),children:c.due.fix(2,null===m||void 0===m?void 0:m.numberSeparator)}),(0,h.jsx)("td",{children:(0,h.jsx)(o.II,{placeholder:"Adjust",type:"number",onBlur:function(e){var t=+e.target.value||0;if(t<=0)return e.target.value="",void d((function(e){return(0,r.Z)(e.filter((function(e){return e.no!==c.no})))}));c.due&&d((function(e){return[].concat((0,r.Z)(e.filter((function(e){return e.no!==c.no}))),[{_id:Math.random().toString().substr(-8),no:c.no,due:c.due,net:c.net,amount:Math.min(t,c.due)}])}))},value:v,onChange:function(e){return x(e.target.value)}})})]})},S=function(e){var t,n,r,c,l=e.edit,f=e.receipts,v=e.onSuccess,_=(0,a.useContext)(s.D),b=(_.user,_.config),N=_.checkPermission,y=(0,a.useState)(!!l),S=(0,i.Z)(y,2),Z=S[0],I=S[1],D=(0,a.useState)((null===l||void 0===l?void 0:l.invoices)||[]),C=(0,i.Z)(D,2),A=C[0],Y=C[1],k=(0,a.useState)(null),q=(0,i.Z)(k,2),w=q[0],E=q[1],F=(0,a.useRef)(),O=((0,x.useReactToPrint)({content:function(){return F.current}}),(0,a.useState)([])),R=(0,i.Z)(O,2),M=R[0],T=R[1],V=(0,d.i)(m.Hv.invoices).get;return(0,a.useEffect)((function(){V().then((function(e){var t=e.data;null!==t&&void 0!==t&&t.success&&T(t.data.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{due:e.due.fix(2),net:e.items.reduce((function(e,t){return e+t.qty*t.price}),0)+e.items.reduce((function(e,t){return e+t.qty*t.price}),0).percent(e.gst)})})))}))}),[]),(0,h.jsxs)("div",{className:"grid gap-1 p-1 ".concat(u.addReceiptForm," ").concat(Z?u.viewOnly:""),children:[Z&&(0,h.jsxs)("div",{className:"flex wrap gap-1 ".concat(u.receiptDetail),children:[(0,h.jsx)("div",{className:"flex gap-1 all-columns justify-end align-center",children:N("receipt_update")&&(0,h.jsx)("button",{className:"btn",onClick:function(){return I(!1)},children:"Edit"})}),(0,h.jsxs)("div",{className:u.box,children:[(0,h.jsx)("h3",{children:"Customer Information"}),(0,h.jsx)(j,{label:"Name",value:null===(t=l.customer)||void 0===t?void 0:t.name}),(0,h.jsx)(j,{label:"Detail",value:(null===(n=l.customer)||void 0===n||null===(r=n.detail)||void 0===r?void 0:r.split("\n").map((function(e,t,n){return(0,h.jsxs)("span",{children:[e,n[t+1]&&(0,h.jsx)("br",{})]},t)})))||null})]}),(0,h.jsxs)("div",{className:u.box,children:[(0,h.jsx)("h3",{children:"Receipt Information"}),(0,h.jsx)(j,{label:"Inv No",value:"".concat(l.no).concat((null===b||void 0===b||null===(c=b.print)||void 0===c?void 0:c.receiptNoSuffix)||"")}),(0,h.jsx)(j,{label:"Date",value:(0,o._7)(null===l||void 0===l?void 0:l.date,"DD-MM-YYYY")}),(0,h.jsx)(j,{label:"Amount",value:l.amount.fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"}),(0,h.jsx)(j,{label:"Adjusted",value:l.invoices.reduce((function(e,t){return e+t.amount}),0).fix(2,null===b||void 0===b?void 0:b.numberSeparator),className:"flex justify-space-between"})]})]}),w&&(0,h.jsx)("p",{className:"error",children:w}),!1,!Z&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("h3",{children:"Receipt Information"}),(0,h.jsx)(g,{invoices:M,edit:l,items:A,setItems:Y,receipts:f,setErr:E,onSuccess:v,setViewOnly:I})]})]})},Z=function(){var e=(0,a.useContext)(s.D),t=e.config,n=e.checkPermission,p=(0,a.useState)([]),f=(0,i.Z)(p,2),v=f[0],x=f[1],_=(0,a.useState)(null),b=(0,i.Z)(_,2),j=b[0],N=b[1],g=(0,a.useState)(!1),y=(0,i.Z)(g,2),Z=y[0],I=y[1],D=(0,d.i)(m.Hv.receipts),C=D.get,A=D.loading,Y=(0,d.i)(m.Hv.receipts+"/{ID}").remove;return(0,a.useEffect)((function(){C().then((function(e){var t=e.data;if(t.success)return x(t.data)})).catch((function(e){return(0,l.N)({type:"error",message:e.message})}))}),[]),(0,h.jsxs)("div",{className:"".concat(u.content," grid gap-1 m-a p-1"),children:[(0,h.jsxs)("div",{className:"flex",children:[(0,h.jsx)("h2",{children:"All Receipts"}),n("reciept_create")&&(0,h.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return I(!0)},children:"Add Receipt"})]}),(0,h.jsx)(o.iA,{loading:A,className:u.receipts,columns:[{label:"No."},{label:"Date"},{label:"Customer"},{label:"Amount",className:"text-right"},{label:"Action"}],children:v.map((function(e){var i,a;return(0,h.jsxs)("tr",{onClick:function(){N(e),I(!0)},style:{cursor:"pointer"},children:[(0,h.jsxs)("td",{className:u.no,children:[e.no,(null===t||void 0===t||null===(i=t.print)||void 0===i?void 0:i.receiptNoSuffix)||""]}),(0,h.jsx)("td",{className:u.date,children:(0,h.jsx)(o.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,h.jsx)("td",{className:u.customer,children:null===(a=e.customer)||void 0===a?void 0:a.name}),(0,h.jsx)("td",{className:"text-right ".concat(u.net),children:e.amount.fix(2,null===t||void 0===t?void 0:t.numberSeparator)}),(0,h.jsx)(o.p2,{className:u.actions,actions:[{icon:(0,h.jsx)(c.z5B,{}),label:"View",callBack:function(){N(e),I(!0)}}].concat((0,r.Z)(n("reciept_delete")?[{icon:(0,h.jsx)(c.lp8,{}),label:"Delete",callBack:function(){return(0,l.N)({type:"confirmation",message:"Are you sure you want to remove this receipt?",callback:function(){Y({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?x((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,l.N)({type:"error",message:n.message})}))}})}}]:[]))})]},e._id)}))}),(0,h.jsx)(l.u,{open:Z,head:!0,label:"".concat(j?"View / Update":"Add"," Receipt"),className:u.addReceiptFormModal,setOpen:function(){N(null),I(!1)},children:(0,h.jsx)(S,{edit:j,receipts:v,onSuccess:function(e){j?(x((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),N(null)):x((function(t){return[].concat((0,r.Z)(t),[e])})),I(!1)}})})]})}}}]);
//# sourceMappingURL=518.bfb42626.chunk.js.map