"use strict";(self.webpackChunkcash_app=self.webpackChunkcash_app||[]).push([[282],{2282:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var s=n(2982),a=n(885),r=n(2791),i=n(4581),o=n(6884),u=n(6355),l=n(96),c={content:"quotes_content__-M2Qc",quotes:"quotes_quotes__lyIdy",addQuoteForm:"quotes_addQuoteForm__snqXq",quoteDetail:"quotes_quoteDetail__pzHnS",box:"quotes_box__e6ggU",noContent:"quotes_noContent__Ha+ZJ",items:"quotes_items__NKOSp",name:"quotes_name__Si8Tu",itemForm:"quotes_itemForm__WeTTo",mainForm:"quotes_mainForm__HsWhd",detail:"quotes_detail__ntRIS",label:"quotes_label__5Ay0F",viewOnly:"quotes_viewOnly__ykqy6",print:"quotes_print__uG-yF",logo:"quotes_logo__+bb1o",taxes:"quotes_taxes__11+N0",totalAmount:"quotes_totalAmount__LnJMo",word:"quotes_word__a6RJ5",digit:"quotes_digit__AZO3W",sign:"quotes_sign__qvFCl",signature:"quotes_signature__l0v1M",date:"quotes_date__Irk1E",customer:"quotes_customer__0FOXm",net:"quotes_net__bSXad",actions:"quotes_actions__nz5pN",itemName:"quotes_itemName__WTYJv"},d=n(5454),m=n(1080),f=n(1413),_=n(1134),x=n(1570),h=n(1146),p=n(184),b=x.Ry({date:x.Z_().required(),customerName:x.Z_().required(),customerDetail:x.Z_().required()}),v=x.Ry({name:x.Z_().required(),price:x.Rx().min(0,"Price can not be less than 0").required().typeError("Enter a valid Number"),qty:x.Rx().min(1,"Qty can not be less than 1").required().typeError("Enter a valid Number"),unit:x.Vo((function(e){switch(typeof e){case"object":return x.Ry().typeError("Select a unit").required();case"string":return x.Z_().required();default:return x.nK().required()}}))}),g=function(e){var t=e.label,n=e.value,s=e.className;return(0,p.jsxs)("p",{className:"".concat(c.detail," ").concat(s||""),children:[(0,p.jsxs)("span",{className:c.label,children:[t,":"]})," ",(0,p.jsx)("span",{className:c.value,children:n})]})},j=function(e){var t=e.edit,n=e.quotes,a=e.onSuccess,u=(0,r.useContext)(i.D).config,l=(0,_.cI)({defaultValues:{unit:"Piece"},resolver:(0,d.y)(v)}),m=l.handleSubmit,x=l.register,h=l.reset,b=l.watch,g=l.setValue,j=l.control,q=l.formState.errors;return(0,r.useEffect)((function(){h((0,f.Z)({},t))}),[t]),(0,p.jsxs)("form",{onSubmit:m((function(e){t||(e._id=Math.random().toString().substr(-8)),a(e),h()})),className:"".concat(c.itemForm," grid gap-1"),children:[(0,p.jsx)(o.Um,{label:"Product",data:n.reduce((function(e,t){return[].concat((0,s.Z)(e),(0,s.Z)(t.items))}),[]).map((function(e){return{label:e.name,value:e.name,data:e}})),register:x,name:"name",formOptions:{required:!0},renderListItem:function(e){return(0,p.jsx)(p.Fragment,{children:e.label})},watch:b,setValue:g,onChange:function(e){"string"===typeof e?g("name",e):(g("name",e.name),g("price",e.price))},error:q.name,className:c.itemName}),(0,p.jsx)(o.II,(0,f.Z)((0,f.Z)({label:"Price",type:"number",required:!0},x("price")),{},{error:q.price})),(0,p.jsx)(o.II,(0,f.Z)((0,f.Z)({label:"Qty",type:"number",required:!0},x("qty")),{},{error:q.qty})),(0,p.jsx)(o.hQ,{label:"Unit",control:j,name:"unit",formOptions:{required:!0},options:u.unitsOfMeasure.map((function(e){return{label:e,value:e}}))}),(0,p.jsx)("button",{className:"btn",children:"Add"})]})},q=function(e){var t=e.disabled,n=e.edit,s=e.items,a=e.quotes,i=e.setErr,u=e.onSuccess,x=(0,_.cI)({resolver:(0,d.y)(b)}),h=x.handleSubmit,v=x.register,g=x.reset,j=x.setValue,q=x.watch,N=x.control,y=x.formState.errors,Z=(0,d.i)(m.Hv.quotes+"/".concat((null===n||void 0===n?void 0:n._id)||"")),S=Z.post,D=Z.put,w=Z.loading;return(0,r.useEffect)((function(){var e,t;g((0,f.Z)((0,f.Z)({},n),{},{status:(null===n||void 0===n?void 0:n.status)||"pending",date:(0,o._7)(null===n||void 0===n?void 0:n.date,"YYYY-MM-DD"),customerName:(null===n||void 0===n||null===(e=n.customer)||void 0===e?void 0:e.name)||"",customerDetail:(null===n||void 0===n||null===(t=n.customer)||void 0===t?void 0:t.detail)||""}))}),[n]),(0,p.jsxs)("form",{onSubmit:h((function(e){if(s.length<1)return i("Add at least one item");(n?D:S)({dateTime:e.date,status:e.status,customer:{name:e.customerName,detail:e.customerDetail},items:s.map((function(e){return(0,f.Z)((0,f.Z)({},e),{},{_id:void 0})}))}).then((function(e){var t=e.data;if(!t.success)return(0,l.N)({type:"error",message:t.message});u(t.data)})).catch((function(e){return(0,l.N)({type:"error",message:e.message})}))})),className:"".concat(c.mainForm," grid gap-1"),children:[(0,p.jsx)(o.II,(0,f.Z)((0,f.Z)({label:"Date",type:"date"},v("date")),{},{required:!0,error:y.date})),(0,p.jsx)(o.hQ,{label:"Status",name:"status",control:N,options:[{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"}]}),(0,p.jsx)("div",{className:"all-columns",children:(0,p.jsx)("h3",{children:"Customer Information"})}),(0,p.jsx)(o.Um,{label:"Name",data:a.map((function(e){return{label:e.customer.name,value:e.customer.name,data:e.customer}})),register:v,name:"customerName",formOptions:{required:!0},renderListItem:function(e){return(0,p.jsx)(p.Fragment,{children:e.label})},watch:q,setValue:j,onChange:function(e){"string"===typeof e?j("customerName",e):(j("customerName",e.name),j("customerDetail",e.detail))},error:y.customerName}),(0,p.jsx)(o.gx,(0,f.Z)((0,f.Z)({label:"Detail"},v("customerDetail")),{},{required:!0,error:y.customerDetail})),(0,p.jsx)("div",{className:"btns",children:(0,p.jsx)("button",{className:"btn",disabled:t||w,children:n?"Update":"Submit"})})]})},N=function(e){var t,n,_,x=e.edit,b=e.quotes,v=e.onSuccess,N=(0,r.useContext)(i.D),y=(N.user,N.config),Z=N.checkPermission,S=(0,r.useState)(!!x),D=(0,a.Z)(S,2),w=D[0],I=D[1],k=(0,r.useState)((null===x||void 0===x?void 0:x.items)||[]),C=(0,a.Z)(k,2),F=C[0],A=C[1],O=(0,r.useState)(null),Q=(0,a.Z)(O,2),E=Q[0],Y=Q[1],M=(0,r.useState)(null),P=(0,a.Z)(M,2),R=P[0],V=P[1],H=(0,r.useRef)(),T=(0,h.useReactToPrint)({content:function(){return H.current}}),U=(0,d.i)(m.Hv.generateOrderFromQuote),B=U.post,W=U.loading;return(0,p.jsxs)("div",{className:"grid gap-1 p-1 ".concat(c.addQuoteForm," ").concat(w?c.viewOnly:""),children:[w&&(0,p.jsxs)("div",{className:"flex wrap gap-1 ".concat(c.quoteDetail),children:[(0,p.jsxs)("div",{className:"flex gap-1 all-columns justify-end align-center",children:[(null===x||void 0===x?void 0:x._id)&&Z("order_create")&&"pending"===(null===x||void 0===x?void 0:x.status)&&(0,p.jsx)("button",{className:"btn",disabled:W,onClick:function(){return(0,l.N)({type:"confirmation",message:"Are you sure want to generate an order from this quote?",callback:function(){B({quote_id:null===x||void 0===x?void 0:x._id}).then((function(e){var t=e.data;t.success?(v((0,f.Z)((0,f.Z)({},x),{},{status:"ordered"})),(0,l.N)({type:"success",message:"Order has been generated"})):(0,l.N)({type:"error",message:t.message})})).catch((function(e){return(0,l.N)({type:"error",message:e.message})}))}})},children:"Generate Order"}),Z("quote_update")&&(0,p.jsx)("button",{disabled:W,className:"btn",onClick:function(){return I(!1)},children:"Edit"}),(0,p.jsx)("button",{className:"btn",onClick:T,children:"Print"})]}),(0,p.jsxs)("div",{className:c.box,children:[(0,p.jsx)("h3",{children:"Customer Information"}),(0,p.jsx)(g,{label:"Name",value:null===(t=x.customer)||void 0===t?void 0:t.name}),(0,p.jsx)(g,{label:"Detail",value:(null===(n=x.customer)||void 0===n||null===(_=n.detail)||void 0===_?void 0:_.split("\n").map((function(e,t,n){return(0,p.jsxs)("span",{children:[e,n[t+1]&&(0,p.jsx)("br",{})]},t)})))||null})]}),(0,p.jsxs)("div",{className:c.box,children:[(0,p.jsx)("h3",{children:"Quote Information"}),(0,p.jsx)(g,{label:"Status",value:null===x||void 0===x?void 0:x.status,className:"flex justify-space-between"}),(0,p.jsx)(g,{label:"Date",value:(0,o._7)(null===x||void 0===x?void 0:x.date,"DD-MM-YYYY"),className:"flex justify-space-between"}),(0,p.jsx)(g,{label:"Total",value:(x.items.reduce((function(e,t){return e+t.qty*t.price}),0)+x.items.reduce((function(e,t){return e+t.qty*t.price}),0)).fix(2,null===y||void 0===y?void 0:y.numberSeparator),className:"flex justify-space-between"})]})]}),(0,p.jsx)("h3",{children:"Items"}),F.length>0?(0,p.jsx)(o.iA,{className:c.items,columns:[{label:"Product"},{label:"Qty",className:"text-right"},{label:"Unit"},{label:"Rate",className:"text-right"},{label:"Total",className:"text-right"}].concat((0,s.Z)(w?[]:[{label:"Action",action:!0}])),children:F.map((function(e,t){return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{className:c.name,children:(0,p.jsx)("span",{className:"ellipsis",children:e.name})}),(0,p.jsx)("td",{className:"text-right",children:e.qty}),(0,p.jsx)("td",{children:e.unit}),(0,p.jsx)("td",{className:"text-right",children:e.price.fix(2,null===y||void 0===y?void 0:y.numberSeparator)}),(0,p.jsx)("td",{className:"text-right",children:(e.price*e.qty).fix(2,null===y||void 0===y?void 0:y.numberSeparator)}),!w&&(0,p.jsx)(o.p2,{actions:[{icon:(0,p.jsx)(u.KHI,{}),label:"Edit",callBack:function(){return Y(e)}},{icon:(0,p.jsx)(u.lp8,{}),label:"Delete",callBack:function(){return(0,l.N)({type:"confirmation",message:"Are you sure you want to remove this Item?",callback:function(){A((function(t){return t.filter((function(t){return t._id!==e._id}))}))}})}}]})]},t)}))}):(0,p.jsx)("p",{className:c.noContent,children:"No items yet."}),R&&(0,p.jsx)("p",{className:"error",children:R}),!w&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(j,{edit:E,quotes:b,onSuccess:function(e){V(null),E?(A((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),Y(null)):A((function(t){return[].concat((0,s.Z)(t),[e])}))}},E?"edit":"add"),(0,p.jsx)("h3",{className:"mt-1",children:"Other Information"}),(0,p.jsx)(q,{disabled:E,edit:x,items:F,quotes:b,setErr:V,onSuccess:v,setViewOnly:I})]})]})},y=function(){var e=(0,r.useContext)(i.D),t=e.config,n=e.checkPermission,f=(0,r.useState)([]),_=(0,a.Z)(f,2),x=_[0],h=_[1],b=(0,r.useState)(null),v=(0,a.Z)(b,2),g=v[0],j=v[1],q=(0,r.useState)(!1),y=(0,a.Z)(q,2),Z=y[0],S=y[1],D=(0,d.i)(m.Hv.quotes),w=D.get,I=D.loading,k=(0,d.i)(m.Hv.quotes+"/{ID}").remove;return(0,r.useEffect)((function(){w().then((function(e){var t=e.data;if(t.success)return h(t.data)})).catch((function(e){return(0,l.N)({type:"error",message:e.message})}))}),[]),(0,p.jsxs)("div",{className:"".concat(c.content," grid gap-1 m-a p-1"),children:[(0,p.jsxs)("div",{className:"flex",children:[(0,p.jsx)("h2",{children:"All Quotes"}),n("quote_create")&&(0,p.jsx)("button",{className:"btn m-a mr-0",onClick:function(){return S(!0)},children:"Add Quote"})]}),(0,p.jsx)(o.iA,{loading:I,className:c.quotes,columns:[{label:"Date"},{label:"Customer"},{label:"Status"},{label:"Net Amount",className:"text-right"},{label:"Action"}],children:x.map((function(e){var a;return(0,p.jsxs)("tr",{onClick:function(){j(e),S(!0)},style:{cursor:"pointer"},children:[(0,p.jsx)("td",{className:c.date,children:(0,p.jsx)(o.W7,{format:"DD/MM/YYYY",children:e.date})}),(0,p.jsx)("td",{className:c.customer,children:null===(a=e.customer)||void 0===a?void 0:a.name}),(0,p.jsx)("td",{children:e.status}),(0,p.jsx)("td",{className:"text-right ".concat(c.net),children:(e.items.reduce((function(e,t){return e+t.qty*t.price}),0)+e.items.reduce((function(e,t){return e+t.qty*t.price}),0)).fix(2,null===t||void 0===t?void 0:t.numberSeparator)}),(0,p.jsx)(o.p2,{className:c.actions,actions:[{icon:(0,p.jsx)(u.z5B,{}),label:"View",callBack:function(){j(e),S(!0)}}].concat((0,s.Z)(n("quote_delete")?[{icon:(0,p.jsx)(u.lp8,{}),label:"Delete",callBack:function(){return(0,l.N)({type:"confirmation",message:"Are you sure you want to remove this quote?",callback:function(){k({},{params:{"{ID}":e._id}}).then((function(t){var n=t.data;n.success?h((function(t){return t.filter((function(t){return t._id!==e._id}))})):(0,l.N)({type:"error",message:n.message})}))}})}}]:[]))})]},e._id)}))}),(0,p.jsx)(l.u,{open:Z,head:!0,label:"".concat(g?"View / Update":"Add"," Quote"),className:c.addQuoteFormModal,setOpen:function(){j(null),S(!1)},children:(0,p.jsx)(N,{edit:g,quotes:x,onSuccess:function(e){g?(h((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),j(null)):h((function(t){return[].concat((0,s.Z)(t),[e])})),S(!1)}})})]})}}}]);
//# sourceMappingURL=282.3556b744.chunk.js.map